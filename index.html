<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 ä¹å·è³æ¥“è‡ªé§•è¡Œ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* Animations */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        .slide-up-enter-active, .slide-up-leave-active {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .slide-up-enter-from, .slide-up-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }

        /* Timeline Connector */
        .timeline-line {
            position: absolute;
            left: 1.25rem;
            top: 2rem;
            bottom: -2rem;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
        .last-item .timeline-line {
            display: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <div id="app" class="flex flex-col h-full w-full max-w-md mx-auto bg-white shadow-2xl relative overflow-hidden">

        <!-- ================= HERO SECTION (Only on Home) ================= -->
        <header v-if="currentTab === 'home'" class="relative bg-gradient-to-br from-purple-600 to-indigo-700 text-white p-6 pb-12 rounded-b-[2.5rem] shadow-lg z-10 shrink-0">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-xs font-medium opacity-80 bg-white/20 px-2 py-1 rounded-full inline-block mb-2">2025 TRIP</div>
                    <h1 class="text-3xl font-bold tracking-tight">ä¹å·è³æ¥“<br>è‡ªé§•ä¹‹æ—… ğŸ</h1>
                </div>
                <!-- Weather Widget -->
                <div class="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-2xl p-3 border border-white/20">
                    <i class="fas fa-sun text-yellow-300 text-2xl mb-1"></i>
                    <span class="text-2xl font-bold">{{ currentWeather }}Â°</span>
                    <span class="text-xs opacity-80">{{ currentLocation }}</span>
                </div>
            </div>

            <!-- Countdown -->
            <div class="flex items-center gap-2 text-sm opacity-90 mb-4">
                <i class="far fa-calendar-alt"></i>
                <span>12/3 (ä¸‰) - 12/9 (äºŒ)</span>
                <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full ml-2 animate-pulse">
                    é‚„æœ‰ {{ daysUntilTrip }} å¤©
                </span>
            </div>

            <!-- Day Selector -->
            <div class="flex overflow-x-auto gap-3 pb-2 -mx-2 px-2 no-scrollbar scroll-smooth">
                <button 
                    v-for="(day, index) in timelineData" 
                    :key="index"
                    @click="scrollToDay(index)"
                    :class="['flex-shrink-0 w-14 h-16 rounded-xl flex flex-col items-center justify-center transition-all border-2', 
                             currentDayIndex === index ? 'bg-white text-purple-700 border-white scale-105 shadow-md' : 'bg-white/10 text-white border-transparent hover:bg-white/20']"
                >
                    <span class="text-xs opacity-70">Day</span>
                    <span class="text-lg font-bold">{{ index }}</span>
                </button>
            </div>
        </header>

        <!-- ================= MAIN CONTENT AREA ================= -->
        <main class="flex-1 overflow-y-auto pb-24 pt-4 px-4 bg-slate-50 relative scroll-smooth" id="main-content">
            
            <!-- VIEW: HOME (Timeline) -->
            <div v-if="currentTab === 'home'">
                <div v-for="(day, dayIndex) in timelineData" :key="dayIndex" :id="'day-' + dayIndex" class="mb-8">
                    <!-- Day Header -->
                    <div class="flex items-center gap-3 mb-4 sticky top-0 bg-slate-50/95 backdrop-blur py-2 z-10">
                        <div class="w-2 h-8 bg-purple-600 rounded-r-lg"></div>
                        <h2 class="text-xl font-bold text-slate-800">
                            Day {{ dayIndex }} 
                            <span class="text-sm font-normal text-slate-500 ml-2">{{ day.date }}</span>
                        </h2>
                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">{{ day.location }}</span>
                    </div>

                    <!-- Timeline Events -->
                    <div class="relative pl-2">
                        <div v-for="(event, eventIndex) in day.events" :key="eventIndex" class="relative pl-8 pb-8 group last-item">
                            <!-- Line -->
                            <div class="timeline-line group-last:hidden"></div>
                            
                            <!-- Icon -->
                            <div class="absolute left-0 top-1 w-10 h-10 rounded-full flex items-center justify-center border-4 border-slate-50 shadow-sm z-10"
                                 :class="getIconColor(event.type)">
                                <i :class="event.icon + ' text-white text-sm'"></i>
                            </div>

                            <!-- Card -->
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 active:scale-[0.98] transition-transform" @click="handleCardClick(event)">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="text-sm font-bold text-slate-400 font-mono">{{ event.time }}</span>
                                    <div class="flex gap-1">
                                        <span v-if="event.tag" :class="getTagColor(event.tag)" class="text-[10px] px-2 py-1 rounded-full font-bold">
                                            {{ event.tag }}
                                        </span>
                                    </div>
                                </div>
                                <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight">{{ event.title }}</h3>
                                <p v-if="event.desc" class="text-sm text-slate-500 mb-2 leading-relaxed" v-html="highlightText(event.desc)"></p>
                                
                                <!-- Meta/Actions -->
                                <div class="flex flex-wrap gap-2 mt-3">
                                    <a v-if="event.location" :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(event.location)" target="_blank" @click.stop 
                                       class="inline-flex items-center gap-1 text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1.5 rounded-lg transition-colors">
                                        <i class="fas fa-map-marker-alt text-red-500"></i> å°èˆª
                                    </a>
                                    <button v-if="event.code || event.detail" @click.stop="openDetailModal(event)" 
                                            class="inline-flex items-center gap-1 text-xs bg-purple-50 text-purple-700 px-3 py-1.5 rounded-lg border border-purple-100">
                                        <i class="fas fa-info-circle"></i> {{ event.code ? 'æŸ¥çœ‹ä»£è™Ÿ' : 'è©³ç´°è³‡è¨Š' }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LIST (Checklist) -->
            <div v-else-if="currentTab === 'list'" class="pt-4">
                <h2 class="text-2xl font-bold mb-6 text-slate-800 px-2">è¡Œå‰èˆ‡è³¼ç‰©</h2>
                <div class="flex bg-slate-200 p-1 rounded-xl mb-6">
                    <button @click="listTab = 'pack'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', listTab === 'pack' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">è¡Œå‰æ‰“åŒ…</button>
                    <button @click="listTab = 'buy'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', listTab === 'buy' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">å¾…è²·æ¸…å–®</button>
                </div>

                <!-- Packing List -->
                <div v-if="listTab === 'pack'" class="space-y-3">
                    <div v-for="(item, idx) in packList" :key="idx" 
                         class="flex items-center bg-white p-4 rounded-xl shadow-sm border border-slate-100"
                         @click="item.checked = !item.checked">
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 transition-colors"
                             :class="item.checked ? 'bg-green-500 border-green-500' : 'border-slate-300'">
                            <i v-if="item.checked" class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <p :class="['font-medium transition-all', item.checked ? 'text-slate-400 line-through' : 'text-slate-800']">{{ item.text }}</p>
                            <p class="text-xs text-slate-400">{{ item.sub }}</p>
                        </div>
                    </div>
                    <button @click="addPackItem" class="w-full py-4 rounded-xl border-2 border-dashed border-slate-300 text-slate-400 font-bold hover:bg-slate-50 hover:border-purple-300 hover:text-purple-500 transition-all">
                        <i class="fas fa-plus mr-2"></i> æ–°å¢é …ç›®
                    </button>
                </div>

                <!-- Shopping List -->
                <div v-if="listTab === 'buy'" class="grid grid-cols-2 gap-4">
                    <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-xl overflow-hidden shadow-sm relative group">
                        <div class="h-32 bg-slate-200 flex items-center justify-center relative overflow-hidden">
                            <img v-if="item.img" :src="item.img" class="w-full h-full object-cover">
                            <i v-else class="fas fa-camera text-slate-400 text-2xl"></i>
                            <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                                <span class="text-white text-xs font-bold">æ›´æ›ç…§ç‰‡</span>
                            </div>
                        </div>
                        <div class="p-3">
                            <input v-model="item.name" class="w-full font-bold text-slate-800 bg-transparent border-none p-0 focus:ring-0 placeholder-slate-400" placeholder="è¼¸å…¥å•†å“å">
                            <input v-model="item.note" class="w-full text-xs text-slate-500 bg-transparent border-none p-0 focus:ring-0 placeholder-slate-300 mt-1" placeholder="å‚™è¨» (å¦‚: è—¥å¦)">
                        </div>
                        <button @click="removeShopItem(idx)" class="absolute top-2 right-2 w-6 h-6 bg-red-500 rounded-full text-white text-xs flex items-center justify-center shadow-md">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button @click="addShopItem" class="h-48 rounded-xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center text-slate-400 hover:bg-slate-50 hover:border-purple-300 hover:text-purple-500 transition-all">
                        <i class="fas fa-camera text-2xl mb-2"></i>
                        <span class="text-sm font-bold">æ–°å¢å•†å“</span>
                    </button>
                </div>
            </div>

            <!-- VIEW: TOOLS (Currency, Driving & Budget) -->
            <div v-else-if="currentTab === 'tools'" class="pt-4 space-y-6">
                
                <!-- Driving HUD -->
                <div class="bg-slate-900 text-white rounded-3xl p-6 shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500 rounded-full blur-3xl opacity-20 -mr-10 -mt-10"></div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold italic"><i class="fas fa-car mr-2"></i>DRIVER HUD</h3>
                            <span class="bg-yellow-500 text-black text-xs font-bold px-2 py-1 rounded">è‡ªé§•æ¨¡å¼</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <button @click="showDriveTips = true" class="bg-white/10 hover:bg-white/20 p-3 rounded-xl text-left transition-colors">
                                <i class="fas fa-book text-blue-300 mb-2 block"></i>
                                <div class="text-sm font-bold">è‡ªé§•æ‡¶äººåŒ…</div>
                                <div class="text-[10px] opacity-70">åŠ æ²¹/å ±è­¦SOP</div>
                            </button>
                            <button @click="showMapCodes = true" class="bg-white/10 hover:bg-white/20 p-3 rounded-xl text-left transition-colors">
                                <i class="fas fa-map-marked-alt text-green-300 mb-2 block"></i>
                                <div class="text-sm font-bold">MapCodes</div>
                                <div class="text-[10px] opacity-70">å°èˆªä»£ç¢¼æ¸…å–®</div>
                            </button>
                        </div>
                        <div class="flex gap-2">
                             <a href="tel:110" class="flex-1 bg-red-600 hover:bg-red-700 py-3 rounded-xl flex items-center justify-center font-bold transition-colors">
                                <i class="fas fa-phone-alt mr-2"></i> 110 è­¦å¯Ÿ
                             </a>
                             <a href="tel:119" class="flex-1 bg-orange-600 hover:bg-orange-700 py-3 rounded-xl flex items-center justify-center font-bold transition-colors">
                                <i class="fas fa-ambulance mr-2"></i> 119 æ•‘è­·
                             </a>
                        </div>
                    </div>
                </div>

                <!-- Currency Converter -->
                <div class="bg-white rounded-3xl p-6 shadow-md border border-slate-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold text-slate-800">åŒ¯ç‡æ›ç®—</h3>
                        <button @click="resetCurrency" class="w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-500">
                            <i class="fas fa-redo-alt text-xs"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-center mb-6">
                         <span class="text-slate-400 font-medium">1 JPY â‰ˆ 0.22 TWD</span>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-slate-50 rounded-2xl p-4 border border-slate-200 focus-within:border-purple-400 focus-within:ring-2 focus-within:ring-purple-100 transition-all">
                            <label class="text-xs font-bold text-slate-400 mb-1 block">æ—¥å¹£ (JPY)</label>
                            <input type="number" v-model="jpyAmount" @input="calculateTWD" class="w-full text-3xl font-bold bg-transparent border-none p-0 focus:ring-0 text-slate-800 placeholder-slate-300" placeholder="0">
                        </div>
                        <div class="flex justify-center">
                            <i class="fas fa-arrow-down text-purple-300"></i>
                        </div>
                        <div class="bg-purple-50 rounded-2xl p-4 border border-purple-100">
                            <label class="text-xs font-bold text-purple-400 mb-1 block">å°å¹£ (TWD)</label>
                            <div class="text-3xl font-bold text-purple-700">{{ twdAmount }}</div>
                        </div>
                    </div>
                </div>

                <!-- Budget / Expense Tracker (New) -->
                <div class="bg-white rounded-3xl p-6 shadow-md border border-slate-100 mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-slate-800">è¨˜å¸³/é ç®—è¡¨</h3>
                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">Total: Â¥{{ totalExpense.toLocaleString() }}</span>
                    </div>
                    
                    <!-- Input Form -->
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <input v-model="newExpense.item" placeholder="é …ç›®" class="col-span-2 bg-slate-50 rounded-lg px-3 py-2 text-sm border-none focus:ring-1 focus:ring-purple-300">
                        <input v-model.number="newExpense.amount" type="number" placeholder="Â¥é‡‘é¡" class="bg-slate-50 rounded-lg px-3 py-2 text-sm border-none focus:ring-1 focus:ring-purple-300">
                        <button @click="addExpense" class="col-span-3 bg-slate-800 text-white rounded-lg py-2 text-sm font-bold hover:bg-slate-700 transition-colors">
                            <i class="fas fa-plus mr-1"></i> åŠ å…¥æ¶ˆè²»
                        </button>
                    </div>

                    <!-- Expense List -->
                    <div class="space-y-2 max-h-40 overflow-y-auto">
                        <div v-for="(exp, idx) in expenseList" :key="idx" class="flex justify-between items-center text-sm p-2 border-b border-slate-50 last:border-none">
                            <span class="text-slate-600">{{ exp.item }}</span>
                            <div class="flex items-center gap-3">
                                <span class="font-mono font-bold">Â¥{{ exp.amount.toLocaleString() }}</span>
                                <button @click="removeExpense(idx)" class="text-red-400 hover:text-red-600"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <div v-if="expenseList.length === 0" class="text-center text-slate-300 text-xs py-4">å°šæœªæ–°å¢ä»»ä½•ç´€éŒ„</div>
                    </div>
                </div>
            </div>

            <!-- VIEW: INFO -->
            <div v-else-if="currentTab === 'info'" class="pt-4 space-y-4">
                <h2 class="text-2xl font-bold mb-4 text-slate-800 px-2">é‡è¦è³‡è¨Š</h2>
                <!-- Flight Card -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                    <h3 class="text-sm font-bold text-slate-400 mb-3 flex items-center"><i class="fas fa-plane mr-2"></i>èˆªç­è³‡è¨Š (æ˜Ÿå®‡èˆªç©º)</h3>
                    <div class="flex justify-between items-center mb-4 pb-4 border-b border-dashed border-slate-200">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-slate-800">TPE</div>
                            <div class="text-xs text-slate-500">æ¡ƒåœ’</div>
                        </div>
                        <div class="flex-1 flex flex-col items-center px-4">
                            <span class="text-xs text-purple-600 font-bold">JX846</span>
                            <div class="w-full h-px bg-slate-300 relative my-2">
                                <i class="fas fa-plane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-slate-400 text-xs bg-white px-1"></i>
                            </div>
                            <span class="text-xs text-slate-400">2h 00m</span>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-slate-800">KMJ</div>
                            <div class="text-xs text-slate-500">ç†Šæœ¬</div>
                        </div>
                    </div>
                     <div class="bg-slate-50 rounded-lg p-3 flex justify-between items-center">
                        <span class="text-sm font-bold text-slate-600">è¨‚ä½ä»£è™Ÿ</span>
                        <span class="text-lg font-mono font-bold text-purple-600 select-all">D95RG3</span>
                    </div>
                </div>
                <!-- Hotel List -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                     <h3 class="text-sm font-bold text-slate-400 mb-3 flex items-center"><i class="fas fa-hotel mr-2"></i>ä½å®¿æ¸…å–®</h3>
                     <div class="space-y-4">
                         <div v-for="hotel in hotels" :key="hotel.name" class="flex gap-3 items-start">
                             <div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center shrink-0 text-sm font-bold">
                                 {{ hotel.day }}
                             </div>
                             <div class="flex-1">
                                 <h4 class="font-bold text-slate-800 text-sm leading-tight mb-1">{{ hotel.name }}</h4>
                                 <p class="text-xs text-slate-500 mb-1"><i class="fas fa-map-marker-alt mr-1"></i>{{ hotel.address }}</p>
                                 <div class="inline-flex items-center gap-2 bg-slate-50 px-2 py-1 rounded border border-slate-200">
                                     <span class="text-[10px] text-slate-400">é ç´„è™Ÿç¢¼</span>
                                     <span class="text-xs font-mono font-bold text-slate-700 select-all">{{ hotel.code }}</span>
                                 </div>
                             </div>
                         </div>
                     </div>
                </div>
            </div>

            <!-- VIEW: MAPS (Attractions & Backup) -->
            <div v-else-if="currentTab === 'map'" class="pt-4">
                <h2 class="text-2xl font-bold mb-4 text-slate-800 px-2">æ™¯é»å°èˆª</h2>
                
                <!-- Toggle Map Tabs -->
                <div class="flex bg-slate-200 p-1 rounded-xl mb-4 mx-2">
                    <button @click="mapTab = 'route'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', mapTab === 'route' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">è¡Œç¨‹æ™¯é»</button>
                    <button @click="mapTab = 'backup'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', mapTab === 'backup' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">å‚™ç”¨èˆ‡è³¼ç‰©</button>
                </div>

                <!-- Main Route -->
                <div v-if="mapTab === 'route'" class="grid grid-cols-1 gap-3">
                    <div v-for="spot in allSpots" :key="spot.name" class="bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400">
                                <i :class="spot.icon"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">{{ spot.name }}</h4>
                                <span class="text-xs text-slate-500">{{ spot.area }}</span>
                            </div>
                        </div>
                        <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(spot.name)" target="_blank" 
                           class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 transition-colors">
                            <i class="fas fa-location-arrow"></i>
                        </a>
                    </div>
                </div>

                <!-- Backup & Shopping -->
                <div v-if="mapTab === 'backup'" class="space-y-3 pb-8">
                    <div v-for="group in backupSpots" :key="group.category">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 ml-2">{{ group.category }}</h3>
                        <div class="space-y-3">
                             <div v-for="spot in group.items" :key="spot.name" class="bg-white rounded-xl p-3 shadow-sm border border-slate-100">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-sm">{{ spot.name }}</h4>
                                        <p class="text-[10px] text-slate-500 mt-1"><i class="fas fa-map-marker-alt mr-1"></i>{{ spot.address }}</p>
                                    </div>
                                    <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(spot.address)" target="_blank" 
                                       class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 shrink-0">
                                        <i class="fas fa-location-arrow text-sm"></i>
                                    </a>
                                </div>
                                <div class="bg-slate-50 rounded px-2 py-1 flex justify-between items-center" @click="copyText(spot.code)">
                                    <span class="text-[10px] text-slate-400">Navi: é›»è©±/MapCode</span>
                                    <div class="flex items-center gap-1">
                                        <span class="text-xs font-mono font-bold text-slate-700">{{ spot.code }}</span>
                                        <i class="far fa-copy text-[10px] text-slate-400"></i>
                                    </div>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Spacer -->
            <div class="h-10"></div>
        </main>

        <!-- ================= BOTTOM NAVIGATION ================= -->
        <nav class="bg-white/90 backdrop-blur-md border-t border-slate-200 px-6 py-3 flex justify-between items-center z-20 shrink-0 shadow-[0_-5px_10px_rgba(0,0,0,0.02)]">
            <button @click="currentTab = 'home'" :class="navBtnClass('home')">
                <div class="text-xl mb-1"><i class="fas fa-stream"></i></div>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button @click="currentTab = 'map'" :class="navBtnClass('map')">
                <div class="text-xl mb-1"><i class="fas fa-map"></i></div>
                <span class="text-[10px] font-bold">åœ°åœ–</span>
            </button>
            
            <div class="-mt-8">
                <button @click="currentTab = 'list'" class="w-14 h-14 bg-purple-600 rounded-full shadow-lg shadow-purple-300 text-white flex items-center justify-center text-xl hover:scale-105 transition-transform">
                    <i class="fas fa-clipboard-check"></i>
                </button>
            </div>

            <button @click="currentTab = 'tools'" :class="navBtnClass('tools')">
                <div class="text-xl mb-1"><i class="fas fa-toolbox"></i></div>
                <span class="text-[10px] font-bold">å·¥å…·</span>
            </button>
            <button @click="currentTab = 'info'" :class="navBtnClass('info')">
                <div class="text-xl mb-1"><i class="fas fa-passport"></i></div>
                <span class="text-[10px] font-bold">è³‡è¨Š</span>
            </button>
        </nav>

        <!-- ================= MODALS ================= -->
        <!-- Detail Modal -->
        <transition name="fade">
            <div v-if="showModal" class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4" @click.self="showModal = false">
                <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl transform transition-all scale-100">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4 text-purple-600 text-2xl">
                            <i :class="modalData.icon"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800">{{ modalData.title }}</h3>
                        <p class="text-sm text-slate-500 mt-1">{{ modalData.time }}</p>
                    </div>
                    <div v-if="modalData.code" class="bg-slate-50 rounded-xl p-4 mb-4 border border-slate-100 text-center">
                        <p class="text-xs text-slate-400 mb-1">é ç´„/è¨‚ä½ä»£è™Ÿ</p>
                        <p class="text-2xl font-mono font-bold text-slate-800 select-all">{{ modalData.code }}</p>
                    </div>
                    <div class="text-sm text-slate-600 leading-relaxed mb-6">
                        {{ modalData.desc }}
                    </div>
                    <button @click="showModal = false" class="w-full bg-purple-600 text-white font-bold py-3 rounded-xl hover:bg-purple-700 transition-colors">
                        é—œé–‰
                    </button>
                </div>
            </div>
        </transition>

        <!-- MapCode Modal -->
        <transition name="slide-up">
            <div v-if="showMapCodes" class="absolute inset-0 z-50 bg-white flex flex-col">
                <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h3 class="font-bold text-lg"><i class="fas fa-map-marked-alt text-green-500 mr-2"></i>MapCode å°èˆªæ¸…å–®</h3>
                    <button @click="showMapCodes = false" class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-4">
                    <div v-for="code in mapCodes" :key="code.place" class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm flex justify-between items-center">
                        <div>
                            <div class="font-bold text-slate-800">{{ code.place }}</div>
                            <div class="text-xs text-slate-400 mt-1">{{ code.note }}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-mono font-bold text-lg text-slate-700 select-all" @click="copyText(code.code)">{{ code.code }}</div>
                            <div class="text-[10px] text-green-500">é»æ“Šè¤‡è£½</div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Drive Tips Modal -->
        <transition name="slide-up">
            <div v-if="showDriveTips" class="absolute inset-0 z-50 bg-white flex flex-col">
                <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-purple-600 text-white">
                    <h3 class="font-bold text-lg"><i class="fas fa-book mr-2"></i>è‡ªé§•æ‡¶äººåŒ…</h3>
                    <button @click="showDriveTips = false" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-5 space-y-6">
                    <section>
                        <h4 class="font-bold text-purple-700 mb-2 border-l-4 border-purple-500 pl-2">åŠ æ²¹æ”»ç•¥</h4>
                        <ul class="list-disc pl-5 text-sm text-slate-600 space-y-2">
                            <li><span class="text-red-500 font-bold">ç´…è‰²æ²¹æ§ (Regular)</span>ï¼šä¸€èˆ¬ç§Ÿè»ŠåŠ é€™å€‹ (92/95)ã€‚</li>
                            <li><span class="text-yellow-500 font-bold">é»ƒè‰²æ²¹æ§ (High Octane)</span>ï¼šé«˜ç´šè»Šç”¨ã€‚</li>
                            <li><span class="text-green-600 font-bold">ç¶ è‰²æ²¹æ§ (Diesel)</span>ï¼šæŸ´æ²¹ (æ³¨æ„ä¼‘æ—…è»Šå¯èƒ½æ˜¯æŸ´æ²¹)ã€‚</li>
                            <li>å£è¨£ï¼šã€ŒRegular, Mantan (åŠ æ»¿)ã€ã€‚</li>
                        </ul>
                    </section>
                    <section>
                        <h4 class="font-bold text-purple-700 mb-2 border-l-4 border-purple-500 pl-2">é‡è¦äº¤é€šè¦å‰‡</h4>
                        <div class="bg-red-50 p-3 rounded-lg border border-red-100 text-sm text-red-800">
                            <strong>æ­¢ã¾ã‚Œ (Tomare)</strong>ï¼šå€’ä¸‰è§’æ¨™èªŒå‹™å¿…<span class="font-bold underline">å®Œå…¨éœæ­¢ 3 ç§’</span>ï¼Œå·¦å³çœ‹æ²’è»Šå†é–‹ã€‚é€™æ˜¯æœ€å®¹æ˜“è¢«æŠ“çš„é•è¦ï¼
                        </div>
                        <ul class="list-disc pl-5 text-sm text-slate-600 space-y-2 mt-2">
                            <li>å³é§•å·¦è¡Œï¼šé›¨åˆ·åœ¨å·¦ï¼Œæ–¹å‘ç‡ˆåœ¨å³ã€‚</li>
                            <li>è¡Œäººçµ•å°å„ªå…ˆï¼šæ–‘é¦¬ç·šæœ‰äººå¿…é ˆåœã€‚</li>
                            <li>å³è½‰è»Šéœ€ç¦®è®“ç›´è¡Œèˆ‡å·¦è½‰è»Šã€‚</li>
                        </ul>
                    </section>
                </div>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const currentTab = ref('home');
                const listTab = ref('pack');
                const mapTab = ref('route'); // New tab state for Map
                const showModal = ref(false);
                const showMapCodes = ref(false);
                const showDriveTips = ref(false);
                const modalData = ref({});
                const currentDayIndex = ref(1); 
                
                // Mock Weather
                const currentWeather = ref(12);
                const currentLocation = ref('ç¦å²¡');

                // Currency
                const jpyAmount = ref('');
                const twdAmount = ref(0);
                const rate = 0.22;
                const calculateTWD = () => { twdAmount.value = Math.round(jpyAmount.value * rate); };
                const resetCurrency = () => { jpyAmount.value = ''; twdAmount.value = 0; }

                // Expense Tracker
                const newExpense = ref({ item: '', amount: '' });
                const expenseList = ref([]);
                const addExpense = () => {
                    if (newExpense.value.item && newExpense.value.amount) {
                        expenseList.value.push({ ...newExpense.value });
                        newExpense.value.item = '';
                        newExpense.value.amount = '';
                    }
                };
                const removeExpense = (idx) => { expenseList.value.splice(idx, 1); };
                const totalExpense = computed(() => expenseList.value.reduce((sum, item) => sum + item.amount, 0));

                // Countdown
                const tripDate = new Date('2025-12-03');
                const today = new Date();
                const daysUntilTrip = Math.ceil((tripDate - today) / (1000 * 60 * 60 * 24));

                // Data: Hotels
                const hotels = [
                    { day: 'D0', name: 'åŸå¸‚å•†æ—…æ¡ƒåœ’èˆªç©ºé¤¨', address: 'æ¡ƒåœ’å¸‚å¤§åœ’å€ä¸­æ­£æ±è·¯442è™Ÿ', code: 'GTTMMGGZPU' },
                    { day: 'D1', name: 'KOKO HOTEL ç¦å²¡å¤©ç¥', address: 'ç¦å²¡å¸‚ä¸­å¤®å€ä»Šæ³‰ 1-22-14', code: 'IN1437799796' },
                    { day: 'D3', name: 'é»‘å·æº«æ³‰ Yamabiko æ—…é¤¨', address: 'ç†Šæœ¬çœŒé˜¿è˜‡éƒ¡å—å°å›½ç”ºé»’å· 6704', code: 'RYa0kr1u0r' },
                    { day: 'D4', name: 'SOLEST é«˜åƒç©—é£¯åº—', address: 'é«˜åƒç©—ç”ºä¸‰ç”°äº• 1261-1', code: 'AGRJWYNZND' },
                    { day: 'D5', name: 'Candeo Hotels ç†Šæœ¬æ–°å¸‚è¡—', address: 'ç†Šæœ¬å¸‚ä¸­å¤®åŒºæ–°å¸‚è¡— 8-7', code: '3036-3012-3431' }
                ];

                // Data: Map Codes
                const mapCodes = [
                    { place: 'TOYOTA è–¬é™¢é§…å‰åº—', code: '13 287 083*63', note: 'å–è»Šè™•' },
                    { place: 'å¤§è§€å³°å±•æœ›æ‰€', code: '256 878 352*74', note: 'çµ•æ™¯' },
                    { place: 'è‰åƒé‡Œä¹‹æ¿±', code: '256 456 835*36', note: 'é¨é¦¬é«”é©—' },
                    { place: 'é˜¿è˜‡ç«å£', code: '256 456 805*11', note: 'æ”¶è²»é“è·¯å…¥å£' },
                    { place: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾', code: '257 886 475*70', note: 'è¢ç«ä¹‹æ£®å ´æ™¯' },
                    { place: 'é«˜åƒç©—å³½åœè»Šå ´', code: '330 711 731*58', note: 'å¾¡é¹½äº•(æœ€è¿‘)' },
                    { place: 'TOYOTA ç†Šæœ¬ç«™å‰åº—', code: '29 428 586*66', note: 'é‚„è»Šè™•' },
                ];

                // Data: Backup Spots
                const backupSpots = [
                    {
                        category: "ä¼‘æ¯ç«™ (é“ä¹‹é©›)",
                        items: [
                            { name: "é“ä¹‹é©› é˜¿è˜‡", address: "ç†Šæœ¬çœŒé˜¿è˜‡å¸‚é»’å·1440-1", code: "0967-35-5077" },
                            { name: "é“ä¹‹é©› ä¸ƒåŸMelon Dome", address: "ç†Šæœ¬çœŒèŠæ± å¸‚ä¸ƒåŸç”ºå²¡ç”°306", code: "0968-25-5757" }
                        ]
                    },
                    {
                        category: "è³¼ç‰© (Bic Camera / Yodobashi)",
                        items: [
                            { name: "Bic Camera å¤©ç¥1è™Ÿé¤¨", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºä»Šæ³‰1-25-1", code: "092-732-1112" },
                            { name: "Bic Camera å¤©ç¥2è™Ÿé¤¨", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥2-4-5", code: "092-732-1111" },
                            { name: "Bic Camera ç†Šæœ¬åº—", address: "ç†Šæœ¬å¸‚è¥¿åŒºæ˜¥æ—¥3-15-60", code: "096-323-1111" },
                            { name: "Yodobashi åšå¤š", address: "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…ä¸­å¤®è¡—6-12", code: "092-471-1010" }
                        ]
                    },
                    {
                        category: "è³¼ç‰© (å”å‰è¨¶å¾·)",
                        items: [
                            { name: "å”å‰è¨¶å¾· ç¦å²¡å¤©ç¥æœ¬åº—", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºä»Šæ³‰1-20-17", code: "092-736-5911" },
                            { name: "å”å‰è¨¶å¾· åšå¤šç«™å—åº—", address: "ç¦å²¡å¸‚åšå¤šåŒºæ±å…‰å¯ºç”º2-6-40", code: "092-432-6511" },
                            { name: "å”å‰è¨¶å¾· åšå¤šä¸¸äº•åº—", address: "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…ä¸­å¤®è¡—9-1 3F", code: "092-433-3811" },
                            { name: "å”å‰è¨¶å¾· ç†Šæœ¬ä¸‹é€šåº—", address: "ç†Šæœ¬å¸‚ä¸­å¤®åŒºå®‰æ”¿ç”º5-27", code: "096-324-5511" },
                            { name: "å”å‰è¨¶å¾· å—ç†Šæœ¬åº—", address: "ç†Šæœ¬å¸‚ä¸­å¤®åŒºå—ç†Šæœ¬1-9-25", code: "096-375-6511" }
                        ]
                    },
                    {
                        category: "ç¾é£Ÿå‚™æ¡ˆ",
                        items: [
                            { name: "æ²»ä¸€éƒå¸ƒä¸ (åšå¤šç«™)", address: "JRåšå¤šåŸ AMU PLAZA B1F", code: "092-409-6720" },
                            { name: "éºµå±‹å…¼è™ å¤©ç¥æœ¬åº—", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºæ¸¡è¾ºé€š4-9-18", code: "092-726-7121" },
                            { name: "éºµå±‹å…¼è™ ç¦å²¡PARCO", address: "ç¦å²¡PARCOæœ¬é¤¨ B1F", code: "092-235-7226" },
                            { name: "éºµå±‹å…¼è™ åšå¤šåº—", address: "åšå¤šDeitos 2F æ‹‰éºµè¡—é“", code: "092-477-3113" },
                            { name: "ç‚¸è±¬æ’ WAKABA", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥1-15-36", code: "092-732-1209" }
                        ]
                    },
                    {
                        category: "è¥¿æ‘è£•äºŒå•†å“",
                        items: [
                            { name: "ç¦å²¡å¤©ç¥ LOFT", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºæ¸¡è¾ºé€š4-9-25", code: "092-724-6210" },
                            { name: "Animate ç¦å²¡Parco", address: "ç¦å²¡PARCOæœ¬é¤¨ 8F", code: "092-732-8070" },
                            { name: "Village Vanguard", address: "ç¦å²¡PARCOæœ¬é¤¨ 7F (é€šå¸¸ä½ç½®)", code: "éœ€ç¢ºèªåˆ†åº—" }
                        ]
                    }
                ];

                // Data: Packing List
                const packList = ref([
                    { text: 'è­·ç…§ (å…¨å®¶)', sub: 'æ•ˆæœŸéœ€ > 6å€‹æœˆ', checked: false },
                    { text: 'é§•ç…§æ­£æœ¬ + æ—¥æ–‡è­¯æœ¬', sub: 'ç§Ÿè»Šå¿…å‚™ï¼', checked: false },
                    { text: 'VJW QR Code æˆªåœ–', sub: 'æµ·é—œ/ç§»æ°‘å®˜', checked: false },
                    { text: 'ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜)', sub: 'JCBä½³', checked: false },
                    { text: 'ç¶²å¡ / æ¼«éŠé–‹é€š', sub: 'ç¢ºèªè¨Šè™Ÿ', checked: false },
                    { text: 'è¡Œå‹•é›»æº + ç·š', sub: 'æ‰‹æä¸Šæ©Ÿ', checked: false },
                    { text: 'ä¿æš–è¡£ç‰©', sub: 'æ´‹è”¥å¼ç©¿æ³•', checked: false },
                ]);

                const addPackItem = () => {
                    const text = prompt('è¼¸å…¥æ–°é …ç›®:');
                    if(text) packList.value.push({ text, sub: 'æ–°å¢é …ç›®', checked: false });
                };

                // Data: Shopping List
                const shoppingList = ref([
                    { name: 'åˆåˆ©ä»–å‘½ EX Plus', note: 'å¹«çˆ¸åª½è²·', img: '' },
                    { name: 'ç¦å²¡è‰è“', note: 'é£¯åº—åƒ', img: '' },
                ]);
                
                const addShopItem = () => {
                    shoppingList.value.push({ name: '', note: '', img: '' });
                };
                const removeShopItem = (idx) => {
                    shoppingList.value.splice(idx, 1);
                };

                // Data: Timeline
                const timelineData = [
                    {
                        date: '12/2 (äºŒ)', location: 'æ¡ƒåœ’',
                        events: [
                            { time: '22:11', title: 'é«˜éµå‡ºç™¼', type: 'train', icon: 'fas fa-train', desc: 'è‡ºå—ç«™(696) â†’ æ¡ƒåœ’ç«™', location: 'é«˜éµæ¡ƒåœ’ç«™' },
                            { time: '23:30', title: 'é£¯åº— Check-in', type: 'hotel', icon: 'fas fa-bed', desc: 'åŸå¸‚å•†æ—…æ¡ƒåœ’èˆªç©ºé¤¨', location: 'åŸå¸‚å•†æ—…æ¡ƒåœ’èˆªç©ºé¤¨', code: 'GTTMMGGZPU' }
                        ]
                    },
                    {
                        date: '12/3 (ä¸‰)', location: 'ç†Šæœ¬/ç¦å²¡',
                        events: [
                            { time: '07:30', title: 'æ­æ©Ÿå‰å¾€ç†Šæœ¬', type: 'plane', icon: 'fas fa-plane-departure', desc: 'æ˜Ÿå®‡ JX846ã€‚å»ºè­° 05:30 æŠµé”æ©Ÿå ´ã€‚', code: 'D95RG3' },
                            { time: '11:30', title: 'æŠµé” & ç§»å‹•', type: 'bus', icon: 'fas fa-bus', desc: 'æ©Ÿå ´å·´å£« â†’ ç†Šæœ¬é§… (ç´„1hr)', location: 'é˜¿è˜‡ç†Šæœ¬æ©Ÿå ´' },
                            { time: '12:30', title: 'åˆé¤: ç«è»Šä¾¿ç•¶', type: 'food', icon: 'fas fa-bento', tag: 'ç‰¹è‰²', desc: 'åœ¨ç†Šæœ¬é§…è³¼è²·ç•¶åœ°ç‰¹è‰²Ekibenã€‚', location: 'ç†Šæœ¬é§…' },
                            { time: '13:00', title: 'æ–°å¹¹ç·š â†’ åšå¤š', type: 'train', icon: 'fas fa-subway', desc: 'è¨˜å¾—é ç´„ã€Œç‰¹å¤§è·ç‰©å¸­ã€ã€‚', location: 'ç†Šæœ¬é§…' },
                            { time: '15:30', title: 'æ«›ç”°ç¥ç¤¾ & å·ç«¯é€š', type: 'sight', icon: 'fas fa-torii-gate', desc: 'åšå¤šç¸½é®å®ˆï¼Œå¿…çœ‹å·¨å¤§å±±ç¬ ã€‚å•†åº—è¡—åƒç´…è±†éº»ç³¬æ¹¯ã€‚', location: 'æ«›ç”°ç¥ç¤¾' },
                            { time: '18:00', title: 'æ™šé¤: ç‚¸è±¬æ’/æ‹‰éºµ', type: 'food', icon: 'fas fa-utensils', tag: 'å¿…åƒ', desc: 'æ¨è–¦ã€Œç‚¸è±¬æ’ WAKABAã€æˆ–ã€Œéºµå±‹å…¼è™ã€ã€‚', location: 'ç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥1-15-36' }
                        ]
                    },
                    {
                        date: '12/4 (å››)', location: 'å¤ªå®°åºœ',
                        events: [
                            { time: '10:00', title: 'ç«ˆé–€ç¥ç¤¾', type: 'sight', icon: 'fas fa-leaf', tag: 'è³æ¥“', desc: 'é¬¼æ»…è–åœ° + è³æ¥“åæ‰€ã€‚éœ€æ­å·´å£«å‰å¾€ã€‚', location: 'ç«ˆé–€ç¥ç¤¾' },
                            { time: '11:30', title: 'å¤ªå®°åºœå¤©æ»¿å®®', type: 'sight', icon: 'fas fa-torii-gate', desc: 'åƒé“åƒæ¢…æé¤…ï¼Œçœ‹éšˆç ”å¾æ˜Ÿå·´å…‹ã€‚', location: 'å¤ªå®°åºœå¤©æ»¿å®®' },
                            { time: '12:30', title: 'åˆé¤: ä¸€è˜­æ‹‰éºµ', type: 'food', icon: 'fas fa-utensils', tag: 'ç‰¹è‰²', desc: 'å¤ªå®°åºœåƒé“åº—ï¼Œå¿…é»ã€Œäº”è§’å½¢åˆæ ¼ç¢—ã€ã€‚', location: 'ä¸€è˜­ å¤ªå®°åºœå‚é“åº—' },
                            { time: '18:00', title: 'æ™šé¤: Shin-Shin', type: 'food', icon: 'fas fa-utensils', tag: 'æ’éšŠåº—', desc: 'åšå¤šæ‹‰éºµååº—ï¼Œå»ºè­°é¿é–‹å°–å³°ã€‚', location: 'åšå¤šã‚‰ãƒ¼ã‚ã‚“ Shin-Shin å¤©ç¥æœ¬åº—' }
                        ]
                    },
                    {
                        date: '12/5 (äº”)', location: 'é˜¿è˜‡',
                        events: [
                            { time: '10:00', title: 'ç§Ÿè»Šå‡ºç™¼', type: 'car', icon: 'fas fa-car', tag: 'è‡ªé§•', desc: 'TOYOTA è–¬é™¢é§…å‰åº—ã€‚æª¢æŸ¥é›ªèƒ/ETCã€‚', location: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ è–¬é™¢é§…å‰', code: 'MapCode: 13 287 083*63' },
                            { time: '13:00', title: 'å¤§è§€å³°å±•æœ›æ‰€', type: 'sight', icon: 'fas fa-mountain', desc: '360åº¦çœºæœ›é˜¿è˜‡äº”å²³èˆ‡ç ´ç«å±±å£ã€‚', location: 'å¤§è§€å³°' },
                            { time: '14:30', title: 'è‰åƒé‡Œ & ç«å£', type: 'sight', icon: 'fas fa-volcano', desc: 'çœ‹ç«å±±æ°£é«”ç‹€æ³ã€‚è‰åƒé‡Œä¸€ç‰‡é‡‘é»ƒã€‚', location: 'é˜¿è˜‡è‰åƒé‡Œ' },
                            { time: '17:00', title: 'Check-in é»‘å·æº«æ³‰', type: 'hotel', icon: 'fas fa-hot-tub', desc: 'Yamabiko æ—…é¤¨ï¼Œäº«å—éœ²å¤©ä»™äººé¢¨å‘‚ã€‚', location: 'é»’å·æ¸©æ³‰ ã‚„ã¾ã³ã“æ—…é¤¨', code: 'RYa0kr1u0r' }
                        ]
                    },
                    {
                        date: '12/6 (å…­)', location: 'é«˜åƒç©—',
                        events: [
                            { time: '09:30', title: 'ç§»å‹• â†’ å—é˜¿è˜‡', type: 'car', icon: 'fas fa-car', desc: 'æ³¨æ„è·¯é¢æ˜¯å¦çµå†°ã€‚' },
                            { time: '10:30', title: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾', type: 'sight', icon: 'fas fa-tree', tag: 'ç§˜å¢ƒ', desc: 'é€šå¾€ç•°ä¸–ç•Œçš„åƒé“ï¼Œè¢ç«ä¹‹æ£®å ´æ™¯ã€‚', location: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾' },
                            { time: '14:00', title: 'å¤©å²©æˆ¶ç¥ç¤¾', type: 'sight', icon: 'fas fa-praying-hands', desc: 'æœ€å¼·èƒ½é‡é»ï¼Œæ­¥è¡Œè‡³å¤©å®‰æ²³åŸè¨±é¡˜ã€‚', location: 'å¤©å²©æˆ¶ç¥ç¤¾' },
                            { time: '16:00', title: 'é£¯åº— Check-in', type: 'hotel', icon: 'fas fa-bed', desc: 'SOLEST é«˜åƒç©—é£¯åº—', location: 'ã‚½ãƒ¬ã‚¹ãƒˆé«˜åƒç©‚ãƒ›ãƒ†ãƒ«', code: 'AGRJWYNZND' },
                            { time: '18:00', title: 'æ™šé¤: ç‡’è‚‰ å’Œ', type: 'food', icon: 'fas fa-drumstick-bite', tag: 'å¿…åƒ', desc: 'é«˜åƒç©—ç‰›ååº—ï¼Œå‹™å¿…æº–æ™‚ã€‚', location: 'é«˜åƒç©‚ç‰›ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å’Œ', code: '0982-73-1109' },
                            { time: '20:00', title: 'å¤œç¥æ¨‚', type: 'sight', icon: 'fas fa-theater-masks', desc: 'é«˜åƒç©—ç¥ç¤¾ï¼Œæ¬£è³å‚³çµ±ç¥è©±è¡¨æ¼”ã€‚', location: 'é«˜åƒç©—ç¥ç¤¾' }
                        ]
                    },
                    {
                        date: '12/7 (æ—¥)', location: 'ç†Šæœ¬',
                        events: [
                            { time: '09:00', title: 'é«˜åƒç©—å³½åˆ’èˆ¹', type: 'sight', icon: 'fas fa-water', tag: 'é ç´„', desc: 'åœå¾¡é¹½äº•åœè»Šå ´ã€‚çœ‹çœŸåäº•ç€‘å¸ƒã€‚', location: 'é«˜åƒç©—å³½' },
                            { time: '14:00', title: 'ç†Šæœ¬é‚„è»Š', type: 'car', icon: 'fas fa-check-circle', desc: 'TOYOTA ç†Šæœ¬ç«™å‰åº—ã€‚è¨˜å¾—åŠ æ»¿æ²¹ï¼', location: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç†Šæœ¬é§…å‰' },
                            { time: '15:00', title: 'Check-in é£¯åº—', type: 'hotel', icon: 'fas fa-bed', desc: 'Candeo Hotels é ‚æ¨“æœ‰å¤©ç©ºSPAã€‚', location: 'ã‚«ãƒ³ãƒ‡ã‚ªãƒ›ãƒ†ãƒ«ã‚ºç†Šæœ¬æ–°å¸‚è¡—' },
                            { time: '18:00', title: 'æ™šé¤: å‹çƒˆäº­', type: 'food', icon: 'fas fa-utensils', tag: 'å¿…åƒ', desc: 'ç†Šæœ¬å¿…åƒç‚¸è±¬æ’ï¼Œå°±åœ¨æ–°å¸‚è¡—ã€‚', location: 'å‹çƒˆäº­ æ–°å¸‚è¡—æœ¬åº—' }
                        ]
                    },
                    {
                        date: '12/8 (ä¸€)', location: 'ç†Šæœ¬å¸‚å€',
                        events: [
                            { time: '09:30', title: 'ç†Šæœ¬åŸ & åŠ è—¤ç¥ç¤¾', type: 'sight', icon: 'fas fa-chess-rook', desc: 'å¤©å®ˆé–£èˆ‡éŠ€ææ¨¹ã€‚', location: 'ç†Šæœ¬åŸ' },
                            { time: '12:00', title: 'åˆé¤: åŸå½©è‹‘', type: 'food', icon: 'fas fa-ice-cream', desc: 'é«”é©—æ±Ÿæˆ¶é¢¨æƒ…ï¼Œåƒæµ·è†½å¯æ¨‚é¤…ã€‚', location: 'æ¡œã®é¦¬å ´ åŸå½©è‹‘' },
                            { time: '14:30', title: 'æ°´å‰å¯ºæˆè¶£åœ’', type: 'sight', icon: 'fas fa-leaf', desc: 'å„ªé›…çš„æ—¥å¼åº­åœ’ã€‚', location: 'æ°´å‰å¯ºæˆè¶£åœ’' },
                            { time: '16:00', title: 'ä¸Šä¸‹é€šå•†åº—è¡—', type: 'shopping', icon: 'fas fa-shopping-bag', tag: 'è³¼ç‰©', desc: 'è—¥å¦ã€ä¼´æ‰‹ç¦®æœ€å¾Œè¡åˆºã€‚', location: 'ä¸‹é€šå•†åº—è¡—' }
                        ]
                    },
                     {
                        date: '12/9 (äºŒ)', location: 'è¿”å°',
                        events: [
                            { time: '09:30', title: 'å‰å¾€æ©Ÿå ´', type: 'bus', icon: 'fas fa-bus', desc: 'å¾æ«»ç”ºå·´å£«ç¸½ç«™æ­è»Šã€‚', location: 'ç†Šæœ¬æ«»ç”ºå·´å£«ç¸½ç«™' },
                            { time: '11:45', title: 'é£›å¾€æ¡ƒåœ’', type: 'plane', icon: 'fas fa-plane-departure', desc: 'æ˜Ÿå®‡ JX847ã€‚', code: 'D95RG3' },
                             { time: '15:43', title: 'é«˜éµè¿”å°å—', type: 'train', icon: 'fas fa-train', desc: 'è»Šæ¬¡ 655ã€‚', location: 'é«˜éµæ¡ƒåœ’ç«™' }
                        ]
                    }
                ];

                // --- Methods ---
                const getIconColor = (type) => {
                    const colors = {
                        plane: 'bg-blue-400 border-blue-100',
                        train: 'bg-indigo-400 border-indigo-100',
                        bus: 'bg-teal-400 border-teal-100',
                        car: 'bg-yellow-400 border-yellow-100',
                        hotel: 'bg-purple-500 border-purple-100',
                        food: 'bg-orange-400 border-orange-100',
                        sight: 'bg-pink-400 border-pink-100',
                        shopping: 'bg-red-400 border-red-100'
                    };
                    return colors[type] || 'bg-gray-400';
                };

                const getTagColor = (tag) => {
                    if (tag === 'å¿…åƒ') return 'bg-orange-100 text-orange-600';
                    if (tag === 'è‡ªé§•') return 'bg-blue-100 text-blue-600';
                    if (tag === 'é ç´„') return 'bg-red-100 text-red-600';
                    if (tag === 'è³¼ç‰©') return 'bg-yellow-100 text-yellow-700';
                    if (tag === 'ç‰¹è‰²') return 'bg-green-100 text-green-700';
                    return 'bg-gray-100 text-gray-600';
                };

                const navBtnClass = (tab) => {
                    return `flex flex-col items-center justify-center w-full h-full transition-colors ${currentTab.value === tab ? 'text-purple-600' : 'text-slate-400 hover:text-slate-600'}`;
                };

                const scrollToDay = (index) => {
                    currentDayIndex.value = index;
                    const el = document.getElementById(`day-${index}`);
                    if (el) {
                        const mainContent = document.getElementById('main-content');
                        mainContent.scrollTo({
                            top: el.offsetTop - 20,
                            behavior: 'smooth'
                        });
                    }
                };

                const handleCardClick = (event) => {
                    if (event.code || event.detail) {
                        openDetailModal(event);
                    }
                };

                const openDetailModal = (event) => {
                    modalData.value = {
                        title: event.title,
                        time: event.time,
                        desc: event.desc,
                        icon: event.icon,
                        code: event.code || ''
                    };
                    showModal.value = true;
                };

                const copyText = (text) => {
                    navigator.clipboard.writeText(text).then(() => {
                        alert(`å·²è¤‡è£½: ${text}`);
                    });
                };

                const highlightText = (text) => {
                    return text.replace(/(å¿…åƒ|å¿…é»|å¿…è²·)/g, '<span class="text-orange-500 font-bold">$1</span>');
                };

                const allSpots = computed(() => {
                    const spots = [];
                    timelineData.forEach(day => {
                        day.events.forEach(event => {
                            if (event.location) {
                                spots.push({
                                    name: event.location,
                                    area: day.location,
                                    icon: event.icon
                                });
                            }
                        });
                    });
                    return spots;
                });

                return {
                    currentTab, listTab, mapTab, showModal, showMapCodes, showDriveTips, modalData,
                    currentWeather, currentLocation, daysUntilTrip,
                    jpyAmount, twdAmount, calculateTWD, resetCurrency,
                    newExpense, expenseList, addExpense, removeExpense, totalExpense,
                    timelineData, hotels, mapCodes, packList, shoppingList, backupSpots,
                    addPackItem, addShopItem, removeShopItem,
                    getIconColor, getTagColor, navBtnClass, scrollToDay, currentDayIndex,
                    handleCardClick, openDetailModal, copyText, highlightText, allSpots
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
