<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 ä¹å·è³æ¥“è‡ªé§•è¡Œ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* Animations */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        .slide-up-enter-active, .slide-up-leave-active {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .slide-up-enter-from, .slide-up-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }

        /* Timeline Connector */
        .timeline-line {
            position: absolute;
            left: 1.25rem;
            top: 2rem;
            bottom: -2rem;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
        .last-item .timeline-line {
            display: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-[100dvh] flex flex-col overflow-hidden">

    <div id="app" class="flex flex-col h-full w-full max-w-md mx-auto bg-white shadow-2xl relative overflow-hidden">

        <!-- ================= HERO SECTION (Only on Home) ================= -->
        <header v-if="currentTab === 'home'" class="relative bg-gradient-to-br from-purple-600 to-indigo-700 text-white p-6 pb-12 rounded-b-[2.5rem] shadow-lg z-10 shrink-0 transition-all duration-500">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-xs font-medium opacity-80 bg-white/20 px-2 py-1 rounded-full inline-block mb-2">2025 TRIP</div>
                    <h1 class="text-3xl font-bold tracking-tight">ä¹å·è³æ¥“<br>è‡ªé§•ä¹‹æ—… ğŸ</h1>
                </div>
                <!-- Weather Widget (Dynamic based on selected day) -->
                <div class="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-2xl p-3 border border-white/20 shadow-lg min-w-[80px]">
                    <i :class="currentDayInfo.weather.icon + ' text-yellow-300 text-2xl mb-1'"></i>
                    <span class="text-2xl font-bold">{{ currentDayInfo.weather.temp }}Â°</span>
                    <span class="text-xs opacity-80 text-center whitespace-nowrap">{{ currentDayInfo.location }}</span>
                </div>
            </div>

            <!-- Countdown -->
            <div class="flex items-center gap-2 text-sm opacity-90 mb-4">
                <i class="far fa-calendar-alt"></i>
                <span>{{ currentDayInfo.date }}</span>
                <span v-if="currentDayIndex === 0" class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full ml-2 animate-pulse">
                    é‚„æœ‰ {{ daysUntilTrip }} å¤©
                </span>
            </div>

            <!-- Day Selector -->
            <div class="flex overflow-x-auto gap-3 pb-2 -mx-2 px-2 no-scrollbar scroll-smooth">
                <button 
                    v-for="(day, index) in timelineData" 
                    :key="index"
                    @click="scrollToDay(index)"
                    :class="['flex-shrink-0 w-14 h-16 rounded-xl flex flex-col items-center justify-center transition-all border-2 cursor-pointer', 
                             currentDayIndex === index ? 'bg-white text-purple-700 border-white scale-105 shadow-md' : 'bg-white/10 text-white border-transparent hover:bg-white/20']"
                >
                    <span class="text-xs opacity-70">Day</span>
                    <span class="text-lg font-bold">{{ index }}</span>
                </button>
            </div>
        </header>

        <!-- ================= MAIN CONTENT AREA ================= -->
        <main class="flex-1 overflow-y-auto pb-32 pt-4 px-4 bg-slate-50 relative scroll-smooth" id="main-content">
            
            <!-- VIEW: HOME (Timeline) -->
            <div v-if="currentTab === 'home'">
                <div v-for="(day, dayIndex) in timelineData" :key="dayIndex" :id="'day-' + dayIndex" class="mb-8">
                    <!-- Day Header with Weather -->
                    <div class="sticky top-0 bg-slate-50/95 backdrop-blur py-3 z-10 border-b border-slate-100 mb-4 transition-all">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-2 h-8 bg-purple-600 rounded-r-lg"></div>
                                <div>
                                    <h2 class="text-xl font-bold text-slate-800 leading-none">
                                        Day {{ dayIndex }} 
                                    </h2>
                                    <span class="text-xs font-normal text-slate-500">{{ day.date }}</span>
                                </div>
                            </div>
                            <!-- Daily Weather Inline -->
                            <div class="flex items-center gap-2 bg-white px-3 py-1 rounded-full shadow-sm border border-slate-100">
                                <i :class="day.weather.icon + ' text-yellow-500'"></i>
                                <span class="text-sm font-bold text-slate-700">{{ day.weather.temp }}Â°C</span>
                                <span class="text-xs text-slate-400">{{ day.weather.desc }}</span>
                            </div>
                        </div>
                        <div class="ml-5 mt-1">
                            <span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">{{ day.location }}</span>
                        </div>
                    </div>

                    <!-- Timeline Events -->
                    <div class="relative pl-2">
                        <div v-for="(event, eventIndex) in day.events" :key="eventIndex" class="relative pl-8 pb-8 group last-item">
                            <!-- Line -->
                            <div class="timeline-line group-last:hidden"></div>
                            
                            <!-- Icon -->
                            <div class="absolute left-0 top-1 w-10 h-10 rounded-full flex items-center justify-center border-4 border-slate-50 shadow-sm z-10"
                                 :class="getIconColor(event.type)">
                                <i :class="event.icon + ' text-white text-sm'"></i>
                            </div>

                            <!-- Card -->
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 active:scale-[0.98] transition-transform cursor-pointer" @click="handleCardClick(event)">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="text-sm font-bold text-slate-400 font-mono">{{ event.time }}</span>
                                    <div class="flex gap-1">
                                        <span v-if="event.tag" :class="getTagColor(event.tag)" class="text-[10px] px-2 py-1 rounded-full font-bold">
                                            {{ event.tag }}
                                        </span>
                                    </div>
                                </div>
                                <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight">{{ event.title }}</h3>
                                <p v-if="event.desc" class="text-sm text-slate-500 mb-2 leading-relaxed" v-html="highlightText(event.desc)"></p>
                                
                                <!-- Meta/Actions -->
                                <div class="flex flex-wrap gap-2 mt-3">
                                    <a v-if="event.location" :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(event.location)" target="_blank" @click.stop 
                                       class="inline-flex items-center gap-1 text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1.5 rounded-lg transition-colors">
                                        <i class="fas fa-map-marker-alt text-red-500"></i> å°èˆª
                                    </a>
                                    
                                    <!-- Story Button (Opens Modal) -->
                                    <button v-if="event.story" @click.stop="openStoryModal(event)" 
                                       class="inline-flex items-center gap-1 text-xs bg-orange-50 hover:bg-orange-100 text-orange-600 px-3 py-1.5 rounded-lg transition-colors border border-orange-100">
                                        <i class="fas fa-book-open"></i> æ•…äº‹
                                    </button>

                                    <button v-if="event.code || event.detail" @click.stop="openDetailModal(event)" 
                                            class="inline-flex items-center gap-1 text-xs bg-purple-50 text-purple-700 px-3 py-1.5 rounded-lg border border-purple-100">
                                        <i class="fas fa-info-circle"></i> {{ event.code ? 'æŸ¥çœ‹ä»£è™Ÿ' : 'è©³ç´°è³‡è¨Š' }}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Add Event Button for this day -->
                        <div class="pl-8 pb-4">
                            <button @click="promptAddEvent(dayIndex)" class="w-full py-3 rounded-xl border-2 border-dashed border-slate-300 text-slate-400 hover:text-purple-600 hover:border-purple-300 hover:bg-purple-50 transition-all flex items-center justify-center text-sm font-bold">
                                <i class="fas fa-plus mr-2"></i> æ–°å¢è¡Œç¨‹è‡³ Day {{ dayIndex }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LIST (Checklist) -->
            <div v-else-if="currentTab === 'list'" class="pt-4">
                <h2 class="text-2xl font-bold mb-6 text-slate-800 px-2">è¡Œå‰èˆ‡è³¼ç‰©</h2>
                <div class="flex bg-slate-200 p-1 rounded-xl mb-6">
                    <button @click="listTab = 'pack'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', listTab === 'pack' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">è¡Œå‰æ‰“åŒ…</button>
                    <button @click="listTab = 'buy'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', listTab === 'buy' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">å¾…è²·æ¸…å–®</button>
                </div>

                <!-- Packing List -->
                <div v-if="listTab === 'pack'" class="space-y-3">
                    <div v-for="(item, idx) in packList" :key="idx" 
                         class="flex items-center bg-white p-4 rounded-xl shadow-sm border border-slate-100 cursor-pointer"
                         @click="item.checked = !item.checked">
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 transition-colors"
                             :class="item.checked ? 'bg-green-500 border-green-500' : 'border-slate-300'">
                            <i v-if="item.checked" class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <p :class="['font-medium transition-all', item.checked ? 'text-slate-400 line-through' : 'text-slate-800']">{{ item.text }}</p>
                            <p class="text-xs text-slate-400">{{ item.sub }}</p>
                        </div>
                    </div>
                    <button @click="addPackItem" class="w-full py-4 rounded-xl border-2 border-dashed border-slate-300 text-slate-400 font-bold hover:bg-slate-50 hover:border-purple-300 hover:text-purple-500 transition-all">
                        <i class="fas fa-plus mr-2"></i> æ–°å¢é …ç›®
                    </button>
                </div>

                <!-- Shopping List -->
                <div v-if="listTab === 'buy'" class="grid grid-cols-2 gap-4">
                    <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-xl overflow-hidden shadow-sm relative group">
                        <div class="h-32 bg-slate-200 flex items-center justify-center relative overflow-hidden">
                            <img v-if="item.img" :src="item.img" class="w-full h-full object-cover">
                            <i v-else class="fas fa-camera text-slate-400 text-2xl"></i>
                            <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                                <span class="text-white text-xs font-bold">æ›´æ›ç…§ç‰‡</span>
                            </div>
                        </div>
                        <div class="p-3">
                            <input v-model="item.name" class="w-full font-bold text-slate-800 bg-transparent border-none p-0 focus:ring-0 placeholder-slate-400" placeholder="è¼¸å…¥å•†å“å">
                            <input v-model="item.note" class="w-full text-xs text-slate-500 bg-transparent border-none p-0 focus:ring-0 placeholder-slate-300 mt-1" placeholder="å‚™è¨» (å¦‚: è—¥å¦)">
                        </div>
                        <button @click="removeShopItem(idx)" class="absolute top-2 right-2 w-6 h-6 bg-red-500 rounded-full text-white text-xs flex items-center justify-center shadow-md">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button @click="addShopItem" class="h-48 rounded-xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center text-slate-400 hover:bg-slate-50 hover:border-purple-300 hover:text-purple-500 transition-all">
                        <i class="fas fa-camera text-2xl mb-2"></i>
                        <span class="text-sm font-bold">æ–°å¢å•†å“</span>
                    </button>
                </div>
            </div>

            <!-- VIEW: TOOLS (Currency, Driving & Budget) -->
            <div v-else-if="currentTab === 'tools'" class="pt-4 space-y-6">
                
                <!-- Driving HUD -->
                <div class="bg-slate-900 text-white rounded-3xl p-6 shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500 rounded-full blur-3xl opacity-20 -mr-10 -mt-10 pointer-events-none"></div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold italic"><i class="fas fa-car mr-2"></i>DRIVER HUD</h3>
                            <span class="bg-yellow-500 text-black text-xs font-bold px-2 py-1 rounded">è‡ªé§•æ¨¡å¼</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <button @click="showDriveTips = true" class="bg-white/10 hover:bg-white/20 p-3 rounded-xl text-left transition-colors border border-white/5 active:bg-white/30 cursor-pointer">
                                <i class="fas fa-book text-blue-300 mb-2 block"></i>
                                <div class="text-sm font-bold">è‡ªé§•æ‡¶äººåŒ…</div>
                                <div class="text-[10px] opacity-70">åŠ æ²¹/å ±è­¦SOP</div>
                            </button>
                            <button @click="showMapCodes = true" class="bg-white/10 hover:bg-white/20 p-3 rounded-xl text-left transition-colors border border-white/5 active:bg-white/30 cursor-pointer">
                                <i class="fas fa-map-marked-alt text-green-300 mb-2 block"></i>
                                <div class="text-sm font-bold">MapCodes</div>
                                <div class="text-[10px] opacity-70">å°èˆªä»£ç¢¼æ¸…å–®</div>
                            </button>
                        </div>
                        <div class="flex gap-2">
                             <a href="tel:110" class="flex-1 bg-red-600 hover:bg-red-700 py-3 rounded-xl flex items-center justify-center font-bold transition-colors active:scale-95">
                                <i class="fas fa-phone-alt mr-2"></i> 110 è­¦å¯Ÿ
                             </a>
                             <a href="tel:119" class="flex-1 bg-orange-600 hover:bg-orange-700 py-3 rounded-xl flex items-center justify-center font-bold transition-colors active:scale-95">
                                <i class="fas fa-ambulance mr-2"></i> 119 æ•‘è­·
                             </a>
                        </div>
                    </div>
                </div>

                <!-- Currency Converter -->
                <div class="bg-white rounded-3xl p-6 shadow-md border border-slate-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold text-slate-800">åŒ¯ç‡æ›ç®—</h3>
                        <button @click="resetCurrency" class="w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-500">
                            <i class="fas fa-redo-alt text-xs"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-center mb-6">
                         <span class="text-slate-400 font-medium">1 JPY â‰ˆ 0.22 TWD</span>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-slate-50 rounded-2xl p-4 border border-slate-200 focus-within:border-purple-400 focus-within:ring-2 focus-within:ring-purple-100 transition-all">
                            <label class="text-xs font-bold text-slate-400 mb-1 block">æ—¥å¹£ (JPY)</label>
                            <input type="number" v-model="jpyAmount" @input="calculateTWD" class="w-full text-3xl font-bold bg-transparent border-none p-0 focus:ring-0 text-slate-800 placeholder-slate-300" placeholder="0">
                        </div>
                        <div class="flex justify-center">
                            <i class="fas fa-arrow-down text-purple-300"></i>
                        </div>
                        <div class="bg-purple-50 rounded-2xl p-4 border border-purple-100">
                            <label class="text-xs font-bold text-purple-400 mb-1 block">å°å¹£ (TWD)</label>
                            <div class="text-3xl font-bold text-purple-700">{{ twdAmount }}</div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Expense Tracker (With Payer) -->
                <div class="bg-white rounded-3xl p-6 shadow-md border border-slate-100 mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-lg font-bold text-slate-800">è¨˜å¸³/é ç®—è¡¨</h3>
                    </div>
                    
                    <!-- Expense Summary -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <div class="bg-blue-50 p-2 rounded-lg text-center border border-blue-100">
                            <div class="text-[10px] text-blue-500 font-bold mb-1">å¥•éŠ“ ({{ formatMoney(personStats.YiQuan) }})</div>
                            <div class="h-1 bg-blue-200 rounded-full w-full">
                                <div class="h-full bg-blue-500 rounded-full" :style="{width: getPercent(personStats.YiQuan) + '%'}"></div>
                            </div>
                        </div>
                        <div class="bg-pink-50 p-2 rounded-lg text-center border border-pink-100">
                            <div class="text-[10px] text-pink-500 font-bold mb-1">ç§‰èŠ¬ ({{ formatMoney(personStats.BingFen) }})</div>
                            <div class="h-1 bg-pink-200 rounded-full w-full">
                                <div class="h-full bg-pink-500 rounded-full" :style="{width: getPercent(personStats.BingFen) + '%'}"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Input Form -->
                    <div class="space-y-3 mb-6 bg-slate-50 p-4 rounded-xl border border-slate-100">
                        <!-- Row 1: Item & Payer -->
                        <div class="flex gap-2">
                            <input v-model="newExpense.item" placeholder="é …ç›®" class="flex-[2] bg-white rounded-lg px-3 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                            <select v-model="newExpense.payer" class="flex-1 bg-white rounded-lg px-2 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none font-bold text-slate-600">
                                <option value="YiQuan">å¥•éŠ“</option>
                                <option value="BingFen">ç§‰èŠ¬</option>
                            </select>
                        </div>
                        
                        <!-- Row 2: Amount & Currency -->
                        <div class="flex gap-2">
                            <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="flex-1 bg-white rounded-lg px-3 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                            <select v-model="newExpense.currency" class="w-20 bg-white rounded-lg px-2 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                                <option value="JPY">JPY</option>
                                <option value="TWD">TWD</option>
                            </select>
                        </div>

                        <!-- Row 3: Day & Method -->
                        <div class="flex gap-2">
                            <select v-model="newExpense.day" class="flex-1 bg-white rounded-lg px-2 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                                <option v-for="(day, idx) in timelineData" :key="idx" :value="idx">Day {{ idx }}</option>
                            </select>
                            <select v-model="newExpense.method" class="flex-1 bg-white rounded-lg px-2 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                                <option value="cash">ç¾é‡‘</option>
                                <option value="credit">ä¿¡ç”¨å¡</option>
                                <option value="mobile">è¡Œå‹•æ”¯ä»˜</option>
                                <option value="ic">é›»å­ç¥¨è­‰</option>
                            </select>
                        </div>

                        <button @click="addExpense" class="w-full bg-slate-800 text-white rounded-lg py-2 text-sm font-bold hover:bg-slate-700 transition-colors active:scale-95">
                            <i class="fas fa-plus mr-1"></i> åŠ å…¥ç´€éŒ„
                        </button>
                    </div>

                    <!-- Expense List (Grouped by Day) -->
                    <div class="space-y-4 max-h-60 overflow-y-auto pr-1">
                        <div v-for="(group, dayIdx) in groupedExpenses" :key="dayIdx" v-show="group.items.length > 0">
                            <div class="text-xs font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded mb-2 inline-block">Day {{ dayIdx }}</div>
                            <div class="space-y-2">
                                <div v-for="(exp, idx) in group.items" :key="idx" class="flex justify-between items-center text-sm p-2 bg-white border border-slate-100 rounded-lg shadow-sm">
                                    <div class="flex items-center gap-2">
                                        <!-- Payer Badge -->
                                        <div :class="['w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold border-2', exp.payer === 'YiQuan' ? 'bg-blue-100 text-blue-600 border-blue-200' : 'bg-pink-100 text-pink-600 border-pink-200']">
                                            {{ exp.payer === 'YiQuan' ? 'å¥•' : 'ç§‰' }}
                                        </div>
                                        <div>
                                            <div class="text-slate-700 font-medium leading-tight">{{ exp.item }}</div>
                                            <div class="text-[10px] text-slate-400 mt-0.5">
                                                <span v-if="exp.method === 'credit'"><i class="far fa-credit-card"></i> ä¿¡ç”¨å¡</span>
                                                <span v-else-if="exp.method === 'mobile'"><i class="fas fa-mobile-alt"></i> è¡Œå‹•æ”¯ä»˜</span>
                                                <span v-else-if="exp.method === 'ic'"><i class="fas fa-subway"></i> é›»å­ç¥¨è­‰</span>
                                                <span v-else><i class="fas fa-coins"></i> ç¾é‡‘</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="font-mono font-bold text-slate-600 text-sm">{{ exp.currency }} {{ exp.amount.toLocaleString() }}</span>
                                        <button @click="removeExpense(exp.originalIndex)" class="text-slate-300 hover:text-red-400 px-2"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                                <!-- Daily Subtotal -->
                                <div class="text-right text-[10px] text-slate-400 pt-1 border-t border-dashed border-slate-200">
                                    å°è¨ˆ: JPY {{ group.subtotal.JPY.toLocaleString() }}
                                </div>
                            </div>
                        </div>
                        <div v-if="expenseList.length === 0" class="text-center text-slate-300 text-xs py-4">å°šæœªæ–°å¢ä»»ä½•ç´€éŒ„</div>
                    </div>
                </div>
            </div>

            <!-- VIEW: INFO -->
            <div v-else-if="currentTab === 'info'" class="pt-4 space-y-4">
                <h2 class="text-2xl font-bold mb-4 text-slate-800 px-2">é‡è¦è³‡è¨Š</h2>
                <!-- Flight Card -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                    <h3 class="text-sm font-bold text-slate-400 mb-3 flex items-center"><i class="fas fa-plane mr-2"></i>èˆªç­è³‡è¨Š (æ˜Ÿå®‡èˆªç©º)</h3>
                    <div class="flex justify-between items-center mb-4 pb-4 border-b border-dashed border-slate-200">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-slate-800">TPE</div>
                            <div class="text-xs text-slate-500">æ¡ƒåœ’</div>
                        </div>
                        <div class="flex-1 flex flex-col items-center px-4">
                            <span class="text-xs text-purple-600 font-bold">JX846</span>
                            <div class="w-full h-px bg-slate-300 relative my-2">
                                <i class="fas fa-plane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-slate-400 text-xs bg-white px-1"></i>
                            </div>
                            <span class="text-xs text-slate-400">2h 00m</span>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-slate-800">KMJ</div>
                            <div class="text-xs text-slate-500">ç†Šæœ¬</div>
                        </div>
                    </div>
                     <div class="bg-slate-50 rounded-lg p-3 flex justify-between items-center">
                        <span class="text-sm font-bold text-slate-600">è¨‚ä½ä»£è™Ÿ</span>
                        <span class="text-lg font-mono font-bold text-purple-600 select-all">D95RG3</span>
                    </div>
                </div>
                <!-- Hotel List -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                     <h3 class="text-sm font-bold text-slate-400 mb-3 flex items-center"><i class="fas fa-hotel mr-2"></i>ä½å®¿æ¸…å–®</h3>
                     <div class="space-y-4">
                         <div v-for="hotel in hotels" :key="hotel.name" class="flex gap-3 items-start">
                             <div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center shrink-0 text-sm font-bold">
                                 {{ hotel.day }}
                             </div>
                             <div class="flex-1">
                                 <h4 class="font-bold text-slate-800 text-sm leading-tight mb-1">{{ hotel.name }}</h4>
                                 <p class="text-xs text-slate-500 mb-1"><i class="fas fa-map-marker-alt mr-1"></i>{{ hotel.address }}</p>
                                 <div class="inline-flex items-center gap-2 bg-slate-50 px-2 py-1 rounded border border-slate-200">
                                     <span class="text-[10px] text-slate-400">é ç´„è™Ÿç¢¼</span>
                                     <span class="text-xs font-mono font-bold text-slate-700 select-all">{{ hotel.code }}</span>
                                 </div>
                             </div>
                         </div>
                     </div>
                </div>
            </div>

            <!-- VIEW: MAPS (Attractions & Backup) -->
            <div v-else-if="currentTab === 'map'" class="pt-4">
                <h2 class="text-2xl font-bold mb-4 text-slate-800 px-2">æ™¯é»å°èˆª</h2>
                
                <!-- Toggle Map Tabs -->
                <div class="flex bg-slate-200 p-1 rounded-xl mb-4 mx-2">
                    <button @click="mapTab = 'route'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', mapTab === 'route' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">è¡Œç¨‹æ™¯é»</button>
                    <button @click="mapTab = 'backup'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', mapTab === 'backup' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">å‚™ç”¨èˆ‡è³¼ç‰©</button>
                </div>

                <!-- Main Route -->
                <div v-if="mapTab === 'route'" class="grid grid-cols-1 gap-3">
                    <div v-for="spot in allSpots" :key="spot.name" class="bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400">
                                <i :class="spot.icon"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">{{ spot.name }}</h4>
                                <span class="text-xs text-slate-500">{{ spot.area }}</span>
                            </div>
                        </div>
                        <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(spot.name)" target="_blank" 
                           class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 transition-colors">
                            <i class="fas fa-location-arrow"></i>
                        </a>
                    </div>
                </div>

                <!-- Backup & Shopping -->
                <div v-if="mapTab === 'backup'" class="space-y-3 pb-8">
                    <div v-for="group in backupSpots" :key="group.category">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 ml-2">{{ group.category }}</h3>
                        <div class="space-y-3">
                             <!-- Made the whole card a link for better UX -->
                             <a v-for="spot in group.items" :key="spot.name" 
                                :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(spot.address)" 
                                target="_blank"
                                class="block bg-white rounded-xl p-3 shadow-sm border border-slate-100 hover:bg-slate-50 active:scale-[0.99] transition-all cursor-pointer">
                                
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-sm">{{ spot.name }}</h4>
                                        <p class="text-[10px] text-slate-500 mt-1"><i class="fas fa-map-marker-alt mr-1"></i>{{ spot.address }}</p>
                                    </div>
                                    <div class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 shrink-0">
                                        <i class="fas fa-location-arrow text-sm"></i>
                                    </div>
                                </div>
                                <div class="bg-slate-50 rounded px-2 py-1 flex justify-between items-center" @click.stop.prevent="copyText(spot.code)">
                                    <span class="text-[10px] text-slate-400">Navi: é›»è©±/MapCode</span>
                                    <div class="flex items-center gap-1">
                                        <span class="text-xs font-mono font-bold text-slate-700">{{ spot.code }}</span>
                                        <i class="far fa-copy text-[10px] text-slate-400"></i>
                                    </div>
                                </div>
                             </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Spacer -->
            <div class="h-10"></div>
        </main>

        <!-- ================= BOTTOM NAVIGATION ================= -->
        <nav class="bg-white/95 backdrop-blur-md border-t border-slate-200 px-6 py-3 flex justify-between items-center z-20 shrink-0 shadow-[0_-5px_10px_rgba(0,0,0,0.03)] pb-safe">
            <button @click="currentTab = 'home'" :class="navBtnClass('home')">
                <div class="text-xl mb-1"><i class="fas fa-stream"></i></div>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button @click="currentTab = 'map'" :class="navBtnClass('map')">
                <div class="text-xl mb-1"><i class="fas fa-map"></i></div>
                <span class="text-[10px] font-bold">åœ°åœ–</span>
            </button>
            
            <div class="-mt-12">
                <button @click="currentTab = 'list'" class="w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full shadow-lg shadow-purple-300/50 text-white flex items-center justify-center text-2xl hover:scale-105 active:scale-95 transition-transform border-4 border-white">
                    <i class="fas fa-clipboard-check"></i>
                </button>
            </div>

            <button @click="currentTab = 'tools'" :class="navBtnClass('tools')">
                <div class="text-xl mb-1"><i class="fas fa-toolbox"></i></div>
                <span class="text-[10px] font-bold">å·¥å…·</span>
            </button>
            <button @click="currentTab = 'info'" :class="navBtnClass('info')">
                <div class="text-xl mb-1"><i class="fas fa-passport"></i></div>
                <span class="text-[10px] font-bold">è³‡è¨Š</span>
            </button>
        </nav>

        <!-- ================= MODALS ================= -->
        <!-- Detail Modal -->
        <transition name="fade">
            <div v-if="showModal" class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4" @click.self="showModal = false">
                <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl transform transition-all scale-100 flex flex-col max-h-[85vh]">
                    
                    <!-- Modal Header -->
                    <div class="text-center mb-4 flex-shrink-0">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3 text-purple-600 text-2xl">
                            <i :class="modalData.icon"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800">{{ modalData.title }}</h3>
                        <p v-if="!modalData.isStory" class="text-sm text-slate-500 mt-1">{{ modalData.time }}</p>
                    </div>

                    <!-- Story Content (Scrollable) -->
                    <div class="flex-1 overflow-y-auto mb-6 px-1">
                        <!-- Code Block (If not story) -->
                        <div v-if="modalData.code && !modalData.isStory" class="bg-slate-50 rounded-xl p-4 mb-4 border border-slate-100 text-center">
                            <p class="text-xs text-slate-400 mb-1">é ç´„/è¨‚ä½ä»£è™Ÿ</p>
                            <p class="text-2xl font-mono font-bold text-slate-800 select-all">{{ modalData.code }}</p>
                        </div>
                        
                        <!-- Description / Story Text -->
                        <div :class="['text-slate-600 leading-relaxed', modalData.isStory ? 'text-base' : 'text-sm']">
                             <!-- Show tag if story -->
                             <span v-if="modalData.isStory" class="inline-block bg-orange-100 text-orange-600 text-xs px-2 py-0.5 rounded mb-2 font-bold">
                                æ­·å²èˆ‡æ–‡åŒ–
                             </span>
                             <p>{{ modalData.desc }}</p>
                        </div>
                    </div>

                    <!-- Footer Actions -->
                    <div class="flex gap-3 flex-shrink-0">
                        <a v-if="modalData.isStory && modalData.storyLink" :href="modalData.storyLink" target="_blank" 
                           class="flex-1 bg-orange-50 text-orange-600 border border-orange-200 font-bold py-3 rounded-xl hover:bg-orange-100 transition-colors text-center flex items-center justify-center gap-2">
                           <i class="fas fa-external-link-alt"></i> å»¶ä¼¸é–±è®€
                        </a>
                        <button @click="showModal = false" :class="['font-bold py-3 rounded-xl hover:opacity-90 transition-colors', modalData.isStory ? 'flex-1 bg-slate-800 text-white' : 'w-full bg-purple-600 text-white']">
                            é—œé–‰
                        </button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- MapCode Modal -->
        <transition name="slide-up">
            <div v-if="showMapCodes" class="absolute inset-0 z-50 bg-white flex flex-col">
                <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h3 class="font-bold text-lg"><i class="fas fa-map-marked-alt text-green-500 mr-2"></i>MapCode å°èˆªæ¸…å–®</h3>
                    <button @click="showMapCodes = false" class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-4">
                    <div v-for="code in mapCodes" :key="code.place" class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm flex justify-between items-center">
                        <div>
                            <div class="font-bold text-slate-800">{{ code.place }}</div>
                            <div class="text-xs text-slate-400 mt-1">{{ code.note }}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-mono font-bold text-lg text-slate-700 select-all" @click="copyText(code.code)">{{ code.code }}</div>
                            <div class="text-[10px] text-green-500">é»æ“Šè¤‡è£½</div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Drive Tips Modal -->
        <transition name="slide-up">
            <div v-if="showDriveTips" class="absolute inset-0 z-50 bg-white flex flex-col">
                <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-purple-600 text-white">
                    <h3 class="font-bold text-lg"><i class="fas fa-book mr-2"></i>è‡ªé§•æ‡¶äººåŒ…</h3>
                    <button @click="showDriveTips = false" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-5 space-y-6">
                    <section>
                        <h4 class="font-bold text-purple-700 mb-2 border-l-4 border-purple-500 pl-2">åŠ æ²¹æ”»ç•¥</h4>
                        <ul class="list-disc pl-5 text-sm text-slate-600 space-y-2">
                            <li><span class="text-red-500 font-bold">ç´…è‰²æ²¹æ§ (Regular)</span>ï¼šä¸€èˆ¬ç§Ÿè»ŠåŠ é€™å€‹ (92/95)ã€‚</li>
                            <li><span class="text-yellow-500 font-bold">é»ƒè‰²æ²¹æ§ (High Octane)</span>ï¼šé«˜ç´šè»Šç”¨ã€‚</li>
                            <li><span class="text-green-600 font-bold">ç¶ è‰²æ²¹æ§ (Diesel)</span>ï¼šæŸ´æ²¹ (æ³¨æ„ä¼‘æ—…è»Šå¯èƒ½æ˜¯æŸ´æ²¹)ã€‚</li>
                            <li>å£è¨£ï¼šã€ŒRegular, Mantan (åŠ æ»¿)ã€ã€‚</li>
                        </ul>
                    </section>
                    <section>
                        <h4 class="font-bold text-purple-700 mb-2 border-l-4 border-purple-500 pl-2">é‡è¦äº¤é€šè¦å‰‡</h4>
                        <div class="bg-red-50 p-3 rounded-lg border border-red-100 text-sm text-red-800">
                            <strong>æ­¢ã¾ã‚Œ (Tomare)</strong>ï¼šå€’ä¸‰è§’æ¨™èªŒå‹™å¿…<span class="font-bold underline">å®Œå…¨éœæ­¢ 3 ç§’</span>ï¼Œå·¦å³çœ‹æ²’è»Šå†é–‹ã€‚é€™æ˜¯æœ€å®¹æ˜“è¢«æŠ“çš„é•è¦ï¼
                        </div>
                        <ul class="list-disc pl-5 text-sm text-slate-600 space-y-2 mt-2">
                            <li>å³é§•å·¦è¡Œï¼šé›¨åˆ·åœ¨å·¦ï¼Œæ–¹å‘ç‡ˆåœ¨å³ã€‚</li>
                            <li>è¡Œäººçµ•å°å„ªå…ˆï¼šæ–‘é¦¬ç·šæœ‰äººå¿…é ˆåœã€‚</li>
                            <li>å³è½‰è»Šéœ€ç¦®è®“ç›´è¡Œèˆ‡å·¦è½‰è»Šã€‚</li>
                        </ul>
                    </section>
                </div>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const currentTab = ref('home');
                const listTab = ref('pack');
                const mapTab = ref('route');
                const showModal = ref(false);
                const showMapCodes = ref(false);
                const showDriveTips = ref(false);
                const modalData = ref({});
                const currentDayIndex = ref(1); 

                // Currency
                const jpyAmount = ref('');
                const twdAmount = ref(0);
                const rate = 0.22;
                const calculateTWD = () => { twdAmount.value = Math.round(jpyAmount.value * rate); };
                const resetCurrency = () => { jpyAmount.value = ''; twdAmount.value = 0; }

                // Advanced Expense Tracker
                const newExpense = ref({ day: 0, item: '', amount: '', currency: 'JPY', method: 'cash', payer: 'YiQuan' });
                const expenseList = ref([]);
                
                const addExpense = () => {
                    if (newExpense.value.item && newExpense.value.amount) {
                        expenseList.value.push({ ...newExpense.value, id: Date.now() });
                        newExpense.value.item = '';
                        newExpense.value.amount = '';
                        // Keep other fields for convenience
                    }
                };
                
                const removeExpense = (originalIndex) => {
                    expenseList.value.splice(originalIndex, 1);
                };

                // Countdown
                const tripDate = new Date('2025-12-03');
                const today = new Date();
                const daysUntilTrip = Math.ceil((tripDate - today) / (1000 * 60 * 60 * 24));

                // Data: Hotels
                const hotels = [
                    { day: 'D0', name: 'åŸå¸‚å•†æ—…æ¡ƒåœ’èˆªç©ºé¤¨', address: 'æ¡ƒåœ’å¸‚å¤§åœ’å€ä¸­æ­£æ±è·¯442è™Ÿ', code: 'GTTMMGGZPU' },
                    { day: 'D1', name: 'KOKO HOTEL ç¦å²¡å¤©ç¥', address: 'ç¦å²¡å¸‚ä¸­å¤®å€ä»Šæ³‰ 1-22-14', code: 'IN1437799796' },
                    { day: 'D3', name: 'é»‘å·æº«æ³‰ Yamabiko æ—…é¤¨', address: 'ç†Šæœ¬çœŒé˜¿è˜‡éƒ¡å—å°å›½ç”ºé»’å· 6704', code: 'RYa0kr1u0r' },
                    { day: 'D4', name: 'SOLEST é«˜åƒç©—é£¯åº—', address: 'é«˜åƒç©—ç”ºä¸‰ç”°äº• 1261-1', code: 'AGRJWYNZND' },
                    { day: 'D5', name: 'Candeo Hotels ç†Šæœ¬æ–°å¸‚è¡—', address: 'ç†Šæœ¬å¸‚ä¸­å¤®åŒºæ–°å¸‚è¡— 8-7', code: '3036-3012-3431' }
                ];

                // Data: Map Codes
                const mapCodes = [
                    { place: 'TOYOTA è–¬é™¢é§…å‰åº—', code: '13 287 083*63', note: 'å–è»Šè™•' },
                    { place: 'å¤§è§€å³°å±•æœ›æ‰€', code: '256 878 352*74', note: 'çµ•æ™¯' },
                    { place: 'è‰åƒé‡Œä¹‹æ¿±', code: '256 456 835*36', note: 'é¨é¦¬é«”é©—' },
                    { place: 'é˜¿è˜‡ç«å£', code: '256 456 805*11', note: 'æ”¶è²»é“è·¯å…¥å£' },
                    { place: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾', code: '257 886 475*70', note: 'è¢ç«ä¹‹æ£®å ´æ™¯' },
                    { place: 'é«˜åƒç©—å³½åœè»Šå ´', code: '330 711 731*58', note: 'å¾¡é¹½äº•(æœ€è¿‘)' },
                    { place: 'TOYOTA ç†Šæœ¬ç«™å‰åº—', code: '29 428 586*66', note: 'é‚„è»Šè™•' },
                ];

                // Data: Backup Spots
                const backupSpots = [
                    {
                        category: "ä¼‘æ¯ç«™ (é“ä¹‹é©›)",
                        items: [
                            { name: "é“ä¹‹é©› é˜¿è˜‡", address: "ç†Šæœ¬çœŒé˜¿è˜‡å¸‚é»’å·1440-1", code: "0967-35-5077" },
                            { name: "é“ä¹‹é©› ä¸ƒåŸMelon Dome", address: "ç†Šæœ¬çœŒèŠæ± å¸‚ä¸ƒåŸç”ºå²¡ç”°306", code: "0968-25-5757" }
                        ]
                    },
                    {
                        category: "è³¼ç‰© (Bic Camera / Yodobashi)",
                        items: [
                            { name: "Bic Camera å¤©ç¥1è™Ÿé¤¨", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºä»Šæ³‰1-25-1", code: "092-732-1112" },
                            { name: "Bic Camera å¤©ç¥2è™Ÿé¤¨", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥2-4-5", code: "092-732-1111" },
                            { name: "Bic Camera ç†Šæœ¬åº—", address: "ç†Šæœ¬å¸‚è¥¿åŒºæ˜¥æ—¥3-15-60", code: "096-323-1111" },
                            { name: "Yodobashi åšå¤š", address: "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…ä¸­å¤®è¡—6-12", code: "092-471-1010" }
                        ]
                    },
                    {
                        category: "è³¼ç‰© (å”å‰è¨¶å¾·)",
                        items: [
                            { name: "å”å‰è¨¶å¾· ç¦å²¡å¤©ç¥æœ¬åº—", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºä»Šæ³‰1-20-17", code: "092-736-5911" },
                            { name: "å”å‰è¨¶å¾· åšå¤šç«™å—åº—", address: "ç¦å²¡å¸‚åšå¤šåŒºæ±å…‰å¯ºç”º2-6-40", code: "092-432-6511" },
                            { name: "å”å‰è¨¶å¾· åšå¤šä¸¸äº•åº—", address: "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…ä¸­å¤®è¡—9-1 3F", code: "092-433-3811" },
                            { name: "å”å‰è¨¶å¾· ç†Šæœ¬ä¸‹é€šåº—", address: "ç†Šæœ¬å¸‚ä¸­å¤®åŒºå®‰æ”¿ç”º5-27", code: "096-324-5511" },
                            { name: "å”å‰è¨¶å¾· å—ç†Šæœ¬åº—", address: "ç†Šæœ¬å¸‚ä¸­å¤®åŒºå—ç†Šæœ¬1-9-25", code: "096-375-6511" }
                        ]
                    },
                    {
                        category: "ç¾é£Ÿå‚™æ¡ˆ",
                        items: [
                            { name: "æ²»ä¸€éƒå¸ƒä¸ (åšå¤šç«™)", address: "JRåšå¤šåŸ AMU PLAZA B1F", code: "092-409-6720" },
                            { name: "éºµå±‹å…¼è™ å¤©ç¥æœ¬åº—", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºæ¸¡è¾ºé€š4-9-18", code: "092-726-7121" },
                            { name: "éºµå±‹å…¼è™ ç¦å²¡PARCO", address: "ç¦å²¡PARCOæœ¬é¤¨ B1F", code: "092-235-7226" },
                            { name: "éºµå±‹å…¼è™ åšå¤šåº—", address: "åšå¤šDeitos 2F æ‹‰éºµè¡—é“", code: "092-477-3113" },
                            { name: "ç‚¸è±¬æ’ WAKABA", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥1-15-36", code: "092-732-1209" }
                        ]
                    },
                    {
                        category: "è¥¿æ‘è£•äºŒå•†å“",
                        items: [
                            { name: "ç¦å²¡å¤©ç¥ LOFT", address: "ç¦å²¡å¸‚ä¸­å¤®åŒºæ¸¡è¾ºé€š4-9-25", code: "092-724-6210" },
                            { name: "Animate ç¦å²¡Parco", address: "ç¦å²¡PARCOæœ¬é¤¨ 8F", code: "092-732-8070" },
                            { name: "Village Vanguard", address: "ç¦å²¡PARCOæœ¬é¤¨ 7F (é€šå¸¸ä½ç½®)", code: "éœ€ç¢ºèªåˆ†åº—" }
                        ]
                    }
                ];

                // Data: Packing List
                const packList = ref([
                    { text: 'è­·ç…§ (å…¨å®¶)', sub: 'æ•ˆæœŸéœ€ > 6å€‹æœˆ', checked: false },
                    { text: 'é§•ç…§æ­£æœ¬ + æ—¥æ–‡è­¯æœ¬', sub: 'ç§Ÿè»Šå¿…å‚™ï¼', checked: false },
                    { text: 'VJW QR Code æˆªåœ–', sub: 'æµ·é—œ/ç§»æ°‘å®˜', checked: false },
                    { text: 'ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜)', sub: 'JCBä½³', checked: false },
                    { text: 'ç¶²å¡ / æ¼«éŠé–‹é€š', sub: 'ç¢ºèªè¨Šè™Ÿ', checked: false },
                    { text: 'è¡Œå‹•é›»æº + ç·š', sub: 'æ‰‹æä¸Šæ©Ÿ', checked: false },
                    { text: 'ä¿æš–è¡£ç‰©', sub: 'æ´‹è”¥å¼ç©¿æ³•', checked: false },
                ]);

                const addPackItem = () => {
                    const text = prompt('è¼¸å…¥æ–°é …ç›®:');
                    if(text) packList.value.push({ text, sub: 'æ–°å¢é …ç›®', checked: false });
                };

                // Data: Shopping List
                const shoppingList = ref([
                    { name: 'åˆåˆ©ä»–å‘½ EX Plus', note: 'å¹«çˆ¸åª½è²·', img: '' },
                    { name: 'ç¦å²¡è‰è“', note: 'é£¯åº—åƒ', img: '' },
                ]);
                
                const addShopItem = () => {
                    shoppingList.value.push({ name: '', note: '', img: '' });
                };
                const removeShopItem = (idx) => {
                    shoppingList.value.splice(idx, 1);
                };

                // Data: Timeline (Added Stories)
                const timelineData = ref([
                    {
                        date: '12/2 (äºŒ)', location: 'æ¡ƒåœ’',
                        weather: { icon: 'fas fa-moon', temp: 18, desc: 'é™°å¤©' },
                        events: [
                            { time: '22:11', title: 'é«˜éµå‡ºç™¼', type: 'train', icon: 'fas fa-train', desc: 'è‡ºå—ç«™(696) â†’ æ¡ƒåœ’ç«™', location: 'é«˜éµæ¡ƒåœ’ç«™' },
                            { time: '23:30', title: 'é£¯åº— Check-in', type: 'hotel', icon: 'fas fa-bed', desc: 'åŸå¸‚å•†æ—…æ¡ƒåœ’èˆªç©ºé¤¨', location: 'åŸå¸‚å•†æ—…æ¡ƒåœ’èˆªç©ºé¤¨', code: 'GTTMMGGZPU' }
                        ]
                    },
                    {
                        date: '12/3 (ä¸‰)', location: 'ç†Šæœ¬/ç¦å²¡',
                        weather: { icon: 'fas fa-cloud-sun', temp: 14, desc: 'å¤šé›²' },
                        events: [
                            { time: '07:30', title: 'æ­æ©Ÿå‰å¾€ç†Šæœ¬', type: 'plane', icon: 'fas fa-plane-departure', desc: 'æ˜Ÿå®‡ JX846ã€‚å»ºè­° 05:30 æŠµé”æ©Ÿå ´ã€‚', code: 'D95RG3' },
                            { time: '11:30', title: 'æŠµé” & ç§»å‹•', type: 'bus', icon: 'fas fa-bus', desc: 'æ©Ÿå ´å·´å£« â†’ ç†Šæœ¬é§… (ç´„1hr)', location: 'é˜¿è˜‡ç†Šæœ¬æ©Ÿå ´' },
                            { time: '12:30', title: 'åˆé¤: ç«è»Šä¾¿ç•¶', type: 'food', icon: 'fas fa-bento', tag: 'ç‰¹è‰²', desc: 'åœ¨ç†Šæœ¬é§…è³¼è²·ç•¶åœ°ç‰¹è‰²Ekibenã€‚', location: 'ç†Šæœ¬é§…' },
                            { time: '13:00', title: 'æ–°å¹¹ç·š â†’ åšå¤š', type: 'train', icon: 'fas fa-subway', desc: 'è¨˜å¾—é ç´„ã€Œç‰¹å¤§è·ç‰©å¸­ã€ã€‚', location: 'ç†Šæœ¬é§…' },
                            { time: '15:30', title: 'æ«›ç”°ç¥ç¤¾ & å·ç«¯é€š', type: 'sight', icon: 'fas fa-torii-gate', desc: 'åšå¤šç¸½é®å®ˆï¼Œå¿…çœ‹å·¨å¤§å±±ç¬ ã€‚å•†åº—è¡—åƒç´…è±†éº»ç³¬æ¹¯ã€‚', location: 'æ«›ç”°ç¥ç¤¾', storyLink: 'https://zh.wikipedia.org/zh-tw/%E6%AB%9B%E7%94%B0%E7%A5%9E%E7%A4%BE',
                              story: 'æ«›ç”°ç¥ç¤¾æ˜¯åšå¤šçš„ç¸½é®å®ˆï¼Œæ·±å—å¸‚æ°‘æ„›æˆ´ï¼Œæš±ç¨±ç‚ºã€Œæ«›ç”°æ¡‘ã€ã€‚é€™è£¡æœ€è‘—åçš„æ˜¯æ¯å¹´7æœˆèˆ‰è¾¦çš„ã€Œåšå¤šç¥‡åœ’å±±ç¬ ã€ç¥­å…¸ï¼Œç¥ç¤¾å…§å¸¸å¹´å±•ç¤ºè‘—å·¨å¤§çš„è£é£¾å±±ç¬ ï¼Œæ°£å‹¢éå‡¡ã€‚ç›¸å‚³ç¤¾å…§çš„ã€Œéˆæ³‰é¶´ä¹‹äº•æˆ¶ã€å–äº†èƒ½é•·ç”Ÿä¸è€ã€‚æ­¤è™•ä¹Ÿæ˜¯åšå¤šå•†äººç¥ˆæ±‚ç”Ÿæ„èˆˆéš†çš„ä¿¡ä»°ä¸­å¿ƒã€‚' },
                            { time: '18:00', title: 'æ™šé¤: ç‚¸è±¬æ’/æ‹‰éºµ', type: 'food', icon: 'fas fa-utensils', tag: 'å¿…åƒ', desc: 'æ¨è–¦ã€Œç‚¸è±¬æ’ WAKABAã€æˆ–ã€Œéºµå±‹å…¼è™ã€ã€‚', location: 'ç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥1-15-36' }
                        ]
                    },
                    {
                        date: '12/4 (å››)', location: 'å¤ªå®°åºœ',
                        weather: { icon: 'fas fa-sun', temp: 13, desc: 'æ™´å¤©' },
                        events: [
                            { time: '10:00', title: 'ç«ˆé–€ç¥ç¤¾', type: 'sight', icon: 'fas fa-leaf', tag: 'è³æ¥“', desc: 'é¬¼æ»…è–åœ° + è³æ¥“åæ‰€ã€‚éœ€æ­å·´å£«å‰å¾€ã€‚', location: 'ç«ˆé–€ç¥ç¤¾', storyLink: 'https://kamadojinja.or.jp/',
                              story: 'ç«ˆé–€ç¥ç¤¾ä½æ–¼å¯¶æ»¿å±±è…³ä¸‹ï¼Œè‡ªå¤ä»¥ä¾†ä¾¿æ˜¯ç¥ˆæ±‚å§»ç·£èˆ‡æ–¹é™¤ï¼ˆé©…é‚ªï¼‰çš„è–åœ°ã€‚è¿‘å¹´å› æ¼«ç•«ã€Šé¬¼æ»…ä¹‹åˆƒã€‹ä¸»è§’å§“æ°ç›¸åŒè€Œæˆç‚ºç†±é–€æœè–åœ°ã€‚ç¥ç¤¾å¢ƒå…§ç¨®æ¤äº†è¨±å¤šæ¥“æ¨¹ï¼Œç§‹å­£æ™‚ç´…è‘‰éš§é“ç¾ä¸å‹æ”¶ã€‚ç¤¾å‹™æ‰€ç”±çŸ¥åè¨­è¨ˆå¸«æ‰“é€ ï¼Œå……æ»¿ç¾ä»£æ™‚å°šæ„Ÿï¼Œè²©å”®çš„å¾¡å®ˆä¹Ÿéå¸¸ç²¾ç·»å¯æ„›ã€‚' },
                            { time: '11:30', title: 'å¤ªå®°åºœå¤©æ»¿å®®', type: 'sight', icon: 'fas fa-torii-gate', desc: 'åƒé“åƒæ¢…æé¤…ï¼Œçœ‹éšˆç ”å¾æ˜Ÿå·´å…‹ã€‚', location: 'å¤ªå®°åºœå¤©æ»¿å®®', storyLink: 'https://www.dazaifutenmangu.or.jp/',
                              story: 'å¤ªå®°åºœå¤©æ»¿å®®ä¾›å¥‰çš„æ˜¯ã€Œå­¸å•ä¹‹ç¥ã€è…åŸé“çœŸï¼Œæ˜¯å…¨æ—¥æœ¬1è¬2åƒåº§å¤©æ»¿å®®çš„ç¸½æœ¬å®®ã€‚å‚³èªªä¸­é“çœŸå…¬æ·±æ„›çš„æ¢…æ¨¹ä¸€å¤œä¹‹é–“å¾äº¬éƒ½é£›åˆ°æ­¤åœ°ï¼Œå³è‘—åçš„ã€Œé£›æ¢…å‚³èªªã€ã€‚æœ¬æ®¿å»ºç¯‰è¯éº—ï¼Œç›®å‰æ­£é€²è¡Œå¤§è¦æ¨¡æ•´ä¿®ï¼ŒæœŸé–“é™å®šçš„ã€Œä»®æ®¿ã€ç”±è—¤æœ¬å£¯ä»‹è¨­è¨ˆï¼Œå±‹é ‚ç¨®æ»¿æ¤æ ½ï¼Œå¦‚æ£®æ—èˆ¬å¤¢å¹»ã€‚' },
                            { time: '12:30', title: 'åˆé¤: ä¸€è˜­æ‹‰éºµ', type: 'food', icon: 'fas fa-utensils', tag: 'ç‰¹è‰²', desc: 'å¤ªå®°åºœåƒé“åº—ï¼Œå¿…é»ã€Œäº”è§’å½¢åˆæ ¼ç¢—ã€ã€‚', location: 'ä¸€è˜­ å¤ªå®°åºœå‚é“åº—' },
                            { time: '18:00', title: 'æ™šé¤: Shin-Shin', type: 'food', icon: 'fas fa-utensils', tag: 'æ’éšŠåº—', desc: 'åšå¤šæ‹‰éºµååº—ï¼Œå»ºè­°é¿é–‹å°–å³°ã€‚', location: 'åšå¤šã‚‰ãƒ¼ã‚ã‚“ Shin-Shin å¤©ç¥æœ¬åº—' }
                        ]
                    },
                    {
                        date: '12/5 (äº”)', location: 'é˜¿è˜‡',
                        weather: { icon: 'fas fa-cloud', temp: 8, desc: 'å¯’å†·' },
                        events: [
                            { time: '10:00', title: 'ç§Ÿè»Šå‡ºç™¼', type: 'car', icon: 'fas fa-car', tag: 'è‡ªé§•', desc: 'TOYOTA è–¬é™¢é§…å‰åº—ã€‚æª¢æŸ¥é›ªèƒ/ETCã€‚', location: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ è–¬é™¢é§…å‰', code: 'MapCode: 13 287 083*63' },
                            { time: '13:00', title: 'å¤§è§€å³°å±•æœ›æ‰€', type: 'sight', icon: 'fas fa-mountain', desc: '360åº¦çœºæœ›é˜¿è˜‡äº”å²³èˆ‡ç ´ç«å±±å£ã€‚', location: 'å¤§è§€å³°',
                              story: 'å¤§è§€å³°ä½æ–¼é˜¿è˜‡åŒ—å¤–è¼ªå±±çš„æœ€é«˜é»ï¼Œæ›¾è¢«æ—¥æœ¬æ–‡è±ªå¾·å¯Œè˜‡å³°å‘½åç‚ºã€Œå¤§è§€å³°ã€ï¼Œæ„æŒ‡æ™¯è§€å®å¤§ã€‚å¾æ­¤è™•å¯ä»¥360åº¦çœºæœ›ä¸–ç•Œç´šçš„é˜¿è˜‡ç ´ç«å±±å£èˆ‡é˜¿è˜‡äº”å²³ã€‚é˜¿è˜‡äº”å²³é€£ç¶¿çš„å½¢ç‹€å®›å¦‚ä¸€å°Šä»°è‡¥çš„é‡‹è¿¦æ¶…æ§ƒåƒï¼Œéå¸¸èŠåš´ç¥è–ã€‚ç§‹å†¬æ¸…æ™¨è‹¥é‹æ°£å¥½ï¼Œé‚„èƒ½çœ‹è¦‹å£¯é—Šçš„é›²æµ·çµ•æ™¯ã€‚' },
                            { time: '14:30', title: 'è‰åƒé‡Œ & ç«å£', type: 'sight', icon: 'fas fa-volcano', desc: 'çœ‹ç«å±±æ°£é«”ç‹€æ³ã€‚è‰åƒé‡Œä¸€ç‰‡é‡‘é»ƒã€‚', location: 'é˜¿è˜‡è‰åƒé‡Œ', storyLink: 'https://zh.wikipedia.org/zh-tw/%E9%98%BF%E8%98%87%E5%B1%B1',
                              story: 'è‰åƒé‡Œä¹‹æ¿±æ˜¯çƒå¸½å­å²³åŒ—éº“å»¶ä¼¸å‡ºçš„å»£é—Šè‰åŸï¼Œä¸­å¤®æœ‰å…©å€‹å¤§æ± å¡˜ï¼Œé¢¨æ™¯å¦‚ç•«ã€‚é€™è£¡å¯ä»¥é«”é©—é¨é¦¬æ¼«æ­¥ï¼Œæ„Ÿå—ç«å±±å¤§åœ°çš„è„ˆå‹•ã€‚ä¸é è™•çš„é˜¿è˜‡ä¸­å²³ç«å£æ˜¯è‡³ä»Šä»æ´»èºçš„æ´»ç«å±±ï¼Œå…¶ç¢§ç¶ è‰²çš„ç«å±±å£æ¹–å……æ»¿ç¥ç§˜æ„Ÿï¼Œä½†éœ€è¦–ç«å±±æ°£é«”æ¿ƒåº¦é–‹æ”¾åƒè§€ã€‚' },
                            { time: '17:00', title: 'Check-in é»‘å·æº«æ³‰', type: 'hotel', icon: 'fas fa-hot-tub', desc: 'Yamabiko æ—…é¤¨ï¼Œäº«å—éœ²å¤©ä»™äººé¢¨å‘‚ã€‚', location: 'é»’å·æ¸©æ³‰ ã‚„ã¾ã³ã“æ—…é¤¨', code: 'RYa0kr1u0r' }
                        ]
                    },
                    {
                        date: '12/6 (å…­)', location: 'é«˜åƒç©—',
                        weather: { icon: 'fas fa-sun', temp: 10, desc: 'æ™´æ™‚å¤šé›²' },
                        events: [
                            { time: '09:30', title: 'ç§»å‹• â†’ å—é˜¿è˜‡', type: 'car', icon: 'fas fa-car', desc: 'æ³¨æ„è·¯é¢æ˜¯å¦çµå†°ã€‚' },
                            { time: '10:30', title: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾', type: 'sight', icon: 'fas fa-tree', tag: 'ç§˜å¢ƒ', desc: 'é€šå¾€ç•°ä¸–ç•Œçš„åƒé“ï¼Œè¢ç«ä¹‹æ£®å ´æ™¯ã€‚', location: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾', storyLink: 'https://kumamoto.guide/tw/spots/detail/12306',
                              story: 'é€™åº§ç¥ç¤¾å› å‹•ç•«ã€Šè¢ç«ä¹‹æ£®ã€‹å ´æ™¯è€Œçˆ†ç´…ã€‚é€šå¾€ç¤¾æ®¿çš„åƒé“å…©æ—æ’åˆ—è‘—è¿‘ç™¾åº§é•·æ»¿é’è‹”çš„çŸ³ç‡ˆç± ï¼Œå‘¨åœè¢«é«˜è³çš„æ‰æœ¨æ—åŒ…åœï¼Œé™½å…‰ç‘è½æ™‚å……æ»¿ç¥ç¥•èˆ‡éˆæ°£ï¼Œå½·å½¿é€šå¾€ç•°ä¸–ç•Œçš„å…¥å£ã€‚å¾Œæ–¹çš„ã€Œç©¿æˆ¶å²©ã€æ“šèªªæ˜¯é¬¼å…«æ³•å¸«è¸¢ç ´çš„å¤§æ´ï¼Œè±¡å¾µè‘—å¿…å‹èˆ‡åˆæ ¼çš„å¼·å¤§èƒ½é‡ã€‚' },
                            { time: '14:00', title: 'å¤©å²©æˆ¶ç¥ç¤¾', type: 'sight', icon: 'fas fa-praying-hands', desc: 'æœ€å¼·èƒ½é‡é»ï¼Œæ­¥è¡Œè‡³å¤©å®‰æ²³åŸè¨±é¡˜ã€‚', location: 'å¤©å²©æˆ¶ç¥ç¤¾', storyLink: 'https://amanoiwato-jinja.jp/',
                              story: 'é€™è£¡æ˜¯æ—¥æœ¬ç¥è©±ä¸­ã€Œå¤©å²©æˆ¶å‚³èªªã€çš„èˆå°ã€‚ç›¸å‚³å¤ªé™½ç¥å¤©ç…§å¤§ç¥å› å¼Ÿå¼Ÿçš„æƒ¡è¡Œè€Œèº²å…¥å²©æ´ï¼Œä¸–ç•Œé™·å…¥é»‘æš—ã€‚çœ¾ç¥åœ¨å¤©å®‰æ²³åŸå•†è­°å°ç­–ï¼Œè¼‰æ­Œè¼‰èˆå¼•å‡ºå¤©ç…§å¤§ç¥ï¼Œä¸–ç•Œæ‰é‡è¦‹å…‰æ˜ã€‚å¤©å®‰æ²³åŸå……æ»¿äº†å †ç–Šçš„ç¥ˆé¡˜çŸ³å¡”ï¼Œè¢«è¦–ç‚ºæ—¥æœ¬æœ€å¼·çš„èƒ½é‡æ™¯é»ä¹‹ä¸€ã€‚' },
                            { time: '16:00', title: 'é£¯åº— Check-in', type: 'hotel', icon: 'fas fa-bed', desc: 'SOLEST é«˜åƒç©—é£¯åº—', location: 'ã‚½ãƒ¬ã‚¹ãƒˆé«˜åƒç©‚ãƒ›ãƒ†ãƒ«', code: 'AGRJWYNZND' },
                            { time: '18:00', title: 'æ™šé¤: ç‡’è‚‰ å’Œ', type: 'food', icon: 'fas fa-drumstick-bite', tag: 'å¿…åƒ', desc: 'é«˜åƒç©—ç‰›ååº—ï¼Œå‹™å¿…æº–æ™‚ã€‚', location: 'é«˜åƒç©‚ç‰›ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å’Œ', code: '0982-73-1109' },
                            { time: '20:00', title: 'å¤œç¥æ¨‚', type: 'sight', icon: 'fas fa-theater-masks', desc: 'é«˜åƒç©—ç¥ç¤¾ï¼Œæ¬£è³å‚³çµ±ç¥è©±è¡¨æ¼”ã€‚', location: 'é«˜åƒç©—ç¥ç¤¾', storyLink: 'https://takachiho-kanko.info/tw/sightseeing/kagura.php',
                              story: 'é«˜åƒç©—å¤œç¥æ¨‚æ˜¯è¢«æŒ‡å®šç‚ºæ—¥æœ¬åœ‹å®¶é‡è¦ç„¡å½¢æ°‘ä¿—æ–‡åŒ–è²¡çš„å‚³çµ±è—èƒ½ã€‚æ¯æ™šåœ¨é«˜åƒç©—ç¥ç¤¾ç¥æ¨‚æ®¿æ¼”å‡ºå››ç•ªï¼ˆå››æ®µï¼‰ï¼Œåˆ†åˆ¥è¬›è¿°å¤©ç…§å¤§ç¥èº²é€²å²©æˆ¶åˆ°è¢«è«‹å‡ºçš„æ•…äº‹ã€‚é€™ä¸åƒ…æ˜¯è¡¨æ¼”ï¼Œæ›´æ˜¯å°ç¥æ˜çš„å¥‰ç´ï¼Œèˆè€…æˆ´è‘—é¢å…·ï¼Œä¼´éš¨è‘—ç¬›è²èˆ‡å¤ªé¼“ï¼Œå……æ»¿äº†ç¥ç§˜è€ŒèŠåš´çš„å¤ä»£æ°£æ¯ã€‚' }
                        ]
                    },
                    {
                        date: '12/7 (æ—¥)', location: 'ç†Šæœ¬',
                        weather: { icon: 'fas fa-cloud-showers-heavy', temp: 11, desc: 'åˆå¾Œé›¨' },
                        events: [
                            { time: '09:00', title: 'é«˜åƒç©—å³½åˆ’èˆ¹', type: 'sight', icon: 'fas fa-water', tag: 'é ç´„', desc: 'åœå¾¡é¹½äº•åœè»Šå ´ã€‚çœ‹çœŸåäº•ç€‘å¸ƒã€‚', location: 'é«˜åƒç©—å³½', storyLink: 'https://takachiho-kanko.info/tw/sightseeing/',
                              story: 'é«˜åƒç©—å³½æ˜¯é˜¿è˜‡ç«å±±å™´ç™¼çš„ç†”å²©æµè¢«äº”ç€¨å·ä¾µè•è€Œæˆçš„æŸ±ç‹€ç¯€ç†å³½è°·ï¼Œå…©å²¸æ–·å´–é«˜é”80è‡³100å…¬å°ºã€‚ã€ŒçœŸåäº•ç€‘å¸ƒã€æ˜¯æ—¥æœ¬ç™¾é¸ç€‘å¸ƒä¹‹ä¸€ï¼Œæ™¯è‰²çµ•ç¾ã€‚åˆ’èˆ¹ç©¿æ¢­æ–¼å³½è°·é–“ï¼Œè¿‘è·é›¢ä»°æœ›ç€‘å¸ƒèˆ‡å²©å£ï¼Œæ˜¯é«”é©—é«˜åƒç©—å¤§è‡ªç„¶é¬¼æ–§ç¥å·¥çš„æœ€ä½³æ–¹å¼ã€‚' },
                            { time: '14:00', title: 'ç†Šæœ¬é‚„è»Š', type: 'car', icon: 'fas fa-check-circle', desc: 'TOYOTA ç†Šæœ¬ç«™å‰åº—ã€‚è¨˜å¾—åŠ æ»¿æ²¹ï¼', location: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç†Šæœ¬é§…å‰' },
                            { time: '15:00', title: 'Check-in é£¯åº—', type: 'hotel', icon: 'fas fa-bed', desc: 'Candeo Hotels é ‚æ¨“æœ‰å¤©ç©ºSPAã€‚', location: 'ã‚«ãƒ³ãƒ‡ã‚ªãƒ›ãƒ†ãƒ«ã‚ºç†Šæœ¬æ–°å¸‚è¡—' },
                            { time: '18:00', title: 'æ™šé¤: å‹çƒˆäº­', type: 'food', icon: 'fas fa-utensils', tag: 'å¿…åƒ', desc: 'ç†Šæœ¬å¿…åƒç‚¸è±¬æ’ï¼Œå°±åœ¨æ–°å¸‚è¡—ã€‚', location: 'å‹çƒˆäº­ æ–°å¸‚è¡—æœ¬åº—' }
                        ]
                    },
                    {
                        date: '12/8 (ä¸€)', location: 'ç†Šæœ¬å¸‚å€',
                        weather: { icon: 'fas fa-sun', temp: 15, desc: 'æ™´å¤©' },
                        events: [
                            { time: '09:30', title: 'ç†Šæœ¬åŸ & åŠ è—¤ç¥ç¤¾', type: 'sight', icon: 'fas fa-chess-rook', desc: 'å¤©å®ˆé–£èˆ‡éŠ€ææ¨¹ã€‚', location: 'ç†Šæœ¬åŸ', storyLink: 'https://castle.kumamoto-guide.jp/tw/',
                              story: 'ç†Šæœ¬åŸç”±åå°‡åŠ è—¤æ¸…æ­£è€—æ™‚7å¹´å»ºé€ ï¼Œä»¥é›£æ”»ä¸è½çš„ã€Œæ­¦è€…è¿”ã€çŸ³ç‰†èåï¼Œèˆ‡å¤§é˜ªåŸã€åå¤å±‹åŸä¸¦åˆ—æ—¥æœ¬ä¸‰å¤§ååŸã€‚2016å¹´é›–å—å¤§åœ°éœ‡é‡å‰µï¼Œä½†å¤©å®ˆé–£å·²ä¿®å¾©å®Œæˆä¸¦é–‹æ”¾ã€‚åŸå…§ç¨®æ¤è¨±å¤šéŠ€æï¼Œæ•…åˆåã€ŒéŠ€æåŸã€ï¼Œç§‹æœ«å†¬åˆé‡‘é»ƒä¸€ç‰‡ï¼Œèˆ‡é»‘è‰²åŸå ¡å½¢æˆå¼·çƒˆå°æ¯”ã€‚' },
                            { time: '12:00', title: 'åˆé¤: åŸå½©è‹‘', type: 'food', icon: 'fas fa-ice-cream', desc: 'é«”é©—æ±Ÿæˆ¶é¢¨æƒ…ï¼Œåƒæµ·è†½å¯æ¨‚é¤…ã€‚', location: 'æ¡œã®é¦¬å ´ åŸå½©è‹‘' },
                            { time: '14:30', title: 'æ°´å‰å¯ºæˆè¶£åœ’', type: 'sight', icon: 'fas fa-leaf', desc: 'å„ªé›…çš„æ—¥å¼åº­åœ’ã€‚', location: 'æ°´å‰å¯ºæˆè¶£åœ’', storyLink: 'http://www.suizenji.or.jp/',
                              story: 'é€™æ˜¯ä¸€åº§æ¡ƒå±±å¼å›éŠåº­åœ’ï¼Œç”±ç´°å·å®¶è—©ä¸»æ­·ç¶“ä¸‰ä»£å»ºé€ ã€‚åº­åœ’ä»¥é˜¿è˜‡æ¹§æ³‰æ°´æ± ç‚ºä¸­å¿ƒï¼Œå·§å¦™åœ°æ¨¡ä»¿äº†æ±æµ·é“äº”åä¸‰æ¬¡çš„æ™¯è‡´ï¼Œå…¶ä¸­æœ€è‘—åçš„ä¾¿æ˜¯æ¨¡ä»¿å¯Œå£«å±±çš„å‡å±±é€ æ™¯ã€‚åœ’å…§æœ‰å‡ºæ°´ç¥ç¤¾ï¼Œä¾›å¥‰ç´°å·å®¶æ­·ä»£è—©ä¸»ï¼Œç’°å¢ƒæ¸…å¹½é›…è‡´ï¼Œæ˜¯æ•£æ­¥èˆ‡å“èŒ¶çš„å¥½å»è™•ã€‚' },
                            { time: '16:00', title: 'ä¸Šä¸‹é€šå•†åº—è¡—', type: 'shopping', icon: 'fas fa-shopping-bag', tag: 'è³¼ç‰©', desc: 'è—¥å¦ã€ä¼´æ‰‹ç¦®æœ€å¾Œè¡åˆºã€‚', location: 'ä¸‹é€šå•†åº—è¡—' }
                        ]
                    },
                     {
                        date: '12/9 (äºŒ)', location: 'è¿”å°',
                        weather: { icon: 'fas fa-cloud-sun', temp: 16, desc: 'å¤šé›²' },
                        events: [
                            { time: '09:30', title: 'å‰å¾€æ©Ÿå ´', type: 'bus', icon: 'fas fa-bus', desc: 'å¾æ«»ç”ºå·´å£«ç¸½ç«™æ­è»Šã€‚', location: 'ç†Šæœ¬æ«»ç”ºå·´å£«ç¸½ç«™' },
                            { time: '11:45', title: 'é£›å¾€æ¡ƒåœ’', type: 'plane', icon: 'fas fa-plane-departure', desc: 'æ˜Ÿå®‡ JX847ã€‚', code: 'D95RG3' },
                             { time: '15:43', title: 'é«˜éµè¿”å°å—', type: 'train', icon: 'fas fa-train', desc: 'è»Šæ¬¡ 655ã€‚', location: 'é«˜éµæ¡ƒåœ’ç«™' }
                        ]
                    }
                ]);

                // Computed: Current Day Info for Hero Section
                const currentDayInfo = computed(() => {
                    return timelineData.value[currentDayIndex.value] || timelineData.value[0];
                });

                // Computed: Group Expenses
                const groupedExpenses = computed(() => {
                    const groups = {};
                    timelineData.value.forEach((day, idx) => {
                        groups[idx] = { items: [], subtotal: { JPY: 0 } };
                    });

                    expenseList.value.forEach((exp, idx) => {
                        const dayIdx = exp.day !== undefined ? exp.day : 0;
                        if (groups[dayIdx]) {
                            // Pass the actual index in the raw list to remove correctly
                            groups[dayIdx].items.push({ ...exp, originalIndex: idx });
                            groups[dayIdx].subtotal[exp.currency] += exp.amount;
                        }
                    });
                    return groups;
                });

                // Computed: Person Stats
                const personStats = computed(() => {
                    const stats = { YiQuan: 0, BingFen: 0, Total: 0 };
                    expenseList.value.forEach(exp => {
                        // Assuming JPY for simplified stats or convert TWD
                        let amount = exp.amount;
                        if (exp.currency === 'TWD') {
                            amount = exp.amount / rate; // Approximate to JPY for graph
                        }
                        
                        if (exp.payer === 'YiQuan') stats.YiQuan += amount;
                        else if (exp.payer === 'BingFen') stats.BingFen += amount;
                        
                        stats.Total += amount;
                    });
                    return stats;
                });

                const getPercent = (amount) => {
                    if (personStats.value.Total === 0) return 0;
                    return (amount / personStats.value.Total) * 100;
                }
                
                const formatMoney = (amount) => {
                    return 'Â¥' + Math.round(amount).toLocaleString();
                }

                const totalExpenseJPY = computed(() => expenseList.value.filter(e => e.currency === 'JPY').reduce((sum, item) => sum + item.amount, 0));
                const totalExpenseTWD = computed(() => expenseList.value.filter(e => e.currency === 'TWD').reduce((sum, item) => sum + item.amount, 0));

                // --- Methods ---
                const getIconColor = (type) => {
                    const colors = {
                        plane: 'bg-blue-400 border-blue-100',
                        train: 'bg-indigo-400 border-indigo-100',
                        bus: 'bg-teal-400 border-teal-100',
                        car: 'bg-yellow-400 border-yellow-100',
                        hotel: 'bg-purple-500 border-purple-100',
                        food: 'bg-orange-400 border-orange-100',
                        sight: 'bg-pink-400 border-pink-100',
                        shopping: 'bg-red-400 border-red-100'
                    };
                    return colors[type] || 'bg-gray-400';
                };

                const getTagColor = (tag) => {
                    if (tag === 'å¿…åƒ') return 'bg-orange-100 text-orange-600';
                    if (tag === 'è‡ªé§•') return 'bg-blue-100 text-blue-600';
                    if (tag === 'é ç´„') return 'bg-red-100 text-red-600';
                    if (tag === 'è³¼ç‰©') return 'bg-yellow-100 text-yellow-700';
                    if (tag === 'ç‰¹è‰²') return 'bg-green-100 text-green-700';
                    return 'bg-gray-100 text-gray-600';
                };

                const navBtnClass = (tab) => {
                    return `flex flex-col items-center justify-center w-full h-full transition-colors ${currentTab.value === tab ? 'text-purple-600' : 'text-slate-400 hover:text-slate-600'} cursor-pointer active:scale-90 duration-200`;
                };

                const scrollToDay = (index) => {
                    currentDayIndex.value = index;
                    const el = document.getElementById(`day-${index}`);
                    if (el) {
                        const mainContent = document.getElementById('main-content');
                        mainContent.scrollTo({
                            top: el.offsetTop - 20,
                            behavior: 'smooth'
                        });
                    }
                };

                const handleCardClick = (event) => {
                    if (event.code || event.detail) {
                        openDetailModal(event);
                    }
                };
                
                const openStoryModal = (event) => {
                    modalData.value = {
                        title: event.title,
                        time: event.time,
                        desc: event.story || 'æš«ç„¡è©³ç´°æ•…äº‹ä»‹ç´¹ã€‚',
                        icon: event.icon,
                        code: event.code || '',
                        isStory: true,
                        storyLink: event.storyLink
                    };
                    showModal.value = true;
                }

                const openDetailModal = (event) => {
                    modalData.value = {
                        title: event.title,
                        time: event.time,
                        desc: event.desc,
                        icon: event.icon,
                        code: event.code || '',
                        isStory: false
                    };
                    showModal.value = true;
                };

                const copyText = (text) => {
                    if (!text) return;
                    navigator.clipboard.writeText(text).then(() => {
                        alert(`å·²è¤‡è£½: ${text}`);
                    });
                };

                const highlightText = (text) => {
                    return text.replace(/(å¿…åƒ|å¿…é»|å¿…è²·)/g, '<span class="text-orange-500 font-bold">$1</span>');
                };

                // Add Event Prompt
                const promptAddEvent = (dayIndex) => {
                    const time = prompt('è«‹è¼¸å…¥æ™‚é–“ (ä¾‹å¦‚ 14:00):', '10:00');
                    if (!time) return;
                    const title = prompt('è«‹è¼¸å…¥è¡Œç¨‹æ¨™é¡Œ:', 'æ–°è¡Œç¨‹');
                    if (!title) return;
                    const desc = prompt('è«‹è¼¸å…¥èªªæ˜/å‚™è¨»:', '');

                    timelineData.value[dayIndex].events.push({
                        time: time,
                        title: title,
                        desc: desc || '',
                        type: 'sight', // default
                        icon: 'fas fa-map-pin',
                        location: title // assume title is location for map search
                    });
                    
                    // Re-sort events by time (simple string sort)
                    timelineData.value[dayIndex].events.sort((a, b) => a.time.localeCompare(b.time));
                };

                const allSpots = computed(() => {
                    const spots = [];
                    timelineData.value.forEach(day => {
                        day.events.forEach(event => {
                            if (event.location) {
                                spots.push({
                                    name: event.location,
                                    area: day.location,
                                    icon: event.icon
                                });
                            }
                        });
                    });
                    return spots;
                });

                return {
                    currentTab, listTab, mapTab, showModal, showMapCodes, showDriveTips, modalData,
                    currentDayInfo, daysUntilTrip,
                    jpyAmount, twdAmount, calculateTWD, resetCurrency,
                    newExpense, expenseList, addExpense, removeExpense, totalExpenseJPY, totalExpenseTWD, groupedExpenses,
                    personStats, getPercent, formatMoney,
                    timelineData, hotels, mapCodes, packList, shoppingList, backupSpots,
                    addPackItem, addShopItem, removeShopItem,
                    getIconColor, getTagColor, navBtnClass, scrollToDay, currentDayIndex,
                    handleCardClick, openDetailModal, openStoryModal, copyText, highlightText, allSpots,
                    promptAddEvent
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
