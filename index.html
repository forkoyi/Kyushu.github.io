<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 ‰πùÂ∑ûË°åÊóÖ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* Animations */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        .slide-up-enter-active, .slide-up-leave-active {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .slide-up-enter-from, .slide-up-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }

        /* Timeline Connector */
        .timeline-line {
            position: absolute;
            left: 1.25rem;
            top: 2rem;
            bottom: -2rem;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
        .last-item .timeline-line {
            display: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <div id="app" class="flex flex-col h-full w-full max-w-md mx-auto bg-white shadow-2xl relative overflow-hidden">

        <!-- ================= HERO SECTION (Only on Home) ================= -->
        <header v-if="currentTab === 'home'" class="relative bg-gradient-to-br from-purple-600 to-indigo-700 text-white p-6 pb-12 rounded-b-[2.5rem] shadow-lg z-10 shrink-0">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="text-xs font-medium opacity-80 bg-white/20 px-2 py-1 rounded-full inline-block mb-2">2025 TRIP</div>
                    <h1 class="text-3xl font-bold tracking-tight">‰πùÂ∑ûË°åÊóÖ üçÅ</h1>
                </div>
                <!-- Weather Widget (Current) -->
                <div class="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-2xl p-3 border border-white/20">
                    <i class="fas fa-sun text-yellow-300 text-2xl mb-1"></i>
                    <span class="text-2xl font-bold">{{ currentWeather }}¬∞</span>
                    <span class="text-xs opacity-80">{{ currentLocation }}</span>
                </div>
            </div>

            <!-- Countdown -->
            <div class="flex items-center gap-2 text-sm opacity-90 mb-4">
                <i class="far fa-calendar-alt"></i>
                <span>12/3 (‰∏â) - 12/9 (‰∫å)</span>
                <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full ml-2 animate-pulse">
                    ÈÇÑÊúâ {{ daysUntilTrip }} Â§©
                </span>
            </div>

            <!-- Day Selector -->
            <div class="flex overflow-x-auto gap-3 pb-2 -mx-2 px-2 no-scrollbar scroll-smooth">
                <button 
                    v-for="(day, index) in timelineData" 
                    :key="index"
                    @click="scrollToDay(index)"
                    :class="['flex-shrink-0 w-14 h-16 rounded-xl flex flex-col items-center justify-center transition-all border-2', 
                             currentDayIndex === index ? 'bg-white text-purple-700 border-white scale-105 shadow-md' : 'bg-white/10 text-white border-transparent hover:bg-white/20']"
                >
                    <span class="text-xs opacity-70">Day</span>
                    <span class="text-lg font-bold">{{ index }}</span>
                </button>
            </div>
        </header>

        <!-- ================= MAIN CONTENT AREA ================= -->
        <main class="flex-1 overflow-y-auto pb-24 pt-4 px-4 bg-slate-50 relative scroll-smooth" id="main-content">
            
            <!-- VIEW: HOME (Timeline) -->
            <div v-if="currentTab === 'home'">
                <div v-for="(day, dayIndex) in timelineData" :key="dayIndex" :id="'day-' + dayIndex" class="mb-8">
                    <!-- Day Header with Weather -->
                    <div class="sticky top-0 bg-slate-50/95 backdrop-blur py-3 z-10 border-b border-slate-100 mb-4">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-2 h-8 bg-purple-600 rounded-r-lg"></div>
                                <div>
                                    <h2 class="text-xl font-bold text-slate-800 leading-none">
                                        Day {{ dayIndex }} 
                                    </h2>
                                    <span class="text-xs font-normal text-slate-500">{{ day.date }}</span>
                                </div>
                            </div>
                            <!-- Daily Weather -->
                            <div class="flex items-center gap-2 bg-white px-3 py-1 rounded-full shadow-sm border border-slate-100">
                                <i :class="day.weather.icon + ' text-yellow-500'"></i>
                                <span class="text-sm font-bold text-slate-700">{{ day.weather.temp }}¬∞C</span>
                                <span class="text-xs text-slate-400">{{ day.weather.desc }}</span>
                            </div>
                        </div>
                        <div class="ml-5 mt-1">
                            <span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">{{ day.location }}</span>
                        </div>
                    </div>

                    <!-- Timeline Events -->
                    <div class="relative pl-2">
                        <div v-for="(event, eventIndex) in day.events" :key="eventIndex" class="relative pl-8 pb-8 group last-item">
                            <!-- Line -->
                            <div class="timeline-line group-last:hidden"></div>
                            
                            <!-- Icon -->
                            <div class="absolute left-0 top-1 w-10 h-10 rounded-full flex items-center justify-center border-4 border-slate-50 shadow-sm z-10"
                                 :class="getIconColor(event.type)">
                                <i :class="event.icon + ' text-white text-sm'"></i>
                            </div>

                            <!-- Card -->
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 active:scale-[0.98] transition-transform" @click="handleCardClick(event)">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="text-sm font-bold text-slate-400 font-mono">{{ event.time }}</span>
                                    <div class="flex gap-1">
                                        <span v-if="event.tag" :class="getTagColor(event.tag)" class="text-[10px] px-2 py-1 rounded-full font-bold">
                                            {{ event.tag }}
                                        </span>
                                    </div>
                                </div>
                                <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight">{{ event.title }}</h3>
                                <p v-if="event.desc" class="text-sm text-slate-500 mb-2 leading-relaxed" v-html="highlightText(event.desc)"></p>
                                
                                <!-- Meta/Actions -->
                                <div class="flex flex-wrap gap-2 mt-3">
                                    <a v-if="event.location" :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(event.location)" target="_blank" @click.stop 
                                       class="inline-flex items-center gap-1 text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1.5 rounded-lg transition-colors">
                                        <i class="fas fa-map-marker-alt text-red-500"></i> Â∞éËà™
                                    </a>
                                    
                                    <!-- Story Link -->
                                    <a v-if="event.storyLink" :href="event.storyLink" target="_blank" @click.stop 
                                       class="inline-flex items-center gap-1 text-xs bg-orange-50 hover:bg-orange-100 text-orange-600 px-3 py-1.5 rounded-lg transition-colors border border-orange-100">
                                        <i class="fas fa-book-open"></i> ÊïÖ‰∫ã
                                    </a>

                                    <button v-if="event.code || event.detail" @click.stop="openDetailModal(event)" 
                                            class="inline-flex items-center gap-1 text-xs bg-purple-50 text-purple-700 px-3 py-1.5 rounded-lg border border-purple-100">
                                        <i class="fas fa-info-circle"></i> {{ event.code ? 'Êü•Áúã‰ª£Ëôü' : 'Ë©≥Á¥∞Ë≥áË®ä' }}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Add Event Button for this day -->
                        <div class="pl-8 pb-4">
                            <button @click="promptAddEvent(dayIndex)" class="w-full py-3 rounded-xl border-2 border-dashed border-slate-300 text-slate-400 hover:text-purple-600 hover:border-purple-300 hover:bg-purple-50 transition-all flex items-center justify-center text-sm font-bold">
                                <i class="fas fa-plus mr-2"></i> Êñ∞Â¢ûË°åÁ®ãËá≥ Day {{ dayIndex }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LIST (Checklist) -->
            <div v-else-if="currentTab === 'list'" class="pt-4">
                <h2 class="text-2xl font-bold mb-6 text-slate-800 px-2">Ë°åÂâçËàáË≥ºÁâ©</h2>
                <div class="flex bg-slate-200 p-1 rounded-xl mb-6">
                    <button @click="listTab = 'pack'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', listTab === 'pack' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">Ë°åÂâçÊâìÂåÖ</button>
                    <button @click="listTab = 'buy'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', listTab === 'buy' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">ÂæÖË≤∑Ê∏ÖÂñÆ</button>
                </div>

                <!-- Packing List -->
                <div v-if="listTab === 'pack'" class="space-y-3">
                    <div v-for="(item, idx) in packList" :key="idx" 
                         class="flex items-center bg-white p-4 rounded-xl shadow-sm border border-slate-100"
                         @click="item.checked = !item.checked">
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 transition-colors"
                             :class="item.checked ? 'bg-green-500 border-green-500' : 'border-slate-300'">
                            <i v-if="item.checked" class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <p :class="['font-medium transition-all', item.checked ? 'text-slate-400 line-through' : 'text-slate-800']">{{ item.text }}</p>
                            <p class="text-xs text-slate-400">{{ item.sub }}</p>
                        </div>
                    </div>
                    <button @click="addPackItem" class="w-full py-4 rounded-xl border-2 border-dashed border-slate-300 text-slate-400 font-bold hover:bg-slate-50 hover:border-purple-300 hover:text-purple-500 transition-all">
                        <i class="fas fa-plus mr-2"></i> Êñ∞Â¢ûÈ†ÖÁõÆ
                    </button>
                </div>

                <!-- Shopping List -->
                <div v-if="listTab === 'buy'" class="grid grid-cols-2 gap-4">
                    <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-xl overflow-hidden shadow-sm relative group">
                        <div class="h-32 bg-slate-200 flex items-center justify-center relative overflow-hidden">
                            <img v-if="item.img" :src="item.img" class="w-full h-full object-cover">
                            <i v-else class="fas fa-camera text-slate-400 text-2xl"></i>
                            <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                                <span class="text-white text-xs font-bold">Êõ¥ÊèõÁÖßÁâá</span>
                            </div>
                        </div>
                        <div class="p-3">
                            <input v-model="item.name" class="w-full font-bold text-slate-800 bg-transparent border-none p-0 focus:ring-0 placeholder-slate-400" placeholder="Ëº∏ÂÖ•ÂïÜÂìÅÂêç">
                            <input v-model="item.note" class="w-full text-xs text-slate-500 bg-transparent border-none p-0 focus:ring-0 placeholder-slate-300 mt-1" placeholder="ÂÇôË®ª (Â¶Ç: Ëó•Â¶ù)">
                        </div>
                        <button @click="removeShopItem(idx)" class="absolute top-2 right-2 w-6 h-6 bg-red-500 rounded-full text-white text-xs flex items-center justify-center shadow-md">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button @click="addShopItem" class="h-48 rounded-xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center text-slate-400 hover:bg-slate-50 hover:border-purple-300 hover:text-purple-500 transition-all">
                        <i class="fas fa-camera text-2xl mb-2"></i>
                        <span class="text-sm font-bold">Êñ∞Â¢ûÂïÜÂìÅ</span>
                    </button>
                </div>
            </div>

            <!-- VIEW: TOOLS (Currency, Driving & Budget) -->
            <div v-else-if="currentTab === 'tools'" class="pt-4 space-y-6">
                
                <!-- Driving HUD -->
                <div class="bg-slate-900 text-white rounded-3xl p-6 shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500 rounded-full blur-3xl opacity-20 -mr-10 -mt-10"></div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold italic"><i class="fas fa-car mr-2"></i>DRIVER HUD</h3>
                            <span class="bg-yellow-500 text-black text-xs font-bold px-2 py-1 rounded">Ëá™ÈßïÊ®°Âºè</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <button @click="showDriveTips = true" class="bg-white/10 hover:bg-white/20 p-3 rounded-xl text-left transition-colors">
                                <i class="fas fa-book text-blue-300 mb-2 block"></i>
                                <div class="text-sm font-bold">Ëá™ÈßïÊá∂‰∫∫ÂåÖ</div>
                                <div class="text-[10px] opacity-70">Âä†Ê≤π/Â†±Ë≠¶SOP</div>
                            </button>
                            <button @click="showMapCodes = true" class="bg-white/10 hover:bg-white/20 p-3 rounded-xl text-left transition-colors">
                                <i class="fas fa-map-marked-alt text-green-300 mb-2 block"></i>
                                <div class="text-sm font-bold">MapCodes</div>
                                <div class="text-[10px] opacity-70">Â∞éËà™‰ª£Á¢ºÊ∏ÖÂñÆ</div>
                            </button>
                        </div>
                        <div class="flex gap-2">
                             <a href="tel:110" class="flex-1 bg-red-600 hover:bg-red-700 py-3 rounded-xl flex items-center justify-center font-bold transition-colors">
                                <i class="fas fa-phone-alt mr-2"></i> 110 Ë≠¶ÂØü
                             </a>
                             <a href="tel:119" class="flex-1 bg-orange-600 hover:bg-orange-700 py-3 rounded-xl flex items-center justify-center font-bold transition-colors">
                                <i class="fas fa-ambulance mr-2"></i> 119 ÊïëË≠∑
                             </a>
                        </div>
                    </div>
                </div>

                <!-- Currency Converter -->
                <div class="bg-white rounded-3xl p-6 shadow-md border border-slate-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold text-slate-800">ÂåØÁéáÊèõÁÆó</h3>
                        <button @click="resetCurrency" class="w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-500">
                            <i class="fas fa-redo-alt text-xs"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-center mb-6">
                         <span class="text-slate-400 font-medium">1 JPY ‚âà 0.22 TWD</span>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-slate-50 rounded-2xl p-4 border border-slate-200 focus-within:border-purple-400 focus-within:ring-2 focus-within:ring-purple-100 transition-all">
                            <label class="text-xs font-bold text-slate-400 mb-1 block">Êó•Âπ£ (JPY)</label>
                            <input type="number" v-model="jpyAmount" @input="calculateTWD" class="w-full text-3xl font-bold bg-transparent border-none p-0 focus:ring-0 text-slate-800 placeholder-slate-300" placeholder="0">
                        </div>
                        <div class="flex justify-center">
                            <i class="fas fa-arrow-down text-purple-300"></i>
                        </div>
                        <div class="bg-purple-50 rounded-2xl p-4 border border-purple-100">
                            <label class="text-xs font-bold text-purple-400 mb-1 block">Âè∞Âπ£ (TWD)</label>
                            <div class="text-3xl font-bold text-purple-700">{{ twdAmount }}</div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Expense Tracker -->
                <div class="bg-white rounded-3xl p-6 shadow-md border border-slate-100 mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-slate-800">Ë®òÂ∏≥/È†êÁÆóË°®</h3>
                        <div class="text-right">
                            <div class="text-[10px] text-slate-400 uppercase">Á∏ΩÊîØÂá∫</div>
                            <span class="text-xs font-bold text-slate-600 mr-2">JPY {{ totalExpenseJPY.toLocaleString() }}</span>
                            <span class="text-xs font-bold text-slate-600">TWD {{ totalExpenseTWD.toLocaleString() }}</span>
                        </div>
                    </div>
                    
                    <!-- Input Form -->
                    <div class="space-y-3 mb-6 bg-slate-50 p-4 rounded-xl border border-slate-100">
                        <!-- Row 1: Item -->
                        <input v-model="newExpense.item" placeholder="Ê∂àË≤ªÈ†ÖÁõÆ (Â¶Ç: ÊôöÈ§ê)" class="w-full bg-white rounded-lg px-3 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                        
                        <!-- Row 2: Amount & Currency -->
                        <div class="flex gap-2">
                            <input v-model.number="newExpense.amount" type="number" placeholder="ÈáëÈ°ç" class="flex-1 bg-white rounded-lg px-3 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                            <select v-model="newExpense.currency" class="w-20 bg-white rounded-lg px-2 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                                <option value="JPY">JPY</option>
                                <option value="TWD">TWD</option>
                            </select>
                        </div>

                        <!-- Row 3: Day & Method -->
                        <div class="flex gap-2">
                            <select v-model="newExpense.day" class="flex-1 bg-white rounded-lg px-2 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                                <option v-for="(day, idx) in timelineData" :key="idx" :value="idx">Day {{ idx }}</option>
                            </select>
                            <select v-model="newExpense.method" class="flex-1 bg-white rounded-lg px-2 py-2 text-sm border border-slate-200 focus:ring-1 focus:ring-purple-300 outline-none">
                                <option value="cash">ÁèæÈáë</option>
                                <option value="credit">‰ø°Áî®Âç°</option>
                                <option value="mobile">Ë°åÂãïÊîØ‰ªò</option>
                                <option value="ic">ÈõªÂ≠êÁ•®Ë≠â</option>
                            </select>
                        </div>

                        <button @click="addExpense" class="w-full bg-slate-800 text-white rounded-lg py-2 text-sm font-bold hover:bg-slate-700 transition-colors">
                            <i class="fas fa-plus mr-1"></i> Âä†ÂÖ•Á¥ÄÈåÑ
                        </button>
                    </div>

                    <!-- Expense List (Grouped by Day) -->
                    <div class="space-y-4 max-h-60 overflow-y-auto pr-1">
                        <div v-for="(group, dayIdx) in groupedExpenses" :key="dayIdx" v-show="group.items.length > 0">
                            <div class="text-xs font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded mb-2 inline-block">Day {{ dayIdx }}</div>
                            <div class="space-y-2">
                                <div v-for="(exp, idx) in group.items" :key="idx" class="flex justify-between items-center text-sm p-2 bg-white border border-slate-100 rounded-lg shadow-sm">
                                    <div>
                                        <div class="text-slate-700 font-medium">{{ exp.item }}</div>
                                        <div class="text-[10px] text-slate-400">
                                            <span v-if="exp.method === 'credit'"><i class="far fa-credit-card"></i> ‰ø°Áî®Âç°</span>
                                            <span v-else-if="exp.method === 'mobile'"><i class="fas fa-mobile-alt"></i> Ë°åÂãïÊîØ‰ªò</span>
                                            <span v-else-if="exp.method === 'ic'"><i class="fas fa-subway"></i> ÈõªÂ≠êÁ•®Ë≠â</span>
                                            <span v-else><i class="fas fa-coins"></i> ÁèæÈáë</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span class="font-mono font-bold text-slate-600">{{ exp.currency }} {{ exp.amount.toLocaleString() }}</span>
                                        <button @click="removeExpense(exp.originalIndex)" class="text-slate-300 hover:text-red-400"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                                <!-- Daily Subtotal -->
                                <div class="text-right text-[10px] text-slate-400 pt-1 border-t border-dashed border-slate-200">
                                    Â∞èË®à: JPY {{ group.subtotal.JPY.toLocaleString() }} / TWD {{ group.subtotal.TWD.toLocaleString() }}
                                </div>
                            </div>
                        </div>
                        <div v-if="expenseList.length === 0" class="text-center text-slate-300 text-xs py-4">Â∞öÊú™Êñ∞Â¢û‰ªª‰ΩïÁ¥ÄÈåÑ</div>
                    </div>
                </div>
            </div>

            <!-- VIEW: INFO -->
            <div v-else-if="currentTab === 'info'" class="pt-4 space-y-4">
                <h2 class="text-2xl font-bold mb-4 text-slate-800 px-2">ÈáçË¶ÅË≥áË®ä</h2>
                <!-- Flight Card -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                    <h3 class="text-sm font-bold text-slate-400 mb-3 flex items-center"><i class="fas fa-plane mr-2"></i>Ëà™Áè≠Ë≥áË®ä (ÊòüÂÆáËà™Á©∫)</h3>
                    <div class="flex justify-between items-center mb-4 pb-4 border-b border-dashed border-slate-200">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-slate-800">TPE</div>
                            <div class="text-xs text-slate-500">Ê°ÉÂúí</div>
                        </div>
                        <div class="flex-1 flex flex-col items-center px-4">
                            <span class="text-xs text-purple-600 font-bold">JX846</span>
                            <div class="w-full h-px bg-slate-300 relative my-2">
                                <i class="fas fa-plane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-slate-400 text-xs bg-white px-1"></i>
                            </div>
                            <span class="text-xs text-slate-400">2h 00m</span>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-slate-800">KMJ</div>
                            <div class="text-xs text-slate-500">ÁÜäÊú¨</div>
                        </div>
                    </div>
                     <div class="bg-slate-50 rounded-lg p-3 flex justify-between items-center">
                        <span class="text-sm font-bold text-slate-600">Ë®Ç‰Ωç‰ª£Ëôü</span>
                        <span class="text-lg font-mono font-bold text-purple-600 select-all">D95RG3</span>
                    </div>
                </div>
                <!-- Hotel List -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                     <h3 class="text-sm font-bold text-slate-400 mb-3 flex items-center"><i class="fas fa-hotel mr-2"></i>‰ΩèÂÆøÊ∏ÖÂñÆ</h3>
                     <div class="space-y-4">
                         <div v-for="hotel in hotels" :key="hotel.name" class="flex gap-3 items-start">
                             <div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center shrink-0 text-sm font-bold">
                                 {{ hotel.day }}
                             </div>
                             <div class="flex-1">
                                 <h4 class="font-bold text-slate-800 text-sm leading-tight mb-1">{{ hotel.name }}</h4>
                                 <p class="text-xs text-slate-500 mb-1"><i class="fas fa-map-marker-alt mr-1"></i>{{ hotel.address }}</p>
                                 <div class="inline-flex items-center gap-2 bg-slate-50 px-2 py-1 rounded border border-slate-200">
                                     <span class="text-[10px] text-slate-400">È†êÁ¥ÑËôüÁ¢º</span>
                                     <span class="text-xs font-mono font-bold text-slate-700 select-all">{{ hotel.code }}</span>
                                 </div>
                             </div>
                         </div>
                     </div>
                </div>
            </div>

            <!-- VIEW: MAPS (Attractions & Backup) -->
            <div v-else-if="currentTab === 'map'" class="pt-4">
                <h2 class="text-2xl font-bold mb-4 text-slate-800 px-2">ÊôØÈªûÂ∞éËà™</h2>
                
                <!-- Toggle Map Tabs -->
                <div class="flex bg-slate-200 p-1 rounded-xl mb-4 mx-2">
                    <button @click="mapTab = 'route'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', mapTab === 'route' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">Ë°åÁ®ãÊôØÈªû</button>
                    <button @click="mapTab = 'backup'" :class="['flex-1 py-2 rounded-lg text-sm font-bold transition-all', mapTab === 'backup' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500']">ÂÇôÁî®ËàáË≥ºÁâ©</button>
                </div>

                <!-- Main Route -->
                <div v-if="mapTab === 'route'" class="grid grid-cols-1 gap-3">
                    <div v-for="spot in allSpots" :key="spot.name" class="bg-white rounded-xl p-3 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400">
                                <i :class="spot.icon"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">{{ spot.name }}</h4>
                                <span class="text-xs text-slate-500">{{ spot.area }}</span>
                            </div>
                        </div>
                        <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(spot.name)" target="_blank" 
                           class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 transition-colors">
                            <i class="fas fa-location-arrow"></i>
                        </a>
                    </div>
                </div>

                <!-- Backup & Shopping -->
                <div v-if="mapTab === 'backup'" class="space-y-3 pb-8">
                    <div v-for="group in backupSpots" :key="group.category">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 ml-2">{{ group.category }}</h3>
                        <div class="space-y-3">
                             <div v-for="spot in group.items" :key="spot.name" class="bg-white rounded-xl p-3 shadow-sm border border-slate-100">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-sm">{{ spot.name }}</h4>
                                        <p class="text-[10px] text-slate-500 mt-1"><i class="fas fa-map-marker-alt mr-1"></i>{{ spot.address }}</p>
                                    </div>
                                    <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(spot.address)" target="_blank" 
                                       class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 shrink-0">
                                        <i class="fas fa-location-arrow text-sm"></i>
                                    </a>
                                </div>
                                <div class="bg-slate-50 rounded px-2 py-1 flex justify-between items-center" @click="copyText(spot.code)">
                                    <span class="text-[10px] text-slate-400">Navi: ÈõªË©±/MapCode</span>
                                    <div class="flex items-center gap-1">
                                        <span class="text-xs font-mono font-bold text-slate-700">{{ spot.code }}</span>
                                        <i class="far fa-copy text-[10px] text-slate-400"></i>
                                    </div>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Spacer -->
            <div class="h-10"></div>
        </main>

        <!-- ================= BOTTOM NAVIGATION ================= -->
        <nav class="bg-white/90 backdrop-blur-md border-t border-slate-200 px-6 py-3 flex justify-between items-center z-20 shrink-0 shadow-[0_-5px_10px_rgba(0,0,0,0.02)]">
            <button @click="currentTab = 'home'" :class="navBtnClass('home')">
                <div class="text-xl mb-1"><i class="fas fa-stream"></i></div>
                <span class="text-[10px] font-bold">Ë°åÁ®ã</span>
            </button>
            <button @click="currentTab = 'map'" :class="navBtnClass('map')">
                <div class="text-xl mb-1"><i class="fas fa-map"></i></div>
                <span class="text-[10px] font-bold">Âú∞Âúñ</span>
            </button>
            
            <div class="-mt-8">
                <button @click="currentTab = 'list'" class="w-14 h-14 bg-purple-600 rounded-full shadow-lg shadow-purple-300 text-white flex items-center justify-center text-xl hover:scale-105 transition-transform">
                    <i class="fas fa-clipboard-check"></i>
                </button>
            </div>

            <button @click="currentTab = 'tools'" :class="navBtnClass('tools')">
                <div class="text-xl mb-1"><i class="fas fa-toolbox"></i></div>
                <span class="text-[10px] font-bold">Â∑•ÂÖ∑</span>
            </button>
            <button @click="currentTab = 'info'" :class="navBtnClass('info')">
                <div class="text-xl mb-1"><i class="fas fa-passport"></i></div>
                <span class="text-[10px] font-bold">Ë≥áË®ä</span>
            </button>
        </nav>

        <!-- ================= MODALS ================= -->
        <!-- Detail Modal -->
        <transition name="fade">
            <div v-if="showModal" class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4" @click.self="showModal = false">
                <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl transform transition-all scale-100">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4 text-purple-600 text-2xl">
                            <i :class="modalData.icon"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800">{{ modalData.title }}</h3>
                        <p class="text-sm text-slate-500 mt-1">{{ modalData.time }}</p>
                    </div>
                    <div v-if="modalData.code" class="bg-slate-50 rounded-xl p-4 mb-4 border border-slate-100 text-center">
                        <p class="text-xs text-slate-400 mb-1">È†êÁ¥Ñ/Ë®Ç‰Ωç‰ª£Ëôü</p>
                        <p class="text-2xl font-mono font-bold text-slate-800 select-all">{{ modalData.code }}</p>
                    </div>
                    <div class="text-sm text-slate-600 leading-relaxed mb-6">
                        {{ modalData.desc }}
                    </div>
                    <button @click="showModal = false" class="w-full bg-purple-600 text-white font-bold py-3 rounded-xl hover:bg-purple-700 transition-colors">
                        ÈóúÈñâ
                    </button>
                </div>
            </div>
        </transition>

        <!-- MapCode Modal -->
        <transition name="slide-up">
            <div v-if="showMapCodes" class="absolute inset-0 z-50 bg-white flex flex-col">
                <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h3 class="font-bold text-lg"><i class="fas fa-map-marked-alt text-green-500 mr-2"></i>MapCode Â∞éËà™Ê∏ÖÂñÆ</h3>
                    <button @click="showMapCodes = false" class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-4">
                    <div v-for="code in mapCodes" :key="code.place" class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm flex justify-between items-center">
                        <div>
                            <div class="font-bold text-slate-800">{{ code.place }}</div>
                            <div class="text-xs text-slate-400 mt-1">{{ code.note }}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-mono font-bold text-lg text-slate-700 select-all" @click="copyText(code.code)">{{ code.code }}</div>
                            <div class="text-[10px] text-green-500">ÈªûÊìäË§áË£Ω</div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Drive Tips Modal -->
        <transition name="slide-up">
            <div v-if="showDriveTips" class="absolute inset-0 z-50 bg-white flex flex-col">
                <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-purple-600 text-white">
                    <h3 class="font-bold text-lg"><i class="fas fa-book mr-2"></i>Ëá™ÈßïÊá∂‰∫∫ÂåÖ</h3>
                    <button @click="showDriveTips = false" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-5 space-y-6">
                    <section>
                        <h4 class="font-bold text-purple-700 mb-2 border-l-4 border-purple-500 pl-2">Âä†Ê≤πÊîªÁï•</h4>
                        <ul class="list-disc pl-5 text-sm text-slate-600 space-y-2">
                            <li><span class="text-red-500 font-bold">Á¥ÖËâ≤Ê≤πÊßç (Regular)</span>Ôºö‰∏ÄËà¨ÁßüËªäÂä†ÈÄôÂÄã (92/95)„ÄÇ</li>
                            <li><span class="text-yellow-500 font-bold">ÈªÉËâ≤Ê≤πÊßç (High Octane)</span>ÔºöÈ´òÁ¥öËªäÁî®„ÄÇ</li>
                            <li><span class="text-green-600 font-bold">Á∂†Ëâ≤Ê≤πÊßç (Diesel)</span>ÔºöÊü¥Ê≤π (Ê≥®ÊÑè‰ºëÊóÖËªäÂèØËÉΩÊòØÊü¥Ê≤π)„ÄÇ</li>
                            <li>Âè£Ë®£Ôºö„ÄåRegular, Mantan (Âä†Êªø)„Äç„ÄÇ</li>
                        </ul>
                    </section>
                    <section>
                        <h4 class="font-bold text-purple-700 mb-2 border-l-4 border-purple-500 pl-2">ÈáçË¶Å‰∫§ÈÄöË¶èÂâá</h4>
                        <div class="bg-red-50 p-3 rounded-lg border border-red-100 text-sm text-red-800">
                            <strong>Ê≠¢„Åæ„Çå (Tomare)</strong>ÔºöÂÄí‰∏âËßíÊ®ôË™åÂãôÂøÖ<span class="font-bold underline">ÂÆåÂÖ®ÈùúÊ≠¢ 3 Áßí</span>ÔºåÂ∑¶Âè≥ÁúãÊ≤íËªäÂÜçÈñã„ÄÇÈÄôÊòØÊúÄÂÆπÊòìË¢´ÊäìÁöÑÈÅïË¶èÔºÅ
                        </div>
                        <ul class="list-disc pl-5 text-sm text-slate-600 space-y-2 mt-2">
                            <li>Âè≥ÈßïÂ∑¶Ë°åÔºöÈõ®Âà∑Âú®Â∑¶ÔºåÊñπÂêëÁáàÂú®Âè≥„ÄÇ</li>
                            <li>Ë°å‰∫∫ÁµïÂ∞çÂÑ™ÂÖàÔºöÊñëÈ¶¨Á∑öÊúâ‰∫∫ÂøÖÈ†àÂÅú„ÄÇ</li>
                            <li>Âè≥ËΩâËªäÈúÄÁ¶ÆËÆìÁõ¥Ë°åËàáÂ∑¶ËΩâËªä„ÄÇ</li>
                        </ul>
                    </section>
                </div>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const currentTab = ref('home');
                const listTab = ref('pack');
                const mapTab = ref('route');
                const showModal = ref(false);
                const showMapCodes = ref(false);
                const showDriveTips = ref(false);
                const modalData = ref({});
                const currentDayIndex = ref(1); 
                
                // Weather
                const currentWeather = ref(12);
                const currentLocation = ref('Á¶èÂ≤°');

                // Currency
                const jpyAmount = ref('');
                const twdAmount = ref(0);
                const rate = 0.22;
                const calculateTWD = () => { twdAmount.value = Math.round(jpyAmount.value * rate); };
                const resetCurrency = () => { jpyAmount.value = ''; twdAmount.value = 0; }

                // Advanced Expense Tracker
                const newExpense = ref({ day: 0, item: '', amount: '', currency: 'JPY', method: 'cash' });
                const expenseList = ref([]);
                
                const addExpense = () => {
                    if (newExpense.value.item && newExpense.value.amount) {
                        expenseList.value.push({ ...newExpense.value, id: Date.now() });
                        newExpense.value.item = '';
                        newExpense.value.amount = '';
                        // Keep day, currency and method for faster entry
                    }
                };
                
                const removeExpense = (originalIndex) => {
                    // Find the item in the original list using id (since idx is from filtered loop)
                    // But here originalIndex passed from template logic is safest if we manage indices correctly.
                    // Let's rely on filter index if we pass the object directly?
                    // Simplified: We pass "originalIndex" which we map below.
                    expenseList.value.splice(originalIndex, 1);
                };

                const groupedExpenses = computed(() => {
                    const groups = {};
                    // Initialize groups for all timeline days
                    timelineData.forEach((day, idx) => {
                        groups[idx] = { items: [], subtotal: { JPY: 0, TWD: 0 } };
                    });

                    expenseList.value.forEach((exp, idx) => {
                        const dayIdx = exp.day !== undefined ? exp.day : 0;
                        if (groups[dayIdx]) {
                            groups[dayIdx].items.push({ ...exp, originalIndex: idx });
                            groups[dayIdx].subtotal[exp.currency] += exp.amount;
                        }
                    });
                    return groups;
                });

                const totalExpenseJPY = computed(() => expenseList.value.filter(e => e.currency === 'JPY').reduce((sum, item) => sum + item.amount, 0));
                const totalExpenseTWD = computed(() => expenseList.value.filter(e => e.currency === 'TWD').reduce((sum, item) => sum + item.amount, 0));

                // Countdown
                const tripDate = new Date('2025-12-03');
                const today = new Date();
                const daysUntilTrip = Math.ceil((tripDate - today) / (1000 * 60 * 60 * 24));

                // Data: Hotels
                const hotels = [
                    { day: 'D0', name: 'ÂüéÂ∏ÇÂïÜÊóÖÊ°ÉÂúíËà™Á©∫È§®', address: 'Ê°ÉÂúíÂ∏ÇÂ§ßÂúíÂçÄ‰∏≠Ê≠£Êù±Ë∑Ø442Ëôü', code: 'GTTMMGGZPU' },
                    { day: 'D1', name: 'KOKO HOTEL Á¶èÂ≤°Â§©Á•û', address: 'Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂçÄ‰ªäÊ≥â 1-22-14', code: 'IN1437799796' },
                    { day: 'D3', name: 'ÈªëÂ∑ùÊ∫´Ê≥â Yamabiko ÊóÖÈ§®', address: 'ÁÜäÊú¨ÁúåÈòøËòáÈÉ°ÂçóÂ∞èÂõΩÁî∫ÈªíÂ∑ù 6704', code: 'RYa0kr1u0r' },
                    { day: 'D4', name: 'SOLEST È´òÂçÉÁ©óÈ£ØÂ∫ó', address: 'È´òÂçÉÁ©óÁî∫‰∏âÁî∞‰∫ï 1261-1', code: 'AGRJWYNZND' },
                    { day: 'D5', name: 'Candeo Hotels ÁÜäÊú¨Êñ∞Â∏ÇË°ó', address: 'ÁÜäÊú¨Â∏Ç‰∏≠Â§ÆÂå∫Êñ∞Â∏ÇË°ó 8-7', code: '3036-3012-3431' }
                ];

                // Data: Map Codes
                const mapCodes = [
                    { place: 'TOYOTA Ëñ¨Èô¢ÈßÖÂâçÂ∫ó', code: '13 287 083*63', note: 'ÂèñËªäËôï' },
                    { place: 'Â§ßËßÄÂ≥∞Â±ïÊúõÊâÄ', code: '256 878 352*74', note: 'ÁµïÊôØ' },
                    { place: 'ËçâÂçÉÈáå‰πãÊø±', code: '256 456 835*36', note: 'È®éÈ¶¨È´îÈ©ó' },
                    { place: 'ÈòøËòáÁÅ´Âè£', code: '256 456 805*11', note: 'Êî∂Ë≤ªÈÅìË∑ØÂÖ•Âè£' },
                    { place: '‰∏äËâ≤Ë¶ãÁÜäÈáéÂ∫ßÁ•ûÁ§æ', code: '257 886 475*70', note: 'Ëû¢ÁÅ´‰πãÊ£ÆÂ†¥ÊôØ' },
                    { place: 'È´òÂçÉÁ©óÂ≥ΩÂÅúËªäÂ†¥', code: '330 711 731*58', note: 'Âæ°ÈπΩ‰∫ï(ÊúÄËøë)' },
                    { place: 'TOYOTA ÁÜäÊú¨Á´ôÂâçÂ∫ó', code: '29 428 586*66', note: 'ÈÇÑËªäËôï' },
                ];

                // Data: Backup Spots
                const backupSpots = [
                    {
                        category: "‰ºëÊÅØÁ´ô (ÈÅì‰πãÈ©õ)",
                        items: [
                            { name: "ÈÅì‰πãÈ©õ ÈòøËòá", address: "ÁÜäÊú¨ÁúåÈòøËòáÂ∏ÇÈªíÂ∑ù1440-1", code: "0967-35-5077" },
                            { name: "ÈÅì‰πãÈ©õ ‰∏ÉÂüéMelon Dome", address: "ÁÜäÊú¨ÁúåËèäÊ±†Â∏Ç‰∏ÉÂüéÁî∫Â≤°Áî∞306", code: "0968-25-5757" }
                        ]
                    },
                    {
                        category: "Ë≥ºÁâ© (Bic Camera / Yodobashi)",
                        items: [
                            { name: "Bic Camera Â§©Á•û1ËôüÈ§®", address: "Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂå∫‰ªäÊ≥â1-25-1", code: "092-732-1112" },
                            { name: "Bic Camera Â§©Á•û2ËôüÈ§®", address: "Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂå∫Â§©Á•û2-4-5", code: "092-732-1111" },
                            { name: "Bic Camera ÁÜäÊú¨Â∫ó", address: "ÁÜäÊú¨Â∏ÇË•øÂå∫Êò•Êó•3-15-60", code: "096-323-1111" },
                            { name: "Yodobashi ÂçöÂ§ö", address: "Á¶èÂ≤°Â∏ÇÂçöÂ§öÂå∫ÂçöÂ§öÈßÖ‰∏≠Â§ÆË°ó6-12", code: "092-471-1010" }
                        ]
                    },
                    {
                        category: "Ë≥ºÁâ© (ÂîêÂêâË®∂Âæ∑)",
                        items: [
                            { name: "ÂîêÂêâË®∂Âæ∑ Á¶èÂ≤°Â§©Á•ûÊú¨Â∫ó", address: "Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂå∫‰ªäÊ≥â1-20-17", code: "092-736-5911" },
                            { name: "ÂîêÂêâË®∂Âæ∑ ÂçöÂ§öÁ´ôÂçóÂ∫ó", address: "Á¶èÂ≤°Â∏ÇÂçöÂ§öÂå∫Êù±ÂÖâÂØ∫Áî∫2-6-40", code: "092-432-6511" },
                            { name: "ÂîêÂêâË®∂Âæ∑ ÂçöÂ§ö‰∏∏‰∫ïÂ∫ó", address: "Á¶èÂ≤°Â∏ÇÂçöÂ§öÂå∫ÂçöÂ§öÈßÖ‰∏≠Â§ÆË°ó9-1 3F", code: "092-433-3811" },
                            { name: "ÂîêÂêâË®∂Âæ∑ ÁÜäÊú¨‰∏ãÈÄöÂ∫ó", address: "ÁÜäÊú¨Â∏Ç‰∏≠Â§ÆÂå∫ÂÆâÊîøÁî∫5-27", code: "096-324-5511" },
                            { name: "ÂîêÂêâË®∂Âæ∑ ÂçóÁÜäÊú¨Â∫ó", address: "ÁÜäÊú¨Â∏Ç‰∏≠Â§ÆÂå∫ÂçóÁÜäÊú¨1-9-25", code: "096-375-6511" }
                        ]
                    },
                    {
                        category: "ÁæéÈ£üÂÇôÊ°à",
                        items: [
                            { name: "Ê≤ª‰∏ÄÈÉéÂ∏É‰∏Å (ÂçöÂ§öÁ´ô)", address: "JRÂçöÂ§öÂüé AMU PLAZA B1F", code: "092-409-6720" },
                            { name: "È∫µÂ±ãÂÖºËôé Â§©Á•ûÊú¨Â∫ó", address: "Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂå∫Ê∏°Ëæ∫ÈÄö4-9-18", code: "092-726-7121" },
                            { name: "È∫µÂ±ãÂÖºËôé Á¶èÂ≤°PARCO", address: "Á¶èÂ≤°PARCOÊú¨È§® B1F", code: "092-235-7226" },
                            { name: "È∫µÂ±ãÂÖºËôé ÂçöÂ§öÂ∫ó", address: "ÂçöÂ§öDeitos 2F ÊãâÈ∫µË°óÈÅì", code: "092-477-3113" },
                            { name: "ÁÇ∏Ë±¨Êéí WAKABA", address: "Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂå∫Â§©Á•û1-15-36", code: "092-732-1209" }
                        ]
                    },
                    {
                        category: "Ë•øÊùëË£ï‰∫åÂïÜÂìÅ",
                        items: [
                            { name: "Á¶èÂ≤°Â§©Á•û LOFT", address: "Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂå∫Ê∏°Ëæ∫ÈÄö4-9-25", code: "092-724-6210" },
                            { name: "Animate Á¶èÂ≤°Parco", address: "Á¶èÂ≤°PARCOÊú¨È§® 8F", code: "092-732-8070" },
                            { name: "Village Vanguard", address: "Á¶èÂ≤°PARCOÊú¨È§® 7F (ÈÄöÂ∏∏‰ΩçÁΩÆ)", code: "ÈúÄÁ¢∫Ë™çÂàÜÂ∫ó" }
                        ]
                    }
                ];

                // Data: Packing List
                const packList = ref([
                    { text: 'Ë≠∑ÁÖß (ÂÖ®ÂÆ∂)', sub: 'ÊïàÊúüÈúÄ > 6ÂÄãÊúà', checked: false },
                    { text: 'ÈßïÁÖßÊ≠£Êú¨ + Êó•ÊñáË≠ØÊú¨', sub: 'ÁßüËªäÂøÖÂÇôÔºÅ', checked: false },
                    { text: 'VJW QR Code Êà™Âúñ', sub: 'Êµ∑Èóú/ÁßªÊ∞ëÂÆò', checked: false },
                    { text: '‰ø°Áî®Âç° (Êµ∑Â§ñÂõûÈ•ãÈ´ò)', sub: 'JCB‰Ω≥', checked: false },
                    { text: 'Á∂≤Âç° / Êº´ÈÅäÈñãÈÄö', sub: 'Á¢∫Ë™çË®äËôü', checked: false },
                    { text: 'Ë°åÂãïÈõªÊ∫ê + Á∑ö', sub: 'ÊâãÊèê‰∏äÊ©ü', checked: false },
                    { text: '‰øùÊöñË°£Áâ©', sub: 'Ê¥ãËî•ÂºèÁ©øÊ≥ï', checked: false },
                ]);

                const addPackItem = () => {
                    const text = prompt('Ëº∏ÂÖ•Êñ∞È†ÖÁõÆ:');
                    if(text) packList.value.push({ text, sub: 'Êñ∞Â¢ûÈ†ÖÁõÆ', checked: false });
                };

                // Data: Shopping List
                const shoppingList = ref([
                    { name: 'ÂêàÂà©‰ªñÂëΩ EX Plus', note: 'Âπ´Áà∏Â™ΩË≤∑', img: '' },
                    { name: 'Á¶èÂ≤°ËçâËéì', note: 'È£ØÂ∫óÂêÉ', img: '' },
                ]);
                
                const addShopItem = () => {
                    shoppingList.value.push({ name: '', note: '', img: '' });
                };
                const removeShopItem = (idx) => {
                    shoppingList.value.splice(idx, 1);
                };

                // Data: Timeline (Reactive for adding items)
                const timelineData = ref([
                    {
                        date: '12/2 (‰∫å)', location: 'Ê°ÉÂúí',
                        weather: { icon: 'fas fa-moon', temp: 18, desc: 'Èô∞Â§©' },
                        events: [
                            { time: '22:11', title: 'È´òÈêµÂá∫Áôº', type: 'train', icon: 'fas fa-train', desc: 'Ëá∫ÂçóÁ´ô(696) ‚Üí Ê°ÉÂúíÁ´ô', location: 'È´òÈêµÊ°ÉÂúíÁ´ô' },
                            { time: '23:30', title: 'È£ØÂ∫ó Check-in', type: 'hotel', icon: 'fas fa-bed', desc: 'ÂüéÂ∏ÇÂïÜÊóÖÊ°ÉÂúíËà™Á©∫È§®', location: 'ÂüéÂ∏ÇÂïÜÊóÖÊ°ÉÂúíËà™Á©∫È§®', code: 'GTTMMGGZPU' }
                        ]
                    },
                    {
                        date: '12/3 (‰∏â)', location: 'ÁÜäÊú¨/Á¶èÂ≤°',
                        weather: { icon: 'fas fa-cloud-sun', temp: 14, desc: 'Â§öÈõ≤' },
                        events: [
                            { time: '07:30', title: 'Êê≠Ê©üÂâçÂæÄÁÜäÊú¨', type: 'plane', icon: 'fas fa-plane-departure', desc: 'ÊòüÂÆá JX846„ÄÇÂª∫Ë≠∞ 05:30 ÊäµÈÅîÊ©üÂ†¥„ÄÇ', code: 'D95RG3' },
                            { time: '11:30', title: 'ÊäµÈÅî & ÁßªÂãï', type: 'bus', icon: 'fas fa-bus', desc: 'Ê©üÂ†¥Â∑¥Â£´ ‚Üí ÁÜäÊú¨ÈßÖ (Á¥Ñ1hr)', location: 'ÈòøËòáÁÜäÊú¨Ê©üÂ†¥' },
                            { time: '12:30', title: 'ÂçàÈ§ê: ÁÅ´Ëªä‰æøÁï∂', type: 'food', icon: 'fas fa-bento', tag: 'ÁâπËâ≤', desc: 'Âú®ÁÜäÊú¨ÈßÖË≥ºË≤∑Áï∂Âú∞ÁâπËâ≤Ekiben„ÄÇ', location: 'ÁÜäÊú¨ÈßÖ' },
                            { time: '13:00', title: 'Êñ∞ÂππÁ∑ö ‚Üí ÂçöÂ§ö', type: 'train', icon: 'fas fa-subway', desc: 'Ë®òÂæóÈ†êÁ¥Ñ„ÄåÁâπÂ§ßËç∑Áâ©Â∏≠„Äç„ÄÇ', location: 'ÁÜäÊú¨ÈßÖ' },
                            { time: '15:30', title: 'Ê´õÁî∞Á•ûÁ§æ & Â∑ùÁ´ØÈÄö', type: 'sight', icon: 'fas fa-torii-gate', desc: 'ÂçöÂ§öÁ∏ΩÈéÆÂÆàÔºåÂøÖÁúãÂ∑®Â§ßÂ±±Á¨†„ÄÇÂïÜÂ∫óË°óÂêÉÁ¥ÖË±ÜÈ∫ªÁ≥¨ÊπØ„ÄÇ', location: 'Ê´õÁî∞Á•ûÁ§æ', storyLink: 'https://zh.wikipedia.org/zh-tw/%E6%AB%9B%E7%94%B0%E7%A5%9E%E7%A4%BE' },
                            { time: '18:00', title: 'ÊôöÈ§ê: ÁÇ∏Ë±¨Êéí/ÊãâÈ∫µ', type: 'food', icon: 'fas fa-utensils', tag: 'ÂøÖÂêÉ', desc: 'Êé®Ëñ¶„ÄåÁÇ∏Ë±¨Êéí WAKABA„ÄçÊàñ„ÄåÈ∫µÂ±ãÂÖºËôé„Äç„ÄÇ', location: 'Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂå∫Â§©Á•û1-15-36' }
                        ]
                    },
                    {
                        date: '12/4 (Âõõ)', location: 'Â§™ÂÆ∞Â∫ú',
                        weather: { icon: 'fas fa-sun', temp: 13, desc: 'Êô¥Â§©' },
                        events: [
                            { time: '10:00', title: 'Á´àÈñÄÁ•ûÁ§æ', type: 'sight', icon: 'fas fa-leaf', tag: 'Ë≥ûÊ•ì', desc: 'È¨ºÊªÖËÅñÂú∞ + Ë≥ûÊ•ìÂêçÊâÄ„ÄÇÈúÄÊê≠Â∑¥Â£´ÂâçÂæÄ„ÄÇ', location: 'Á´àÈñÄÁ•ûÁ§æ', storyLink: 'https://kamadojinja.or.jp/' },
                            { time: '11:30', title: 'Â§™ÂÆ∞Â∫úÂ§©ÊªøÂÆÆ', type: 'sight', icon: 'fas fa-torii-gate', desc: 'ÂèÉÈÅìÂêÉÊ¢ÖÊûùÈ§ÖÔºåÁúãÈöàÁ†îÂêæÊòüÂ∑¥ÂÖã„ÄÇ', location: 'Â§™ÂÆ∞Â∫úÂ§©ÊªøÂÆÆ', storyLink: 'https://www.dazaifutenmangu.or.jp/' },
                            { time: '12:30', title: 'ÂçàÈ§ê: ‰∏ÄËò≠ÊãâÈ∫µ', type: 'food', icon: 'fas fa-utensils', tag: 'ÁâπËâ≤', desc: 'Â§™ÂÆ∞Â∫úÂèÉÈÅìÂ∫óÔºåÂøÖÈªû„Äå‰∫îËßíÂΩ¢ÂêàÊ†ºÁ¢ó„Äç„ÄÇ', location: '‰∏ÄËò≠ Â§™ÂÆ∞Â∫úÂèÇÈÅìÂ∫ó' },
                            { time: '18:00', title: 'ÊôöÈ§ê: Shin-Shin', type: 'food', icon: 'fas fa-utensils', tag: 'ÊéíÈöäÂ∫ó', desc: 'ÂçöÂ§öÊãâÈ∫µÂêçÂ∫óÔºåÂª∫Ë≠∞ÈÅøÈñãÂ∞ñÂ≥∞„ÄÇ', location: 'ÂçöÂ§ö„Çâ„Éº„ÇÅ„Çì Shin-Shin Â§©Á•ûÊú¨Â∫ó' }
                        ]
                    },
                    {
                        date: '12/5 (‰∫î)', location: 'ÈòøËòá',
                        weather: { icon: 'fas fa-cloud', temp: 8, desc: 'ÂØíÂÜ∑' },
                        events: [
                            { time: '10:00', title: 'ÁßüËªäÂá∫Áôº', type: 'car', icon: 'fas fa-car', tag: 'Ëá™Èßï', desc: 'TOYOTA Ëñ¨Èô¢ÈßÖÂâçÂ∫ó„ÄÇÊ™¢Êü•Èõ™ËÉé/ETC„ÄÇ', location: '„Éà„É®„Çø„É¨„É≥„Çø„Ç´„Éº Ëñ¨Èô¢ÈßÖÂâç', code: 'MapCode: 13 287 083*63' },
                            { time: '13:00', title: 'Â§ßËßÄÂ≥∞Â±ïÊúõÊâÄ', type: 'sight', icon: 'fas fa-mountain', desc: '360Â∫¶Áú∫ÊúõÈòøËòá‰∫îÂ≤≥ËàáÁ†¥ÁÅ´Â±±Âè£„ÄÇ', location: 'Â§ßËßÄÂ≥∞' },
                            { time: '14:30', title: 'ËçâÂçÉÈáå & ÁÅ´Âè£', type: 'sight', icon: 'fas fa-volcano', desc: 'ÁúãÁÅ´Â±±Ê∞£È´îÁãÄÊ≥Å„ÄÇËçâÂçÉÈáå‰∏ÄÁâáÈáëÈªÉ„ÄÇ', location: 'ÈòøËòáËçâÂçÉÈáå', storyLink: 'https://zh.wikipedia.org/zh-tw/%E9%98%BF%E8%98%87%E5%B1%B1' },
                            { time: '17:00', title: 'Check-in ÈªëÂ∑ùÊ∫´Ê≥â', type: 'hotel', icon: 'fas fa-hot-tub', desc: 'Yamabiko ÊóÖÈ§®Ôºå‰∫´ÂèóÈú≤Â§©‰ªô‰∫∫È¢®ÂëÇ„ÄÇ', location: 'ÈªíÂ∑ùÊ∏©Ê≥â „ÇÑ„Åæ„Å≥„ÅìÊóÖÈ§®', code: 'RYa0kr1u0r' }
                        ]
                    },
                    {
                        date: '12/6 (ÂÖ≠)', location: 'È´òÂçÉÁ©ó',
                        weather: { icon: 'fas fa-sun', temp: 10, desc: 'Êô¥ÊôÇÂ§öÈõ≤' },
                        events: [
                            { time: '09:30', title: 'ÁßªÂãï ‚Üí ÂçóÈòøËòá', type: 'car', icon: 'fas fa-car', desc: 'Ê≥®ÊÑèË∑ØÈù¢ÊòØÂê¶ÁµêÂÜ∞„ÄÇ' },
                            { time: '10:30', title: '‰∏äËâ≤Ë¶ãÁÜäÈáéÂ∫ßÁ•ûÁ§æ', type: 'sight', icon: 'fas fa-tree', tag: 'ÁßòÂ¢É', desc: 'ÈÄöÂæÄÁï∞‰∏ñÁïåÁöÑÂèÉÈÅìÔºåËû¢ÁÅ´‰πãÊ£ÆÂ†¥ÊôØ„ÄÇ', location: '‰∏äËâ≤Ë¶ãÁÜäÈáéÂ∫ßÁ•ûÁ§æ', storyLink: 'https://kumamoto.guide/tw/spots/detail/12306' },
                            { time: '14:00', title: 'Â§©Â≤©Êà∂Á•ûÁ§æ', type: 'sight', icon: 'fas fa-praying-hands', desc: 'ÊúÄÂº∑ËÉΩÈáèÈªûÔºåÊ≠•Ë°åËá≥Â§©ÂÆâÊ≤≥ÂéüË®±È°ò„ÄÇ', location: 'Â§©Â≤©Êà∂Á•ûÁ§æ', storyLink: 'https://amanoiwato-jinja.jp/' },
                            { time: '16:00', title: 'È£ØÂ∫ó Check-in', type: 'hotel', icon: 'fas fa-bed', desc: 'SOLEST È´òÂçÉÁ©óÈ£ØÂ∫ó', location: '„ÇΩ„É¨„Çπ„ÉàÈ´òÂçÉÁ©Ç„Éõ„ÉÜ„É´', code: 'AGRJWYNZND' },
                            { time: '18:00', title: 'ÊôöÈ§ê: ÁáíËÇâ Âíå', type: 'food', icon: 'fas fa-drumstick-bite', tag: 'ÂøÖÂêÉ', desc: 'È´òÂçÉÁ©óÁâõÂêçÂ∫óÔºåÂãôÂøÖÊ∫ñÊôÇ„ÄÇ', location: 'È´òÂçÉÁ©ÇÁâõ„É¨„Çπ„Éà„É©„É≥Âíå', code: '0982-73-1109' },
                            { time: '20:00', title: 'Â§úÁ•ûÊ®Ç', type: 'sight', icon: 'fas fa-theater-masks', desc: 'È´òÂçÉÁ©óÁ•ûÁ§æÔºåÊ¨£Ë≥ûÂÇ≥Áµ±Á•ûË©±Ë°®Êºî„ÄÇ', location: 'È´òÂçÉÁ©óÁ•ûÁ§æ', storyLink: 'https://takachiho-kanko.info/tw/sightseeing/kagura.php' }
                        ]
                    },
                    {
                        date: '12/7 (Êó•)', location: 'ÁÜäÊú¨',
                        weather: { icon: 'fas fa-cloud-showers-heavy', temp: 11, desc: 'ÂçàÂæåÈõ®' },
                        events: [
                            { time: '09:00', title: 'È´òÂçÉÁ©óÂ≥ΩÂàíËàπ', type: 'sight', icon: 'fas fa-water', tag: 'È†êÁ¥Ñ', desc: 'ÂÅúÂæ°ÈπΩ‰∫ïÂÅúËªäÂ†¥„ÄÇÁúãÁúüÂêç‰∫ïÁÄëÂ∏É„ÄÇ', location: 'È´òÂçÉÁ©óÂ≥Ω', storyLink: 'https://takachiho-kanko.info/tw/sightseeing/' },
                            { time: '14:00', title: 'ÁÜäÊú¨ÈÇÑËªä', type: 'car', icon: 'fas fa-check-circle', desc: 'TOYOTA ÁÜäÊú¨Á´ôÂâçÂ∫ó„ÄÇË®òÂæóÂä†ÊªøÊ≤πÔºÅ', location: '„Éà„É®„Çø„É¨„É≥„Çø„Ç´„Éº ÁÜäÊú¨ÈßÖÂâç' },
                            { time: '15:00', title: 'Check-in È£ØÂ∫ó', type: 'hotel', icon: 'fas fa-bed', desc: 'Candeo Hotels È†ÇÊ®ìÊúâÂ§©Á©∫SPA„ÄÇ', location: '„Ç´„É≥„Éá„Ç™„Éõ„ÉÜ„É´„Ç∫ÁÜäÊú¨Êñ∞Â∏ÇË°ó' },
                            { time: '18:00', title: 'ÊôöÈ§ê: ÂãùÁÉà‰∫≠', type: 'food', icon: 'fas fa-utensils', tag: 'ÂøÖÂêÉ', desc: 'ÁÜäÊú¨ÂøÖÂêÉÁÇ∏Ë±¨ÊéíÔºåÂ∞±Âú®Êñ∞Â∏ÇË°ó„ÄÇ', location: 'ÂãùÁÉà‰∫≠ Êñ∞Â∏ÇË°óÊú¨Â∫ó' }
                        ]
                    },
                    {
                        date: '12/8 (‰∏Ä)', location: 'ÁÜäÊú¨Â∏ÇÂçÄ',
                        weather: { icon: 'fas fa-sun', temp: 15, desc: 'Êô¥Â§©' },
                        events: [
                            { time: '09:30', title: 'ÁÜäÊú¨Âüé & Âä†Ëó§Á•ûÁ§æ', type: 'sight', icon: 'fas fa-chess-rook', desc: 'Â§©ÂÆàÈñ£ËàáÈäÄÊùèÊ®π„ÄÇ', location: 'ÁÜäÊú¨Âüé', storyLink: 'https://castle.kumamoto-guide.jp/tw/' },
                            { time: '12:00', title: 'ÂçàÈ§ê: ÂüéÂΩ©Ëãë', type: 'food', icon: 'fas fa-ice-cream', desc: 'È´îÈ©óÊ±üÊà∂È¢®ÊÉÖÔºåÂêÉÊµ∑ËÜΩÂèØÊ®ÇÈ§Ö„ÄÇ', location: 'Ê°ú„ÅÆÈ¶¨Â†¥ ÂüéÂΩ©Ëãë' },
                            { time: '14:30', title: 'Ê∞¥ÂâçÂØ∫ÊàêË∂£Âúí', type: 'sight', icon: 'fas fa-leaf', desc: 'ÂÑ™ÈõÖÁöÑÊó•ÂºèÂ∫≠Âúí„ÄÇ', location: 'Ê∞¥ÂâçÂØ∫ÊàêË∂£Âúí' },
                            { time: '16:00', title: '‰∏ä‰∏ãÈÄöÂïÜÂ∫óË°ó', type: 'shopping', icon: 'fas fa-shopping-bag', tag: 'Ë≥ºÁâ©', desc: 'Ëó•Â¶ù„ÄÅ‰º¥ÊâãÁ¶ÆÊúÄÂæåË°ùÂà∫„ÄÇ', location: '‰∏ãÈÄöÂïÜÂ∫óË°ó' }
                        ]
                    },
                     {
                        date: '12/9 (‰∫å)', location: 'ËøîÂè∞',
                        weather: { icon: 'fas fa-cloud-sun', temp: 16, desc: 'Â§öÈõ≤' },
                        events: [
                            { time: '09:30', title: 'ÂâçÂæÄÊ©üÂ†¥', type: 'bus', icon: 'fas fa-bus', desc: 'ÂæûÊ´ªÁî∫Â∑¥Â£´Á∏ΩÁ´ôÊê≠Ëªä„ÄÇ', location: 'ÁÜäÊú¨Ê´ªÁî∫Â∑¥Â£´Á∏ΩÁ´ô' },
                            { time: '11:45', title: 'È£õÂæÄÊ°ÉÂúí', type: 'plane', icon: 'fas fa-plane-departure', desc: 'ÊòüÂÆá JX847„ÄÇ', code: 'D95RG3' },
                             { time: '15:43', title: 'È´òÈêµËøîÂè∞Âçó', type: 'train', icon: 'fas fa-train', desc: 'ËªäÊ¨° 655„ÄÇ', location: 'È´òÈêµÊ°ÉÂúíÁ´ô' }
                        ]
                    }
                ]);

                // --- Methods ---
                const getIconColor = (type) => {
                    const colors = {
                        plane: 'bg-blue-400 border-blue-100',
                        train: 'bg-indigo-400 border-indigo-100',
                        bus: 'bg-teal-400 border-teal-100',
                        car: 'bg-yellow-400 border-yellow-100',
                        hotel: 'bg-purple-500 border-purple-100',
                        food: 'bg-orange-400 border-orange-100',
                        sight: 'bg-pink-400 border-pink-100',
                        shopping: 'bg-red-400 border-red-100'
                    };
                    return colors[type] || 'bg-gray-400';
                };

                const getTagColor = (tag) => {
                    if (tag === 'ÂøÖÂêÉ') return 'bg-orange-100 text-orange-600';
                    if (tag === 'Ëá™Èßï') return 'bg-blue-100 text-blue-600';
                    if (tag === 'È†êÁ¥Ñ') return 'bg-red-100 text-red-600';
                    if (tag === 'Ë≥ºÁâ©') return 'bg-yellow-100 text-yellow-700';
                    if (tag === 'ÁâπËâ≤') return 'bg-green-100 text-green-700';
                    return 'bg-gray-100 text-gray-600';
                };

                const navBtnClass = (tab) => {
                    return `flex flex-col items-center justify-center w-full h-full transition-colors ${currentTab.value === tab ? 'text-purple-600' : 'text-slate-400 hover:text-slate-600'}`;
                };

                const scrollToDay = (index) => {
                    currentDayIndex.value = index;
                    const el = document.getElementById(`day-${index}`);
                    if (el) {
                        const mainContent = document.getElementById('main-content');
                        mainContent.scrollTo({
                            top: el.offsetTop - 20,
                            behavior: 'smooth'
                        });
                    }
                };

                const handleCardClick = (event) => {
                    if (event.code || event.detail) {
                        openDetailModal(event);
                    }
                };

                const openDetailModal = (event) => {
                    modalData.value = {
                        title: event.title,
                        time: event.time,
                        desc: event.desc,
                        icon: event.icon,
                        code: event.code || ''
                    };
                    showModal.value = true;
                };

                const copyText = (text) => {
                    navigator.clipboard.writeText(text).then(() => {
                        alert(`Â∑≤Ë§áË£Ω: ${text}`);
                    });
                };

                const highlightText = (text) => {
                    return text.replace(/(ÂøÖÂêÉ|ÂøÖÈªû|ÂøÖË≤∑)/g, '<span class="text-orange-500 font-bold">$1</span>');
                };

                // Add Event Prompt
                const promptAddEvent = (dayIndex) => {
                    const time = prompt('Ë´ãËº∏ÂÖ•ÊôÇÈñì (‰æãÂ¶Ç 14:00):', '10:00');
                    if (!time) return;
                    const title = prompt('Ë´ãËº∏ÂÖ•Ë°åÁ®ãÊ®ôÈ°å:', 'Êñ∞Ë°åÁ®ã');
                    if (!title) return;
                    const desc = prompt('Ë´ãËº∏ÂÖ•Ë™™Êòé/ÂÇôË®ª:', '');

                    timelineData.value[dayIndex].events.push({
                        time: time,
                        title: title,
                        desc: desc || '',
                        type: 'sight', // default
                        icon: 'fas fa-map-pin',
                        location: title // assume title is location for map search
                    });
                    
                    // Re-sort events by time (simple string sort)
                    timelineData.value[dayIndex].events.sort((a, b) => a.time.localeCompare(b.time));
                };

                const allSpots = computed(() => {
                    const spots = [];
                    timelineData.value.forEach(day => {
                        day.events.forEach(event => {
                            if (event.location) {
                                spots.push({
                                    name: event.location,
                                    area: day.location,
                                    icon: event.icon
                                });
                            }
                        });
                    });
                    return spots;
                });

                return {
                    currentTab, listTab, mapTab, showModal, showMapCodes, showDriveTips, modalData,
                    currentWeather, currentLocation, daysUntilTrip,
                    jpyAmount, twdAmount, calculateTWD, resetCurrency,
                    newExpense, expenseList, addExpense, removeExpense, totalExpenseJPY, totalExpenseTWD, groupedExpenses,
                    timelineData, hotels, mapCodes, packList, shoppingList, backupSpots,
                    addPackItem, addShopItem, removeShopItem,
                    getIconColor, getTagColor, navBtnClass, scrollToDay, currentDayIndex,
                    handleCardClick, openDetailModal, copyText, highlightText, allSpots,
                    promptAddEvent
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
