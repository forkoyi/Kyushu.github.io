<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹å·æ—…å¸– - è¡Œç¨‹ç¸½è¦½</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Lucide Icons (ç”¨æ–¼åœ–ç¤º) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ï¼Œè®“å®ƒåœ¨ç¾è§€ä¸Šæ›´åƒç§»å‹•æ‡‰ç”¨ */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* å­—é«”è¨­å®š */
        :root {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-[#f5f2eb] flex justify-center min-h-screen p-0 sm:p-4">

    <!-- App Container -->
    <div id="app-container" class="w-full max-w-md bg-[#fdfbf7] min-h-screen shadow-2xl relative flex flex-col sm:rounded-2xl">
        
        <!-- Header will be rendered here -->
        <header id="app-header" class="sticky top-0 z-10 bg-[#fdfbf7]/90 backdrop-blur-md border-b border-stone-200 px-5 py-4 flex justify-between items-end shrink-0">
            <!-- Header content will be generated by JS -->
        </header>

        <!-- Main Content Area -->
        <main id="app-main" class="flex-1 overflow-y-auto scrollbar-hide">
            <!-- Itinerary or Tools content will be rendered here -->
        </main>

        <!-- Bottom Tab Bar -->
        <nav class="sticky bottom-0 bg-white border-t border-stone-200 px-6 py-3 flex justify-around pb-6 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] shrink-0">
            <button id="tab-itinerary" class="flex flex-col items-center gap-1 transition-colors text-stone-800">
                <i data-lucide="calendar" class="w-6 h-6" style="stroke-width: 2.5;"></i>
                <span class="text-[10px] font-medium">è¡Œç¨‹</span>
            </button>
            
            <div class="w-px h-8 bg-stone-200 mx-2 self-center"></div>

            <button id="tab-tools" class="flex flex-col items-center gap-1 transition-colors text-stone-400">
                <i data-lucide="briefcase" class="w-6 h-6" style="stroke-width: 2;"></i>
                <span class="text-[10px] font-medium">å·¥å…·ç®±</span>
            </button>
        </nav>

        <!-- Modal Placeholder -->
        <div id="modal-placeholder"></div>

    </div>

    <script>
        // å…¨å±€ç‹€æ…‹ç®¡ç†
        let activeTab = 'itinerary';
        let selectedDayIndex = 0;
        let selectedItem = null;

        // --- è¡Œç¨‹è³‡æ–™ (å·²æ›´æ–° 12/2 è³‡è¨Šèˆ‡æ‰€æœ‰è¨‚ä½ä»£è™Ÿ) ---
        const itineraryData = [
            // 12/2 (é€±äºŒ)
            {
                date: '12/2',
                dayOfWeek: 'é€±äºŒ',
                weather: { temp: '22Â°C', icon: 'cloud' },
                items: [
                    { id: '0-1', time: '18:00', title: 'å°ç£é«˜éµ (æº–å‚™å‡ºç™¼)', type: 'transport', location: 'é«˜éµxxxç«™ â†’ é«˜éµæ¡ƒåœ’ç«™', description: 'æ­ä¹˜é«˜éµå‰å¾€æ¡ƒåœ’ï¼Œæº–å‚™éš”æ—¥æ—©ç­æ©Ÿã€‚', tips: ['âš ï¸ é ç•™è½‰ä¹˜æ™‚é–“', 'ğŸ’¡ æ™šé¤å¯åœ¨é«˜éµç«™æˆ–æ¡ƒåœ’ç«™é™„è¿‘è§£æ±º'] },
                    { id: '0-2', time: '20:00', title: 'æ¡ƒåœ’æ©Ÿå ´å‘¨é‚Šé£¯åº— Check-in', type: 'hotel', location: 'æ¡ƒåœ’æ©Ÿå ´å‘¨é‚Šé£¯åº—', description: 'å…¥ä½æ©Ÿå ´é™„è¿‘é£¯åº—ï¼Œç¢ºä¿éš”æ—¥èƒ½æº–æ™‚æŠµé”æ¡ƒåœ’æ©Ÿå ´ã€‚', bookingCode: 'AIRPORT-HOTEL-RES', url: 'https://www.google.com/search?q=%E6%A1%83%E5%9C%92%E6%A9%9F%E5%A0%B4%E9%85%92%E5%BA%97', urlLabel: 'æ¡ƒåœ’é£¯åº—æŸ¥è©¢' }
                ]
            },
            // 12/3 (é€±ä¸‰)
            {
                date: '12/3',
                dayOfWeek: 'é€±ä¸‰',
                weather: { temp: '14Â°C', icon: 'cloud' },
                items: [
                    { id: '1-1', time: '07:30', title: 'æ˜Ÿå®‡èˆªç©º JX846', type: 'flight', location: 'æ¡ƒåœ’æ©Ÿå ´ (TPE) T1', description: 'é£›å¾€ç†Šæœ¬ (KMJ)ï¼Œé è¨ˆ 10:30 æŠµé”ã€‚', bookingCode: 'D95RG3', url: 'https://www.starlux-airlines.com/zh-TW', urlLabel: 'æ˜Ÿå®‡èˆªç©ºå®˜ç¶²', tips: ['ğŸ’¡ è¨˜å¾—æå‰2å°æ™‚æŠµé”æ©Ÿå ´', 'ğŸ’¡ é£›æ©Ÿé¤æ¨è–¦èƒ¡åŒç‡’è‚‰'] },
                    { id: '1-2', time: '12:00', title: 'æ©Ÿå ´å·´å£«ç§»å‹•', type: 'transport', location: 'ç†Šæœ¬æ©Ÿå ´ â†’ ç†Šæœ¬ç«™', description: 'æ­ä¹˜æ©Ÿå ´åˆ©æœ¨æ´¥å·´å£«å‰å¾€å¸‚å€ã€‚', tips: ['ğŸ’¡ å¯ä½¿ç”¨ IC å¡ (Suica/ICOCA)'] },
                    { id: '1-3', time: '13:00', title: 'æ–°å¹¹ç·š ç‘ç©—/æ«»èŠ±è™Ÿ', type: 'transport', location: 'ç†Šæœ¬ç«™ â†’ åšå¤šç«™', description: 'è½‰ä¹˜æ–°å¹¹ç·šå‰å¾€ç¦å²¡ï¼Œè»Šç¨‹ç´„ 32 åˆ†é˜ã€‚', tips: ['âš ï¸ å‹™å¿…é ç´„ã€Œç‰¹å¤§è¡Œæå¸­ã€', 'ğŸ’¡ æ¨è–¦åœ¨è»Šç«™è²·ç†Šæœ¬ç†Šä¾¿ç•¶'], bookingCode: 'JR-RES-9988', url: 'https://www.jrkyushu.co.jp/chinese/', urlLabel: 'JRä¹å·æ™‚åˆ»è¡¨' },
                    { id: '1-4', time: '14:30', title: 'KOKO HOTEL ç¦å²¡å¤©ç¥', type: 'hotel', location: 'ç¦å²¡ç¸£ç¦å²¡å¸‚ä¸­å¤®å€ä»Šæ³‰1-22-14', description: 'Check-in å¯„æ”¾è¡Œæã€‚ä½æ–¼å¤©ç¥å—ç«™é™„è¿‘ï¼Œäº¤é€šæ–¹ä¾¿ã€‚', bookingCode: 'IN1437799796', url: 'https://koko-hotels.com/fukuoka_tenjin', urlLabel: 'é£¯åº—å®˜ç¶²è³‡è¨Š' },
                    { id: '1-5', time: '15:30', title: 'æ«›ç”°ç¥ç¤¾', type: 'spot', location: 'ç¦å²¡å¸‚åšå¤šå€ä¸Šå·ç«¯ç”ºï¼‘âˆ’41', description: 'åšå¤šç¸½é®å®ˆï¼Œå¿…çœ‹å·¨å¤§çš„è£é£¾å±±ç¬ ã€‚', tips: ['ğŸ’¡ å¿…è²·ï¼šåšå¤šç¹”å¾¡å®ˆ', 'ğŸ’¡ åƒæ‹œå¾Œå¯é€›æ—é‚Šçš„å·ç«¯é€šå•†åº—è¡—'] },
                    { id: '1-6', time: '18:30', title: 'åšå¤šæ‘©æ»‹é‹ (æ™šé¤)', type: 'food', location: 'åšå¤šæ‘©æ»‹é‹ å‰ç”°å±‹/å¤§å±±', description: 'ç¦å²¡å¿…åƒç‰›è…¸é‹ï¼Œæ¿ƒéƒå‘³å™Œå£å‘³ã€‚', tips: ['ğŸ”¥ å¿…é»ï¼šå‘³å™Œå£å‘³ç‰›è…¸é‹', 'ğŸ”¥ æ”¶å°¾å¿…é»ï¼šå¼·æ£’éºµ'] }
                ]
            },
            // 12/4 (é€±å››)
            {
                date: '12/4',
                dayOfWeek: 'é€±å››',
                weather: { temp: '12Â°C', icon: 'sun' },
                items: [
                    { id: '2-1', time: '09:00', title: 'ç§»å‹•ï¼šè¥¿éµé›»è»Š', type: 'transport', location: 'è¥¿éµç¦å²¡(å¤©ç¥) â†’ å¤ªå®°åºœ', description: 'æ­ä¹˜æ—…äººè™Ÿè§€å…‰åˆ—è»Š(å¦‚æœ‰é‡åˆ°)ã€‚' },
                    { id: '2-2', time: '10:00', title: 'å¤ªå®°åºœå¤©æ»¿å®®', type: 'spot', location: 'å¤ªå®°åºœå¤©æ»¿å®®', description: 'å­¸å•ä¹‹ç¥ï¼Œè³æ¢…åæ‰€ï¼ˆé›–ç„¶ç¾åœ¨æ˜¯å†¬å¤©ï¼‰ã€‚', tips: ['ğŸ¥¯ å¿…åƒï¼šæ¢…æé¤… (æ¨è–¦åŠ è–©è«¾äº Kasanoya)', 'ğŸ’¡ æ‘¸å¾¡ç¥ç‰›çš„é ­æœƒè®Šè°æ˜'] },
                    { id: '2-3', time: '12:00', title: 'ä¸€è˜­æ‹‰éºµ å¤ªå®°åºœåƒé“åº—', type: 'food', location: 'å¤ªå®°åºœåƒé“', description: 'å…¨çƒå”¯ä¸€çš„äº”è§’å½¢ç¢—ï¼Œè±¡å¾µã€Œåˆæ ¼ã€ã€‚', tips: ['ğŸ”¥ éºµæ¢æ¯”ä¸€èˆ¬çš„é•·(è±¡å¾µé•·å£½/é•·ä¹…)', 'ğŸ’¡ æ¹¯å–å®Œç¢—åº•æœ‰ã€Œæ±ºå®šã€äºŒå­—'] },
                    { id: '2-4', time: '14:00', title: 'ç«ˆé–€ç¥ç¤¾', type: 'spot', location: 'ç«ˆé–€ç¥ç¤¾', description: 'é¬¼æ»…ä¹‹åˆƒè–åœ°ï¼Œçµç·£ç¥ç¤¾ã€‚éœ€æ­ä¹˜ç¤¾å€å·´å£«ã€Œæ‘©è¨¶è€¶ã€ã€‚', tips: ['ğŸ’¡ é€™è£¡çš„å¾¡å®ˆè¨­è¨ˆéå¸¸æ™‚å°šï¼Œé©åˆç•¶ä¼´æ‰‹ç¦®'] }
                ]
            },
            // 12/5 (é€±äº”)
            {
                date: '12/5',
                dayOfWeek: 'é€±äº”',
                weather: { temp: '8Â°C', icon: 'cloud' },
                items: [
                    { id: '3-1', time: '09:00', title: 'ç§Ÿè»Šå–è»Š', type: 'transport', location: 'TOYOTA Rent a Car è—¥é™¢ç«™å‰åº—', description: 'è¾¦ç†ç§Ÿè»Šæ‰‹çºŒï¼Œç¢ºèª ETC å¡ã€‚', bookingCode: 'RES: TOYOTA-8821', url: 'https://rent.toyota.co.jp/zh-tw/', urlLabel: 'Toyota Rent a Car', tips: ['âš ï¸ æª¢æŸ¥è»Šèº«åˆ®ç—•', 'âš ï¸ è¨­å®šå°èˆªè‡³é˜¿è˜‡'] },
                    { id: '3-2', time: '12:30', title: 'é˜¿è˜‡èµ¤ç‰›ä¸¼ (åˆé¤)', type: 'food', location: 'é˜¿è˜‡ Imakiné£Ÿå ‚ (æˆ–å‘¨é‚Š)', description: 'é˜¿è˜‡å¿…åƒç¾é£Ÿï¼ŒåŠç†Ÿç´…ç‰›è‚‰é‹ªæ»¿ä¸¼é£¯ã€‚', tips: ['ğŸ”¥ å¿…åƒï¼šèµ¤ç‰›ä¸¼', 'ğŸ’¡ å¦‚æœImakinæ’å¤ªä¹…ï¼Œå¯å» Meshi-no-sato'] },
                    { id: '3-3', time: '14:00', title: 'è‰åƒé‡Œä¹‹æ¿± & é˜¿è˜‡ç«å£', type: 'spot', location: 'é˜¿è˜‡å±±è‰åƒé‡Œ', description: 'ä¸€æœ›ç„¡éš›çš„å¤§è‰åŸèˆ‡å†’ç…™çš„ç«å±±å£ã€‚', tips: ['ğŸ’¡ å±±ä¸Šé¢¨å¤§ï¼Œè«‹å¸¶åšå¤–å¥—', 'ğŸ’¡ å¿…è²·ï¼šé˜¿è˜‡ç‰›å¥¶å†°æ·‡æ·‹'], url: 'https://www.aso-volcano.jp/', urlLabel: 'é˜¿è˜‡ç«å±±è¦åˆ¶æƒ…å ±' },
                    { id: '3-4', time: '15:30', title: 'å¤§è§€å³°å±•æœ›æ‰€', type: 'spot', location: 'å¤§è§€å³°', description: '360åº¦çœºæœ›é˜¿è˜‡äº”å²³(æ¶…æ§ƒåƒ)çš„æœ€ä½³åœ°é»ã€‚' },
                    { id: '3-5', time: '16:30', title: 'é»‘å·æº«æ³‰ Check-in', type: 'hotel', location: 'é»’å·æ¸©æ³‰ ã‚„ã¾ã³ã“æ—…é¤¨', description: 'å…¥ä½æ—¥å¼æº«æ³‰æ—…é¤¨ï¼Œäº«å—ä»™äººé¢¨å‘‚ã€‚', bookingCode: 'RYa0kr1u0r', url: 'https://www.kurokawa-yamabiko.com/', urlLabel: 'æ—…é¤¨å®˜ç¶²', tips: ['ğŸ’¡ è³¼è²·ã€Œå…¥æ¹¯æ‰‹å½¢ã€å¯æ³¡ä¸‰é–“ä¸åŒæº«æ³‰', 'ğŸ’¡ æ™šé¤å‰å…ˆå»æ³¡æ¹¯'] }
                ]
            },
            // 12/6 (é€±å…­)
            {
                date: '12/6',
                dayOfWeek: 'é€±å…­',
                weather: { temp: '5Â°C', icon: 'cloud' },
                items: [
                    { id: '4-1', time: '10:00', title: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾', type: 'spot', location: 'ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾', description: 'é€šå¾€ç•°ä¸–ç•Œçš„å…¥å£ï¼Œå……æ»¿é’è‹”çš„ç¥ç§˜éšæ¢¯ã€‚', tips: ['ğŸ“¸ å¿…æ‹ï¼šåƒé“éšæ¢¯èˆ‡ç©¿é€å²©çŸ³çš„é¢¨ç©´'] },
                    { id: '4-2', time: '12:00', title: 'é«˜æ£®ç”°æ¨‚ä¿å­˜æœƒ (åˆé¤)', type: 'food', location: 'é«˜æ£®ç”°æ¥½ä¿å­˜æœƒ', description: 'åœè‘—åœ°çˆåƒå‘³å™Œçƒ¤ä¸²ï¼Œéå¸¸æœ‰æ°£æ°›ã€‚' },
                    { id: '4-3', time: '13:30', title: 'å¤©å²©æˆ¶ç¥ç¤¾ & å¤©å®‰æ²³åŸ', type: 'spot', location: 'å¤©å²©æˆ¸ç¥ç¤¾ è¥¿æœ¬å®®', description: 'æ—¥æœ¬ç¥è©±èµ·æºåœ°ï¼Œåœ¨æ­¤å †çŸ³é ­è¨±é¡˜ã€‚' },
                    { id: '4-4', time: '15:00', title: 'Solest Takachiho Hotel', type: 'hotel', location: 'Solest Takachiho Hotel', description: 'Check-in ä¼‘æ¯ã€‚', bookingCode: '4x1qrzv8', url: 'https://www.solest-takachiho.jp/', urlLabel: 'é£¯åº—å®˜ç¶²' },
                    { id: '4-5', time: '17:00', title: 'é«˜åƒç©—ç‡’è‚‰ã€Œå’Œã€', type: 'food', location: 'é«˜åƒç©‚ç‰›ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å’Œ', description: 'é ‚ç´šé«˜åƒç©—ç‰›ç‡’è‚‰ã€‚', tips: ['âš ï¸ éœ€æå‰é ç´„', 'ğŸ”¥ å¿…é»ï¼šé«˜åƒç©—ç‰›é‡Œè„Š'], bookingCode: 'TEL-RES-NAME-CHEN', url: 'https://takachiho.ja-miyazaki.jp/restaurant.php', urlLabel: 'é¤å»³è³‡è¨Šé ' },
                    { id: '4-6', time: '20:00', title: 'é«˜åƒç©—ç¥æ¨‚', type: 'spot', location: 'é«˜åƒç©—ç¥ç¤¾', description: 'å¤œç¥æ¨‚è¡¨æ¼”ï¼Œé«”é©—æ—¥æœ¬å‚³çµ±æ–‡åŒ–ã€‚', tips: ['ğŸ’¡ 19:00 é–‹æ”¾å…¥å ´ï¼Œå»ºè­°ææ—©å»ä½”ä½'] }
                ]
            },
            // 12/7 (é€±æ—¥)
            {
                date: '12/7',
                dayOfWeek: 'é€±æ—¥',
                weather: { temp: '9Â°C', icon: 'sun' },
                items: [
                    { id: '5-1', time: '09:00', title: 'é«˜åƒç©—å³½ åˆ’èˆ¹', type: 'spot', location: 'é«˜åƒç©—å³½æ·¡æ°´é­šæ°´æ—é¤¨(ä¹˜èˆ¹è™•)', description: 'åœ¨å³½è°·ä¸­åˆ’èˆ¹ï¼Œè¿‘è·é›¢çœ‹çœŸåäº•ç€‘å¸ƒã€‚', tips: ['âš ï¸ å‹™å¿…äº‹å…ˆä¸Šç¶²é ç´„', 'ğŸ“¸ å¿…æ‹ï¼šç€‘å¸ƒèˆ‡èˆ¹çš„åˆå½±'], bookingCode: 'BOAT-RES-3344', url: 'https://takachiho-kanko.info/sightseeing/taka_boat.php', urlLabel: 'åˆ’èˆ¹é ç´„å®˜ç¶²' },
                    { id: '5-2', time: '12:00', title: 'æµæ°´ç´ éºµ (åˆé¤)', type: 'food', location: 'åƒç©—ä¹‹å®¶', description: 'é«”é©—ç«¹ç®¡æµæ°´ç´ éºµã€‚' },
                    { id: '5-3', time: '15:00', title: 'ç†Šæœ¬é‚„è»Š', type: 'transport', location: 'TOYOTA Rent a Car ç†Šæœ¬ç«™å‰åº—', description: 'åŠ æ»¿æ²¹å¾Œé‚„è»Šã€‚' },
                    { id: '5-4', time: '15:30', title: 'CANDEN HOTEL ç†Šæœ¬', type: 'hotel', location: 'CANDEO HOTELS ç†Šæœ¬æ–°å¸‚è¡—', description: 'Check-inï¼Œä½æ–¼æ–°å¸‚è¡—å•†åº—è¡—å…§ã€‚', bookingCode: '3036-3012-3431', url: 'https://www.candeohotels.com/ja/kumamoto-shinshigai/', urlLabel: 'é£¯åº—å®˜ç¶²' }
                ]
            },
            // 12/8 (é€±ä¸€) - å·²æ–°å¢åŠ è—¤ç¥ç¤¾
            {
                date: '12/8',
                dayOfWeek: 'é€±ä¸€',
                weather: { temp: '11Â°C', icon: 'sun' },
                items: [
                    { id: '6-1', time: '10:00', title: 'ç†Šæœ¬åŸã€åŠ è—¤ç¥ç¤¾ & åŸå½©è‹‘', type: 'spot', location: 'ç†Šæœ¬åŸ / åŠ è—¤ç¥ç¤¾', description: 'åƒè§€ä¿®å¾©ä¸­çš„ç†Šæœ¬åŸå¤©å®ˆé–£ã€å¢ƒå…§çš„åŠ è—¤ç¥ç¤¾èˆ‡åŸä¸‹ç”ºã€‚', tips: ['ğŸ¦ å¿…åƒï¼šåŸå½©è‹‘çš„æµ·è†½å¯æ¨‚é¤…', 'ğŸ“¸ å¤©å®ˆé–£é ‚æ¨“é¢¨æ™¯', 'ğŸ’¡ åŠ è—¤ç¥ç¤¾å¯è¿‘è·é›¢æ‹æ”å¤©å®ˆé–£'], url: 'https://kumamoto-guide.jp/kumamoto-castle/', urlLabel: 'ç†Šæœ¬åŸå®˜ç¶²' },
                    { id: '6-2', time: '12:30', title: 'ç†Šæœ¬æ‹‰éºµ (åˆé¤)', type: 'food', location: 'é»‘äº­æ‹‰éºµ / æ¡‚èŠ±æ‹‰éºµ', description: 'ç‰¹è‰²æ˜¯æ¿ƒéƒçš„ç„¦é¦™è’œæ²¹ã€‚' },
                    { id: '6-3', time: '14:30', title: 'ä¸‹é€š/ä¸Šé€šå•†åº—è¡—', type: 'spot', location: 'ç†Šæœ¬ä¸‹é€šå•†åº—è¡—', description: 'æœ€å¾Œæ¡è²·ä¼´æ‰‹ç¦®ã€‚', tips: ['ğŸ›ï¸ å¿…é€›ï¼šé¶´å±‹ç™¾è²¨ç†Šæœ¬ç†Šéƒ¨é•·è¾¦å…¬å®¤', 'ğŸ›ï¸ è—¥å¦åº—æ¯”åƒ¹'] },
                    { id: '6-4', time: '18:00', title: 'ç†Šæœ¬é¦¬è‚‰æ–™ç† (æ™šé¤)', type: 'food', location: 'ç®¡ä¹ƒå±‹ / é¦¬æ«»', description: 'ç†Šæœ¬åç‰©ç”Ÿé¦¬è‚‰é«”é©—ã€‚' }
                ]
            },
            // 12/9 (é€±äºŒ)
            {
                date: '12/9',
                dayOfWeek: 'é€±äºŒ',
                weather: { temp: '13Â°C', icon: 'cloud' },
                items: [
                    { id: '7-1', time: '09:00', title: 'å‰å¾€æ©Ÿå ´', type: 'transport', location: 'ç†Šæœ¬æ«»ç”ºå·´å£«ç¸½ç«™', description: 'æ­ä¹˜æ©Ÿå ´å·´å£«å‰å¾€ç†Šæœ¬æ©Ÿå ´ã€‚' },
                    { id: '7-2', time: '11:45', title: 'æ˜Ÿå®‡èˆªç©º JX847', type: 'flight', location: 'ç†Šæœ¬æ©Ÿå ´ (KMJ)', description: 'é£›å¾€æ¡ƒåœ’ (TPE)ï¼Œé è¨ˆ 13:25 æŠµé”ã€‚', bookingCode: 'D95RG3' },
                    { id: '7-3', time: '15:43', title: 'å°ç£é«˜éµ', type: 'transport', location: 'é«˜éµæ¡ƒåœ’ç«™', description: 'æ­ä¹˜é«˜éµè¿”å›å°å—ã€‚' }
                ]
            }
        ];

        // ç°¡å–®è¨˜å¸³ç‹€æ…‹
        let expenses = [
        ];

        // --- æ ¸å¿ƒæ¸²æŸ“å‡½æ•¸ ---

        // 1. å–å¾—åœ–ç¤ºçš„ SVG æ¨™ç±¤
        const getIconSVG = (iconName, classes, strokeWidth = 2) => {
            const size = 18;
            return `<i data-lucide="${iconName}" class="${classes} w-${size/4} h-${size/4}" style="stroke-width: ${strokeWidth};"></i>`;
        };

        // 2. å–å¾—åˆ†é¡åœ–ç¤º
        const getCategoryIcon = (type, size = 18) => {
            let icon, color;
            switch (type) {
                case 'flight': icon = 'plane'; color = 'text-sky-600'; break;
                case 'transport': icon = 'train'; color = 'text-indigo-600'; break;
                case 'food': icon = 'utensils'; color = 'text-orange-600'; break;
                case 'hotel': icon = 'home'; color = 'text-emerald-600'; break;
                case 'spot': icon = 'camera'; color = 'text-rose-600'; break;
                default: icon = 'map-pin'; color = 'text-gray-600'; break;
            }
            return `<i data-lucide="${icon}" class="${color} w-${size/4} h-${size/4}" style="stroke-width: 2;"></i>`;
        };
        
        // 3. æ¸²æŸ“å¤©æ°£æ¨™ç±¤
        const renderWeatherBadge = (temp, icon) => {
            let iconName, color;
            switch(icon) {
                case 'sun': iconName = 'sun'; color = 'text-orange-500'; break;
                case 'rain': iconName = 'cloud-rain'; color = 'text-blue-500'; break;
                default: iconName = 'cloud'; color = 'text-gray-500'; break;
            }

            return `
                <div class="flex items-center gap-1 bg-white/80 backdrop-blur px-2 py-1 rounded-full text-xs font-medium shadow-sm border border-stone-200">
                    ${getIconSVG(iconName, color, 2)}
                    <span class="text-stone-700">${temp}</span>
                </div>
            `;
        };

        // 4. æ¸²æŸ“é é¢ Header
        const renderHeader = () => {
            const header = document.getElementById('app-header');
            const currentDay = itineraryData[selectedDayIndex];
            
            header.innerHTML = `
                <div>
                    <p class="text-xs font-bold text-stone-400 tracking-widest uppercase mb-1">JAPAN TRIP 2025</p>
                    <h1 class="text-2xl font-bold text-stone-800 font-serif">ä¹å·æ—…å¸–</h1>
                </div>
                ${activeTab === 'itinerary' ? renderWeatherBadge(currentDay.weather.temp, currentDay.weather.icon) : ''}
            `;
            // é‡æ–°è¼‰å…¥ Lucide icons
            lucide.createIcons();
        };

        // 5. æ¸²æŸ“æ—¥æœŸé¸æ“‡å™¨
        const renderDateSelector = () => {
            const html = `
                <div class="sticky top-[26px] z-10 bg-[#fdfbf7] py-2 border-b border-stone-100 shadow-sm">
                    <div class="flex overflow-x-auto px-4 gap-3 pb-2 scrollbar-hide snap-x">
                        ${itineraryData.map((day, idx) => `
                            <button
                                data-day-index="${idx}"
                                class="day-selector flex-shrink-0 snap-center flex flex-col items-center justify-center w-14 h-16 rounded-xl transition-all duration-300 ${
                                    selectedDayIndex === idx 
                                      ? 'bg-stone-800 text-white shadow-lg scale-105' 
                                      : 'bg-white text-stone-400 border border-stone-100'
                                }"
                            >
                                <span class="text-xs font-medium">${day.date}</span>
                                <span class="text-sm font-bold ${selectedDayIndex === idx ? 'text-stone-200' : 'text-stone-600'}">
                                    ${day.dayOfWeek}
                                </span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            return html;
        };

        // 6. æ¸²æŸ“è¡Œç¨‹åˆ—è¡¨
        const renderItineraryList = () => {
            const currentDay = itineraryData[selectedDayIndex];
            const itemsHtml = currentDay.items.map((item, idx) => `
                <div class="relative pl-6 group">
                    <!-- Timeline Line -->
                    ${idx !== currentDay.items.length - 1 ? '<div class="absolute left-[11px] top-8 bottom-[-24px] w-[2px] bg-stone-200"></div>' : ''}
                    
                    <!-- Timeline Dot -->
                    <div class="absolute left-0 top-1.5 w-6 h-6 rounded-full border-4 border-[#fdfbf7] flex items-center justify-center 
                        ${item.type === 'transport' ? 'bg-indigo-500' : 
                        item.type === 'food' ? 'bg-orange-500' : 
                        item.type === 'spot' ? 'bg-rose-500' : 
                        item.type === 'flight' ? 'bg-sky-500' : 'bg-emerald-500'}">
                    </div>

                    <!-- Card -->
                    <div 
                        data-item-index="${idx}"
                        class="item-card bg-white rounded-xl p-4 shadow-sm border border-stone-100 active:scale-98 transition-transform cursor-pointer hover:shadow-md"
                    >
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-mono font-bold text-stone-400 bg-stone-50 px-2 py-0.5 rounded">
                                ${item.time}
                            </span>
                            ${item.bookingCode ? `
                                <span class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded border border-emerald-100">
                                    å·²é ç´„
                                </span>
                            ` : ''}
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <h3 class="font-bold text-stone-800 text-base mb-1">${item.title}</h3>
                                <p class="text-xs text-stone-500 line-clamp-1 mb-2">${item.location}</p>
                                
                                <!-- Mini Tags -->
                                ${item.tips ? `
                                    <div class="flex flex-wrap gap-1 mt-2">
                                        ${item.tips.slice(0, 2).map((tip, i) => `
                                            <span class="text-[10px] bg-amber-50 text-amber-700 px-1.5 py-0.5 rounded border border-amber-100">
                                                ${tip}
                                            </span>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex flex-col items-center justify-center pl-2 border-l border-stone-100 text-stone-300">
                                ${getIconSVG('chevron-right', 'w-5 h-5', 3)}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            return `
                ${renderDateSelector()}
                <div id="itinerary-list" class="p-5 pb-24 space-y-6">
                    ${itemsHtml}
                </div>
            `;
        };

        // 7. æ¸²æŸ“å·¥å…·ç®±
        const renderToolsSection = () => {
            const total = expenses.reduce((sum, curr) => sum + curr.price, 0);

            return `
                <div class="space-y-6 p-1 pb-20">
                    <!-- ç·Šæ€¥è¯çµ¡ -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-stone-100">
                        <h3 class="font-bold text-stone-800 mb-3 flex items-center gap-2">
                            ${getIconSVG('phone', 'text-rose-500')} ç·Šæ€¥è¯çµ¡
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between border-b border-stone-50 pb-2">
                                <span class="text-stone-500">æ•‘è­·è»Š/ç«è­¦</span>
                                <span class="font-mono font-bold text-rose-600">119</span>
                            </div>
                            <div class="flex justify-between border-b border-stone-50 pb-2">
                                <span class="text-stone-500">è­¦å¯Ÿå±€</span>
                                <span class="font-mono font-bold text-rose-600">110</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-stone-500">å°åŒ—é§å¤§é˜ªè¾¦äº‹è™•ç¦å²¡åˆ†è™•</span>
                                <span class="font-mono font-bold text-stone-800">092-734-2810</span>
                            </div>
                        </div>
                    </div>

                    <!-- èˆªç­è³‡è¨Š -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-stone-100">
                        <h3 class="font-bold text-stone-800 mb-3 flex items-center gap-2">
                            ${getIconSVG('briefcase', 'text-indigo-500')} èˆªç­è³‡è¨Š
                        </h3>
                        <div class="bg-indigo-50 rounded-lg p-3 mb-2">
                            <div class="flex justify-between text-xs text-indigo-400 mb-1">12/03 å»ç¨‹ (D95RG3)</div>
                            <div class="font-bold text-indigo-900">JX 846 TPE - KMJ</div>
                            <div class="text-sm text-indigo-700">07:30 - 10:30</div>
                        </div>
                        <div class="bg-indigo-50 rounded-lg p-3">
                            <div class="flex justify-between text-xs text-indigo-400 mb-1">12/09 å›ç¨‹ (D95RG3)</div>
                            <div class="font-bold text-indigo-900">JX 847 KMJ - TPE</div>
                            <div class="text-sm text-indigo-700">11:45 - 13:25</div>
                        </div>
                    </div>

                    <!-- è¨˜å¸³å°å¹«æ‰‹ -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-stone-100">
                        <h3 class="font-bold text-stone-800 mb-3 flex items-center gap-2">
                            ${getIconSVG('credit-card', 'text-emerald-500')} è¨˜å¸³å°å¹«æ‰‹ (JPY)
                        </h3>
                        <div class="flex gap-2 mb-4" id="expense-input-form">
                            <input id="new-expense-item" type="text" placeholder="é …ç›®" class="flex-1 bg-stone-50 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-stone-400" />
                            <input id="new-expense-price" type="number" placeholder="Â¥" class="w-20 bg-stone-50 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-stone-400" />
                            <button id="add-expense-btn" class="bg-stone-800 text-white px-3 rounded-lg text-sm font-medium">+</button>
                        </div>
                        <div id="expense-list-container" class="space-y-2 max-h-40 overflow-y-auto">
                            ${expenses.map(ex => `
                                <div class="flex justify-between text-sm text-stone-600">
                                    <span>${ex.item}</span>
                                    <span class="font-mono">Â¥${ex.price}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-3 pt-3 border-t border-stone-100 flex justify-between font-bold text-stone-800">
                            <span>Total</span>
                            <span class="font-mono text-emerald-600" id="expense-total">Â¥${total}</span>
                        </div>
                    </div>
                </div>
            `;
        };

        // 8. æ¸²æŸ“ä¸»è¦å…§å®¹
        const renderMainContent = () => {
            const main = document.getElementById('app-main');
            if (activeTab === 'itinerary') {
                main.innerHTML = renderItineraryList();
                attachItineraryListeners();
            } else {
                main.innerHTML = `<div class="p-5">${renderToolsSection()}</div>`;
                attachToolsListeners();
            }
            renderHeader(); // æ›´æ–°Header (å¤©æ°£/æ¨™é¡Œ)
        };

        // 9. æ¸²æŸ“è©³ç´°è³‡è¨Šå½ˆçª—
        const renderDetailModal = (item) => {
            if (!item) {
                document.getElementById('modal-placeholder').innerHTML = '';
                return;
            }

            const tipsHtml = item.tips && item.tips.length > 0 ? `
                <div class="bg-amber-50 p-3 rounded-lg border border-amber-100">
                    <p class="text-xs font-bold text-amber-600 mb-2 flex items-center gap-1">
                        ${getIconSVG('info', 'w-3 h-3')} é”äººç­†è¨˜
                    </p>
                    <ul class="space-y-1">
                        ${item.tips.map(tip => `
                            <li class="text-xs text-amber-900 flex items-start gap-1">
                                <span>â€¢</span>
                                <span>${tip}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            ` : '';

            const bookingCodeHtml = item.bookingCode ? `
                <div class="bg-stone-100 p-3 rounded-lg border border-stone-200 dashed">
                    <p class="text-xs text-stone-500 mb-1">é ç´„/è¨‚ä½ä»£è™Ÿ</p>
                    <p class="font-mono text-lg font-bold text-stone-800 tracking-wider">${item.bookingCode}</p>
                </div>
            ` : '';

            const urlButtonHtml = item.url ? `
                <a 
                    href="${item.url}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex items-center justify-center gap-2 w-full py-3 bg-sky-600 text-white rounded-xl hover:bg-sky-500 transition-colors font-medium shadow-md shadow-sky-100"
                >
                    ${getIconSVG('external-link', 'w-5 h-5', 2)}
                    ${item.urlLabel || 'å®˜æ–¹ç¶²ç«™ / é ç´„é é¢'}
                </a>
            ` : '';

            const modalHtml = `
                <div id="detail-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-stone-900/60 backdrop-blur-sm animate-in fade-in duration-200">
                    <div class="bg-[#fdfbf7] w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden border border-stone-200 flex flex-col max-h-[90vh]">
                        <div class="p-4 border-b border-stone-200 flex justify-between items-center bg-white shrink-0">
                            <h3 class="font-bold text-stone-800 text-lg flex items-center gap-2">
                                ${getCategoryIcon(item.type)}
                                ${item.title}
                            </h3>
                            <button id="close-modal-btn" class="p-1 hover:bg-stone-100 rounded-full">
                                ${getIconSVG('x', 'text-stone-500', 2)}
                            </button>
                        </div>
                        
                        <div class="p-5 space-y-4 overflow-y-auto">
                            <div class="space-y-1">
                                <p class="text-xs font-bold text-stone-400 uppercase tracking-wider">æ™‚é–“èˆ‡åœ°é»</p>
                                <p class="text-stone-800 font-medium text-lg">${item.time}</p>
                                <p class="text-stone-600">${item.location}</p>
                            </div>

                            ${bookingCodeHtml}

                            ${item.description ? `
                                <div class="space-y-1">
                                    <p class="text-xs font-bold text-stone-400 uppercase tracking-wider">è¡Œç¨‹æè¿°</p>
                                    <p class="text-stone-700 leading-relaxed text-sm">${item.description}</p>
                                </div>
                            ` : ''}
                            
                            ${tipsHtml}

                            <div class="pt-2 space-y-2">
                                ${urlButtonHtml}

                                <a 
                                    href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="flex items-center justify-center gap-2 w-full py-3 bg-stone-800 text-white rounded-xl hover:bg-stone-700 transition-colors font-medium shadow-lg shadow-stone-200"
                                >
                                    ${getIconSVG('navigation', 'w-5 h-5', 2)}
                                    é–‹å•Ÿ Google Maps å°èˆª
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modal-placeholder').innerHTML = modalHtml;
            lucide.createIcons(); // é‡æ–°è¼‰å…¥ Lucide icons

            // ç¶å®šé—œé–‰äº‹ä»¶
            document.getElementById('close-modal-btn').onclick = () => renderDetailModal(null);
        };

        // 10. æ¸²æŸ“ Tab Bar (åƒ…æ›´æ–°ç‹€æ…‹)
        const updateTabBar = () => {
            const itineraryBtn = document.getElementById('tab-itinerary');
            const toolsBtn = document.getElementById('tab-tools');
            
            // Itinerary Tab
            itineraryBtn.classList.toggle('text-stone-800', activeTab === 'itinerary');
            itineraryBtn.classList.toggle('text-stone-400', activeTab !== 'itinerary');
            itineraryBtn.querySelector('i').style.strokeWidth = activeTab === 'itinerary' ? 2.5 : 2;

            // Tools Tab
            toolsBtn.classList.toggle('text-stone-800', activeTab === 'tools');
            toolsBtn.classList.toggle('text-stone-400', activeTab !== 'tools');
            toolsBtn.querySelector('i').style.strokeWidth = activeTab === 'tools' ? 2.5 : 2;
        };
        
        // --- äº‹ä»¶ç›£è½å™¨ (ç¶å®š) ---

        const attachGlobalListeners = () => {
            // Tab é»æ“Šäº‹ä»¶
            document.getElementById('tab-itinerary').onclick = () => {
                if (activeTab !== 'itinerary') {
                    activeTab = 'itinerary';
                    renderMainContent();
                    updateTabBar();
                }
            };
            document.getElementById('tab-tools').onclick = () => {
                if (activeTab !== 'tools') {
                    activeTab = 'tools';
                    renderMainContent();
                    updateTabBar();
                }
            };
        };

        const attachItineraryListeners = () => {
            // æ—¥æœŸé¸æ“‡å™¨é»æ“Šäº‹ä»¶
            document.querySelectorAll('.day-selector').forEach(btn => {
                btn.onclick = (e) => {
                    const index = parseInt(e.currentTarget.getAttribute('data-day-index'));
                    if (selectedDayIndex !== index) {
                        selectedDayIndex = index;
                        renderMainContent();
                        // æ»¾å‹•åˆ°é¸ä¸­çš„æ—¥æœŸ
                        e.currentTarget.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    }
                };
            });

            // è¡Œç¨‹å¡ç‰‡é»æ“Šäº‹ä»¶ (é–‹å•Ÿ Modal)
            document.querySelectorAll('.item-card').forEach(card => {
                card.onclick = (e) => {
                    const itemIndex = parseInt(e.currentTarget.getAttribute('data-item-index'));
                    selectedItem = itineraryData[selectedDayIndex].items[itemIndex];
                    renderDetailModal(selectedItem);
                };
            });
            
            // é‡æ–°è¼‰å…¥ Lucide icons
            lucide.createIcons();
        };

        const attachToolsListeners = () => {
            // è¨˜å¸³æ–°å¢æŒ‰éˆ•äº‹ä»¶
            document.getElementById('add-expense-btn').onclick = () => {
                const itemInput = document.getElementById('new-expense-item');
                const priceInput = document.getElementById('new-expense-price');
                const newItem = itemInput.value.trim();
                const newPrice = parseInt(priceInput.value);

                if (newItem && !isNaN(newPrice) && newPrice > 0) {
                    expenses.push({ item: newItem, price: newPrice });
                    // æ¸…ç©ºè¼¸å…¥æ¡†
                    itemInput.value = '';
                    priceInput.value = '';
                    // é‡æ–°æ¸²æŸ“å·¥å…·ç®±ä»¥æ›´æ–°åˆ—è¡¨å’Œç¸½è¨ˆ
                    renderMainContent();
                } else {
                    console.error("è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®å’Œé‡‘é¡ã€‚");
                }
            };

            // é‡æ–°è¼‰å…¥ Lucide icons
            lucide.createIcons();
        };

        // --- åˆå§‹åŒ– APP ---
        window.onload = function() {
            attachGlobalListeners();
            renderMainContent(); // åˆå§‹æ¸²æŸ“
        };
    </script>
</body>
</html>
